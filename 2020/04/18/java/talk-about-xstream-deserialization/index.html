<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>ã€notesã€‘å›é¡¾XStreamååºåˆ—åŒ–æ¼æ´ | 0kami&#39;s Blog</title>
  <meta name="description" content="A Web ğŸ¶ &amp;&amp; Code Reviewer">
  <meta name="keywords" content>
  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" href="/images/avatar.jpg">
  <link rel="alternate" href="/atom.xml" title="0kami's Blog">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="0x00 å‰è¨€ XStreamä¹Ÿæ˜¯ä¸€æ¬¾ç”¨çš„æ¯”è¾ƒå¤šçš„åºåˆ—åŒ–ç»„ä»¶ï¼Œå¯ä»¥å°†objectè½¬åŒ–ä¸ºXMLå¹¶èƒ½å®Œæ•´çš„è¿˜åŸå›æ¥ã€‚ä»–ä¹Ÿæ›¾ç»å‡ºç°è¿‡ååºåˆ—åŒ–æ¼æ´ï¼Œæœ¬æ–‡ä¸»è¦æ•´ç†XStreamç›¸å…³çš„å®‰å…¨é—®é¢˜XD">
<meta name="keywords" content="vul">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€notesã€‘å›é¡¾XStreamååºåˆ—åŒ–æ¼æ´">
<meta property="og:url" content="http://blog.0kami.cn/2020/04/18/java/talk-about-xstream-deserialization/index.html">
<meta property="og:site_name" content="0kami&#39;s Blog">
<meta property="og:description" content="0x00 å‰è¨€ XStreamä¹Ÿæ˜¯ä¸€æ¬¾ç”¨çš„æ¯”è¾ƒå¤šçš„åºåˆ—åŒ–ç»„ä»¶ï¼Œå¯ä»¥å°†objectè½¬åŒ–ä¸ºXMLå¹¶èƒ½å®Œæ•´çš„è¿˜åŸå›æ¥ã€‚ä»–ä¹Ÿæ›¾ç»å‡ºç°è¿‡ååºåˆ—åŒ–æ¼æ´ï¼Œæœ¬æ–‡ä¸»è¦æ•´ç†XStreamç›¸å…³çš„å®‰å…¨é—®é¢˜XD">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200414231833562.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200414231951807.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200414232218889.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200415142144637.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200415142431953.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200415142913714.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200415143058176.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200415162242443.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200415162715854.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200415163231155.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200415170159510.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200418142036889.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200418171210630.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200418174424715.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200416162110270.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200416164810572.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200416165222727.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200416170450515.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200416170531566.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200416170954216.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200416171051157.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200416171636844.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200416171715068.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200416171927622.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200417164755804.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200417164854625.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200417225056222.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200417225303428.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200417225600161.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200417225808446.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200417230040882.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200417230343866.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200417230451954.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200417231357924.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200418185546291.png">
<meta property="og:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200418192827552.png">
<meta property="og:updated_time" content="2021-03-17T11:42:40.120Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ã€notesã€‘å›é¡¾XStreamååºåˆ—åŒ–æ¼æ´">
<meta name="twitter:description" content="0x00 å‰è¨€ XStreamä¹Ÿæ˜¯ä¸€æ¬¾ç”¨çš„æ¯”è¾ƒå¤šçš„åºåˆ—åŒ–ç»„ä»¶ï¼Œå¯ä»¥å°†objectè½¬åŒ–ä¸ºXMLå¹¶èƒ½å®Œæ•´çš„è¿˜åŸå›æ¥ã€‚ä»–ä¹Ÿæ›¾ç»å‡ºç°è¿‡ååºåˆ—åŒ–æ¼æ´ï¼Œæœ¬æ–‡ä¸»è¦æ•´ç†XStreamç›¸å…³çš„å®‰å…¨é—®é¢˜XD">
<meta name="twitter:image" content="http://blog.0kami.cn/images/talk-about-xstream-deserialization-20200418/image-20200414231833562.png">

  <link href="https://fonts.googleapis.com/css?family=Inconsolata|Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
  <link href="//cdn.bootcss.com/node-waves/0.7.5/waves.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
</head>
</html>
<body>
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


  <script>setLoadingBarProgress(20)</script> 
  <header class="l_header">
	<div class='wrapper'>
		<div class="nav-main container container--flex">
			<a class="logo flat-box" href='/' >
				0kami's Blog
			</a>
			<div class='menu'>
				<ul class='h-list'>
					
						<li>
							<a class='flat-box nav-home' href='/'>
								Home
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-archives' href='/archives'>
								Archives
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-about' href='/about'>
								About
							</a>
						</li>
					
				</ul>
				<div class='underline'></div>
			</div>
			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<span class="icon icon-search"></span>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a href='javascript:void(0)'><span class="icon icon-search flat-box"></span></a></li>
				
				<li class='s-menu'><a href='javascript:void(0)'><span class="icon icon-menu flat-box"></span></a></li>
			</ul>
		</div>
		
		<div class='nav-sub container container--flex'>
			<a class="logo" class="flat-box" href='javascript:void(0)'>
				Word of Forks
			</a>

			<ul class='switcher h-list'>
				<li class='s-comment'><a href='javascript:void(0)'><span class="icon icon-chat_bubble_outline flat-box"></span></a></li>
				<li class='s-top'><a href='javascript:void(0)'><span class="icon icon-arrow_upward flat-box"></span></a></li>
				<li class='s-toc'><a href='javascript:void(0)'><span class="icon icon-format_list_numbered flat-box"></span></a></li>
			</ul>
		</div>
	</div>
</header>
<aside class="menu-phone">
	<nav>
		
			<a href="/" class="nav-home nav">
				Home
			</a>
		
			<a href="/archives" class="nav-archives nav">
				Archives
			</a>
		
			<a href="/about" class="nav-about nav">
				About
			</a>
		
	</nav>
</aside>

    <script>setLoadingBarProgress(40);</script>
  <div class="l_body">
    <div class='container clearfix'>
      <div class='l_main'>
        <article id="post-java/talk-about-xstream-deserialization"
  class="post white-box article-type-post"
  itemscope itemprop="blogPost">
	<section class='meta'>
	<h2 class="title">
  	<a href="/2020/04/18/java/talk-about-xstream-deserialization/">
    	ã€notesã€‘å›é¡¾XStreamååºåˆ—åŒ–æ¼æ´
    </a>
  </h2>
	<time>
	  Apr 18, 2020
	</time>
	
    
    <div class='cats'>
        <a href="/categories/notes/">notes</a>
    </div>

	</section>
	
		<section class="toc-wrapper"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-å‰è¨€"><span class="toc-number">1.</span> <span class="toc-text">0x00 å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-åŸºç¡€çŸ¥è¯†"><span class="toc-number">2.</span> <span class="toc-text">0x01 åŸºç¡€çŸ¥è¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-MapConverter"><span class="toc-number">2.1.</span> <span class="toc-text">1. MapConverter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-TreeSet-TreeMapConverter"><span class="toc-number">2.2.</span> <span class="toc-text">2. TreeSet/TreeMapConverter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-DynamicProxyConverter"><span class="toc-number">2.3.</span> <span class="toc-text">3. DynamicProxyConverter</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-ç°æœ‰å‡ ç§åˆ©ç”¨åˆ†æ"><span class="toc-number">3.</span> <span class="toc-text">0x02 ç°æœ‰å‡ ç§åˆ©ç”¨åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-EventHandler"><span class="toc-number">3.1.</span> <span class="toc-text">1. EventHandler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Groovy-ConvertedClosure"><span class="toc-number">3.2.</span> <span class="toc-text">2. Groovy ConvertedClosure</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MethodClosure"><span class="toc-number">3.2.1.</span> <span class="toc-text">MethodClosure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ConvertedClosure"><span class="toc-number">3.2.2.</span> <span class="toc-text">ConvertedClosure</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Groovy-Expando"><span class="toc-number">3.3.</span> <span class="toc-text">3. Groovy Expando</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-ImageIO-ContainsFilter"><span class="toc-number">3.4.</span> <span class="toc-text">4. ImageIO$ContainsFilter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-ServiceFinder-LazyIterator"><span class="toc-number">3.5.</span> <span class="toc-text">5. ServiceFinder$LazyIterator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¿®æ”¹BCEL-ClassLoaderæ„é€ POC"><span class="toc-number">3.5.1.</span> <span class="toc-text">ä¿®æ”¹BCEL ClassLoaderæ„é€ POC</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-XStreamçš„é˜²å¾¡æªæ–½"><span class="toc-number">4.</span> <span class="toc-text">0x03 XStreamçš„é˜²å¾¡æªæ–½</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-7-1-4-9"><span class="toc-number">4.1.</span> <span class="toc-text">1.4.7-1.4.9</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gt-1-4-10"><span class="toc-number">4.2.</span> <span class="toc-text">&gt;=1.4.10</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-æ€»ç»“"><span class="toc-number">5.</span> <span class="toc-text">0x04 æ€»ç»“</span></a></li></ol></section>
	
	<section class="article typo">
  	<div class="article-entry" itemprop="articleBody">
    	<h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><hr>
<p><a href="https://x-stream.github.io/" target="_blank" rel="noopener">XStream</a>ä¹Ÿæ˜¯ä¸€æ¬¾ç”¨çš„æ¯”è¾ƒå¤šçš„åºåˆ—åŒ–ç»„ä»¶ï¼Œå¯ä»¥å°†objectè½¬åŒ–ä¸ºXMLå¹¶èƒ½å®Œæ•´çš„è¿˜åŸå›æ¥ã€‚ä»–ä¹Ÿæ›¾ç»å‡ºç°è¿‡ååºåˆ—åŒ–æ¼æ´ï¼Œæœ¬æ–‡ä¸»è¦æ•´ç†XStreamç›¸å…³çš„å®‰å…¨é—®é¢˜XD</p>
<a id="more"></a>
<h1 id="0x01-åŸºç¡€çŸ¥è¯†"><a href="#0x01-åŸºç¡€çŸ¥è¯†" class="headerlink" title="0x01 åŸºç¡€çŸ¥è¯†"></a>0x01 åŸºç¡€çŸ¥è¯†</h1><hr>
<p>XStreamçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¸»è¦ä¾é <code>toXML</code>å‡½æ•°å’Œ<code>fromXML</code>å‡½æ•°ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Person person = <span class="keyword">new</span> Person(<span class="string">"tom"</span>, <span class="number">18</span>);</span><br><span class="line">XStream xStream = <span class="keyword">new</span> XStream();</span><br><span class="line">String xml = xStream.toXML(person);<span class="comment">// object to xml</span></span><br><span class="line">System.out.println(xml);</span><br><span class="line">System.out.println(xStream.fromXML(xml)); <span class="comment">// xml to object</span></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// &lt;objects.Person&gt;</span></span><br><span class="line"><span class="comment">//   &lt;name&gt;tom&lt;/name&gt;</span></span><br><span class="line"><span class="comment">//   &lt;age&gt;18&lt;/age&gt;</span></span><br><span class="line"><span class="comment">// &lt;/objects.Person&gt;</span></span><br><span class="line"><span class="comment">// objects.Person@369f73a2</span></span><br></pre></td></tr></table></figure>
<p>å…³äºXStreamçš„fromXMLåˆ†æçœ‹<a href="https://www.jianshu.com/p/387c568faf62" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ï¼ŒXStreamä¼šå»è°ƒç”¨ä¸åŒçš„Convertersæ¥å¤„ç†è¿˜åŸçš„è¿‡ç¨‹ã€‚</p>
<p>XStreamååºåˆ—åŒ–åŒfastjsonè¿™ç§ä¸ä¸€æ ·çš„åœ°æ–¹æ˜¯fastjsonä¼šåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¸»åŠ¨å»è°ƒç”¨getterså’Œsettersï¼Œè€ŒXStreamçš„ååºåˆ—åŒ–è¿‡ç¨‹ä¸­èµ‹å€¼éƒ½æœ‰Javaçš„åå°„æœºåˆ¶æ¥å®Œæˆï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰è¿™æ ·ä¸»åŠ¨è°ƒç”¨çš„ç‰¹æ€§ã€‚</p>
<p>ä½†æ˜¯è¿˜æœ‰ä¸€ç§åˆ©ç”¨æ–¹å¼ï¼Œå›æƒ³ä¸€ä¸‹ï¼Œåœ¨å‡ æ¡å¸¸è§„çš„javaååºåˆ—åŒ–åˆ©ç”¨é“¾ä¸Šï¼Œéƒ½åˆ©ç”¨äº†<code>HashMap</code>ã€<code>PriorityQueue</code>ç­‰å¯¹è±¡ï¼ˆkeyä¸å¯é‡å¤ç­‰ç‰¹æ€§ï¼‰ä¼šè‡ªåŠ¨å»è°ƒç”¨<code>hashCode</code>ã€<code>equal</code>ã€<code>compareTo</code>ç­‰è¿™ç§å‡½æ•°ã€‚</p>
<p>ä»¥è¿™ç§æƒ³æ³•æ¥çœ‹XStreamååºåˆ—åŒ–ï¼Œå½“æˆ‘ä»¬å¯¹Mapè¿™ç§ç±»å‹çš„å¯¹è±¡è¿›è¡Œè¿˜åŸçš„æ—¶å€™ï¼Œæ˜¯å¦ä¹ŸåŒæ ·ä¼šå»è°ƒç”¨ä¸Šé¢æåˆ°çš„å‡ ç§å‡½æ•°ï¼Ÿæ¥ä¸‹æ¥ï¼Œçœ‹å‡ ä¸ªConverterçš„å¤„ç†ï¼š</p>
<h2 id="1-MapConverter"><a href="#1-MapConverter" class="headerlink" title="1. MapConverter"></a>1. MapConverter</h2><p>æ¥çœ‹çœ‹é’ˆå¯¹Mapç±»å‹è¿˜åŸçš„Converter</p>
<p><code>com.thoughtworks.xstream.converters.collections.MapConverter#unmarshal</code></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200414231833562.png" alt="image-20200414231833562"></p>
<p><code>populateMap</code>å‡½æ•°ä¼šå»å¤„ç†åç»­çš„å€¼ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹å…·ä½“putçš„åœ°æ–¹</p>
<p><code>com.thoughtworks.xstream.converters.collections.MapConverter#putCurrentEntryIntoMap</code></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200414231951807.png" alt="image-20200414231951807"></p>
<p>è¿™é‡Œtargetä½œä¸ºæ¥æ”¶è€…ï¼Œä¼šè°ƒç”¨Mapçš„putå‡½æ•°ï¼Œåç»­å°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„å¯¹keyè°ƒç”¨hashCodeå‡½æ•°</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200414232218889.png" alt="image-20200414232218889"></p>
<h2 id="2-TreeSet-TreeMapConverter"><a href="#2-TreeSet-TreeMapConverter" class="headerlink" title="2. TreeSet/TreeMapConverter"></a>2. TreeSet/TreeMapConverter</h2><p>è¿™é‡ŒTreeSetå’ŒTreeMapä¸€èµ·è®²ï¼Œå› ä¸ºTreeSetæœ¬èº«å°±æ˜¯ä¸€ä¸ªåªç”¨ä¸Šäº†Keyçš„TreeMapï¼›TreeSetConverterçš„ååºåˆ—åŒ–å¤„ç†ä¹Ÿæ˜¯å…ˆè½¬åŒ–ä¸ºTreeMapConverterçš„æ–¹å¼æ¥ä¼˜å…ˆè¿˜åŸTreeSeté‡Œçš„TreeMapï¼Œå†å¡«å……åˆ°TreeSeté‡Œã€‚</p>
<p>ä»TreeSetConverteræ¥è®²</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200415142144637.png" alt="image-20200415142144637"></p>
<p>ä»treesetä¸­å–å‡ºfield treemapåï¼Œå»è¿›ä¸€æ­¥è°ƒç”¨TreeMapConverteræ¥è¿˜åŸTreeMap</p>
<p><code>com.thoughtworks.xstream.converters.collections.TreeMapConverter#populateTreeMap</code></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200415142431953.png" alt="image-20200415142431953"></p>
<p>è¿™é‡Œå…ˆç”¨soredMapæ¥å¡«å……éœ€è¦è¿˜åŸçš„Entryï¼Œåç»­å°†è°ƒç”¨<code>TreeMap.putAll</code></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200415142913714.png" alt="image-20200415142913714"></p>
<p>æœ€ç»ˆä¼šè°ƒç”¨åˆ°<code>java.util.AbstractMap#putAll</code></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200415143058176.png" alt="image-20200415143058176"></p>
<p>è¿™é‡Œçš„putå‡½æ•°ä¸º<code>TreeMap.put</code>,ä¸çœ‹å…·ä½“çš„ä»£ç äº†ï¼Œä»–çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯å¡«å……æ•°æ®ï¼Œå¹¶ä¸”åœ¨å¡«å……æ—¶å°†ä¼šæ¯”è¾ƒå½“å‰å­˜åœ¨keyï¼Œå¦‚æœæ˜¯ç›¸åŒçš„keyï¼Œåˆ™æ›¿æ¢åŸæœ‰è€çš„å€¼ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šå»è°ƒç”¨keyçš„<code>compareTo</code>å‡½æ•°</p>
<h2 id="3-DynamicProxyConverter"><a href="#3-DynamicProxyConverter" class="headerlink" title="3. DynamicProxyConverter"></a>3. DynamicProxyConverter</h2><p>è¿˜éœ€è¦æåŠçš„æ˜¯XStreamè¿˜æ”¯æŒå¯¹åŠ¨æ€ä»£ç†çš„æ–¹å¼è¿›è¡Œè¿˜åŸ</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200415162242443.png" alt="image-20200415162242443"></p>
<p>è¿™é‡Œçš„è¿˜åŸè¿‡ç¨‹ä¸è¯´äº†ï¼Œæˆ‘ä»¬ä¸»è¦çš„å…³æ³¨ç‚¹æ˜¯ä½¿ç”¨ProxyåŠ¨æ€ä»£ç†ï¼Œæˆ‘ä»¬å¯ä»¥æ‰©å±•å‰é¢ä¸¤ç§çš„è‡ªåŠ¨è°ƒç”¨å‡½æ•°çš„æ”»å‡»é¢ï¼Œä¸‹ä¸€ç« ä¼šä¸¾<code>EventHandler</code>çš„ä¾‹å­</p>
<h1 id="0x02-ç°æœ‰å‡ ç§åˆ©ç”¨åˆ†æ"><a href="#0x02-ç°æœ‰å‡ ç§åˆ©ç”¨åˆ†æ" class="headerlink" title="0x02 ç°æœ‰å‡ ç§åˆ©ç”¨åˆ†æ"></a>0x02 ç°æœ‰å‡ ç§åˆ©ç”¨åˆ†æ</h1><p>ç»“åˆä¸Šé¢åŸºç¡€çŸ¥è¯†ä¸­æåˆ°çš„å‡ ä¸ªConverterï¼Œæˆ‘ä»¬æƒ³è¦åˆ©ç”¨XStreamååºåˆ—åŒ–æ¼æ´çš„è¯ï¼Œå¾—å»å……åˆ†åˆ©ç”¨å‰é¢æåˆ°çš„å‡ ä¸ªä¼šè‡ªåŠ¨è°ƒç”¨çš„å‡½æ•°</p>
<h2 id="1-EventHandler"><a href="#1-EventHandler" class="headerlink" title="1. EventHandler"></a>1. EventHandler</h2><p>XStreamååºåˆ—åŒ–ç”¨çš„æœ€å¤šçš„<code>EventHandler</code>ï¼Œæ¥çœ‹çœ‹ä»–çš„<code>invoke</code>å‡½æ•°</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200415162715854.png" alt="image-20200415162715854"></p>
<p>ä¸»è¦å®ç°åœ¨<code>invokeInternal</code>å‡½æ•°å†…</p>
<p>é¦–å…ˆéœ€è¦åˆ¤æ–­æ­¤æ—¶è°ƒç”¨çš„å‡½æ•°æ˜¯å¦ä¸º<code>hashCode</code>ã€<code>equals</code>ã€<code>toString</code>ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‡‡ç”¨ä»¥ä¸‹çš„æ–¹å¼æ¥å¤„ç†ã€‚</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200415163231155.png" alt="image-20200415163231155"></p>
<p>ä½†æ˜¯æˆ‘ä»¬éœ€è¦åˆ©ç”¨çš„æ˜¯<code>invokeInternal</code>å‡½æ•°åç»­çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨çš„æ—¶å€™ä¸èƒ½ç”¨å®ƒæ¥è°ƒç”¨ä¸Šé¢çš„3ä¸ªå‡½æ•°ï¼Œ<strong>æ„å‘³ç€æˆ‘å‰é¢æåˆ°çš„<code>Map</code>çš„æ–¹å¼ï¼Œä¸é€‚åˆç”¨åœ¨è¿™ä¸ªåœ°æ–¹</strong>ï¼›è€Œ<code>TreeSet</code>è¿™ç§è°ƒç”¨<code>compareTo</code>å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥ç»§ç»­å¾€ä¸‹èµ°ã€‚</p>
<p>ç»§ç»­å¾€ä¸‹çœ‹</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200415170159510.png" alt="image-20200415170159510"></p>
<p>åç»­çš„å°±æ˜¯ç»å…¸çš„javaåå°„æœºåˆ¶æ¥å®ç°å‡½æ•°è°ƒç”¨ï¼Œå¹¶ä¸”è¿™é‡Œçš„targetå’Œactionéƒ½æ˜¯å¯æ§çš„ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œè¿™é‡Œactionå‡½æ•°å‚æ•°æ˜¯æœ‰è¦æ±‚çš„ï¼ˆçœ‹452è¡Œåˆ°461è¡Œï¼‰</p>
<ol>
<li>æ— å‚æ•°</li>
<li>å•ä¸ªå‚æ•°ï¼Œä¸”å‚æ•°çš„ç±»å‹ä¸º<code>Comparable</code>ï¼Œå¹¶ä¸”è¿™ä¸ªactionå‡½æ•°æ˜¯å¯åˆ©ç”¨çš„</li>
</ol>
<p>ç¬¬2ç§è¿˜æ²¡æœ‰æ‰¾åˆ°è¿™æ ·å¯åˆ©ç”¨çš„å‡½æ•°ï¼Œè¿™é‡Œçš„ç¬¬ä¸€ç§å¯ä»¥æä¸¤ç§ï¼š</p>
<ul>
<li>é…ç½®å¥½cmdçš„<code>ProcessBuilder</code>ï¼Œactionå¡«<code>start</code></li>
<li>é…ç½®å¥½rmi urlçš„<code>JdbcRowSetImpl</code>ï¼Œactionå¡«<code>getDatabaseMetaData</code>ï¼Œè¿™é‡Œå¯ä»¥ä¸¾ä¸€åä¸‰ï¼Œä¸»è¦æ€è·¯å°±æ˜¯å¯åˆ©ç”¨çš„getters</li>
</ul>
<p>ç°åœ¨å†æ¥çœ‹çœ‹å…·ä½“çš„<a href="https://github.com/wh1t3p1g/ysomap/blob/master/core/src/main/java/ysomap/core/payload/xstream/EventHandler.java" target="_blank" rel="noopener">POC</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sorted-set</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">string</span>&gt;</span>foo<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dynamic-proxy</span>&gt;</span> <span class="comment">&lt;!-- Proxy åŠ¨æ€ä»£ç†ï¼Œhandlerä½¿ç”¨EventHandler --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interface</span>&gt;</span>java.lang.Comparable<span class="tag">&lt;/<span class="name">interface</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">handler</span> <span class="attr">class</span>=<span class="string">"java.beans.EventHandler"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">target</span> <span class="attr">class</span>=<span class="string">"java.lang.ProcessBuilder"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">command</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">string</span>&gt;</span>open<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">string</span>&gt;</span>/System/Applications/Calculator.app<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">action</span>&gt;</span>start<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">handler</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dynamic-proxy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sorted-set</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-Groovy-ConvertedClosure"><a href="#2-Groovy-ConvertedClosure" class="headerlink" title="2. Groovy ConvertedClosure"></a>2. Groovy ConvertedClosure</h2><p><strong>åˆ©ç”¨æ¡ä»¶</strong>ï¼šgroovy &lt;= 2.4.3ï¼Œåœ¨åç»­çš„ç‰ˆæœ¬é‡Œï¼Œ<code>MethodClosure</code>ä¸å…è®¸ååºåˆ—åŒ–è°ƒç”¨ã€‚</p>
<p>é™¤äº†ä¸Šé¢è¿™ç§<code>EventHandler</code>çš„åŠ¨æ€ä»£ç†æ–¹å¼ï¼ŒGroovyçš„<code>ConvertedClosure</code>ä¹ŸåŒæ ·å¯ä»¥è¾¾åˆ°è¿™ç§æ•ˆæœ</p>
<h3 id="MethodClosure"><a href="#MethodClosure" class="headerlink" title="MethodClosure"></a>MethodClosure</h3><p>å½“å‰MethodClosureçš„ä¸»è¦ä½œç”¨å°±æ˜¯å°è£…æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å¯¹è±¡ï¼Œæ¯”å¦‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> MethodClosure(Runtime.getRuntime(), <span class="string">"exec"</span>);</span><br></pre></td></tr></table></figure>
<p>å°è£…<code>Runtime</code>å¯¹è±¡ï¼Œå¹¶è®¾å®šåç»­éœ€è¦è°ƒç”¨çš„å‡½æ•°<code>exec</code></p>
<h3 id="ConvertedClosure"><a href="#ConvertedClosure" class="headerlink" title="ConvertedClosure"></a>ConvertedClosure</h3><p>è¿™ä¸ª<code>ConvertedClosure</code>ä¹Ÿæ˜¯ç»§æ‰¿äº†<code>InvocationHandler</code>ï¼Œå¯ä»¥åœ¨åŠ¨æ€ä»£ç†ä¸­ä½œä¸ºhandlerçš„å­˜åœ¨ï¼Œæ¥çœ‹ä¸€ä¸‹ä»–çš„invoke</p>
<p><code>ConvertedClosure</code>è°ƒç”¨çš„æ˜¯çˆ¶ç±»<code>org.codehaus.groovy.runtime.ConversionHandler#invoke</code></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200418142036889.png" alt="image-20200418142036889"></p>
<p>ä¸»è¦çœ‹è¿™ä¸ªéƒ¨åˆ†ï¼Œå¯¹äºå½“å‰è°ƒç”¨çš„å‡½æ•°ï¼Œå¦‚æœéObjectçš„å‡½æ•°(å¦‚toStringã€hashCodeç­‰)ï¼Œå¹¶ä¸”ä¸æ˜¯<code>GroovyObject</code>çš„å‡½æ•°ï¼Œä¼šå»è°ƒç”¨å­ç±»çš„<code>invokeCustom</code>ï¼Œè¿™é‡Œçœ‹<code>org.codehaus.groovy.runtime.ConvertedClosure#invokeCustom</code></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200418171210630.png" alt="image-20200418171210630"></p>
<p>è¿™é‡Œçš„å±æ€§éƒ½æ˜¯å¯æ§çš„ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å»è°ƒç”¨å»è°ƒç”¨å‰é¢æ„é€ å¥½çš„<code>MethodClosure</code>ï¼Œè¿™é‡Œåç»­è°ƒç”¨<code>call</code>çš„è¿‡ç¨‹å¯ä»¥çœ‹æœ€è¿‘çš„è¿™ç¯‡<a href="https://paper.seebug.org/1171/" target="_blank" rel="noopener">æ–‡ç« </a></p>
<p>æ‰€ä»¥ä¸ºäº†æ»¡è¶³èƒ½è°ƒç”¨<code>invokeCustom</code>å‡½æ•°ï¼Œå‰é¢çš„ä¸¤ç§<code>MapConverter</code>å’Œ<code>TreeSetConverter</code>ï¼Œé€‰å“ªç§å‘¢ï¼Ÿ</p>
<p>å¾ˆæ˜æ˜¾ç­”æ¡ˆæ˜¯é€‰æ‹©<code>TreeSetConverter</code>ï¼Œå› ä¸º<code>Map</code>ä¼šå»è°ƒç”¨<code>hashCode</code>ï¼Œè€Œ<code>TreeSet</code>ä¼šå»è°ƒç”¨<code>compareTo</code>ï¼Œè¿™é‡Œçš„<code>hashCode</code>æ˜¯Objectçš„å‡½æ•°ï¼Œè¿‡ä¸äº†ä¸Šé¢<code>checkMethod</code>ï¼Œå…·ä½“æ€ä¹ˆå†™POCï¼Œä¸è¯¦ç»†è¯´äº†ï¼Œè§<a href="https://github.com/wh1t3p1g/ysomap/blob/master/core/src/main/java/ysomap/core/payload/xstream/GroovyConvertedClosure.java" target="_blank" rel="noopener">ysomap</a></p>
<p>PSï¼šè¿™é‡Œéœ€è¦æä¸€ä¸‹çš„æ˜¯ç”±äº<code>compareTo</code>ä¼šå¸¦ä¸Šä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬<code>MethodClosure</code>å°è£…çš„åç»­éœ€è¦è°ƒç”¨çš„å‡½æ•°å¿…é¡»è¦å­˜åœ¨ä¸€ä¸ªStringç±»å‹çš„å‚æ•°ï¼Œä¸ç„¶ä¼šæ‰¾ä¸åˆ°å‡½æ•°æŠ¥é”™ã€‚ï¼ˆå¯èƒ½è¿˜æœ‰å…¶ä»–çš„è§£å†³æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘æ²¡ç»§ç»­æ·±å…¥ä¸‹å»äº†ï¼Œç›´æ¥æ„é€ <code>Runtime.exec</code>å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼‰</p>
<h2 id="3-Groovy-Expando"><a href="#3-Groovy-Expando" class="headerlink" title="3. Groovy Expando"></a>3. Groovy Expando</h2><p>å‰é¢ç”¨åˆ°äº†<code>TreeSet</code>çš„æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬å»ä½¿ç”¨<code>Map</code>çš„ç±»å‹æ¥è§¦å‘ã€‚ä»¥<code>Map</code>çš„ç±»å‹æ¥è§¦å‘ï¼Œé‚£å°±æ˜¯æ‰¾å¯ä»¥åˆ©ç”¨çš„<code>hashCode</code>å‡½æ•°</p>
<p><code>groovy.util.Expando#hashCode</code></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200418174424715.png" alt="image-20200418174424715"></p>
<p>å¦‚æœåœ¨ç±»å±æ€§<code>expandoProperties</code>ä¸­å­˜åœ¨<code>hashCode:methodclosure</code>çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œç›´æ¥è°ƒç”¨<code>MethodClosure</code>çš„<code>call</code>å‡½æ•°ï¼Œè·Ÿä¸Šé¢<code>ConvertedClosure</code>åç»­çš„è°ƒç”¨ä¸€æ ·ï¼Œä½†æ˜¯è¿™é‡Œè°ƒç”¨æ—¶æ²¡æœ‰å‡½æ•°å‚æ•°è¿‡æ¥ï¼Œæ‰€ä»¥è¿™é‡Œçš„æ€è·¯æ˜¯<code>ProcessBuilder.start</code>æˆ–è€…fastjsoné‚£ç§gettersçš„åˆ©ç”¨ï¼Œè§<a href="https://github.com/wh1t3p1g/ysomap/blob/master/core/src/main/java/ysomap/core/payload/xstream/GroovyExpando.java" target="_blank" rel="noopener">POC</a></p>
<h2 id="4-ImageIO-ContainsFilter"><a href="#4-ImageIO-ContainsFilter" class="headerlink" title="4. ImageIO$ContainsFilter"></a>4. ImageIO$ContainsFilter</h2><p>ä¸Šé¢ä½¿ç”¨åŠ¨æ€ä»£ç†çš„æ–¹å¼åˆ©ç”¨äº†<code>TreeSet</code>è°ƒç”¨putæ—¶è§¦å‘çš„<code>compareTo</code>ï¼Œè€Œè¿™é‡Œåˆ©ç”¨çš„æ˜¯<code>HashMap</code>ç±»å‹putæ—¶è°ƒç”¨çš„<code>hashCode</code>å‡½æ•°ï¼›è¿™ä¸ªé“¾ç›¸å¯¹æ¥è¯´å¤æ‚ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹æ¥è¯´ï¼ˆå‚è€ƒmarshalsecçš„<a href="https://github.com/mbechler/marshalsec/blob/master/src/main/java/marshalsec/gadgets/ImageIO.java" target="_blank" rel="noopener">ImageIO</a>ï¼Œè¿™é‡Œå…ˆè†œä¸€æ³¢å¤§ä½¬çš„æ€è·¯ï¼Œåæ–‡ä¸ºé¡ºåŠ¿è®²ä¸‹å»çš„ï¼Œä¸»è¦ç›®çš„æ˜¯åˆ°è¾¾<code>Iterator.next</code>ï¼Œå®é™…æŒ–æ˜è¿™ç§é“¾è¿˜æ˜¯å¾—ä»åå¾€å‰æ‰¾ï¼‰ï¼š</p>
<p>ä»XStreamå¤„ç†<code>Map</code>ç±»å‹æ—¶è§¦å‘<code>hashCode</code>å¼€å§‹</p>
<p>å…³æ³¨<code>jdk.nashorn.internal.objects.NativeString#hashCode</code></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200416162110270.png" alt="image-20200416162110270"></p>
<p>åç»­è°ƒç”¨<code>getStringValue</code>å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°é‡Œå»è°ƒç”¨äº†<code>this.value.toString()</code>ï¼Œè¿™é‡Œçš„valueçš„ç±»å‹ä¸º<code>CharSequence</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ä¸‹æ¥è¦æ‰¾å¯ä»¥åˆ©ç”¨çš„<code>CharSequence</code>çš„å®ç°ç±»ï¼Œè¿™é‡Œç”¨åˆ°çš„æ˜¯<code>com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data#toString</code>å‡½æ•°</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200416164810572.png" alt="image-20200416164810572"></p>
<p>è¿™é‡Œç´§æ¥ç€ä¼šå»è°ƒç”¨<code>ByteArrayOutputStreamEx</code>çš„<code>readFrom</code>ï¼Œè¿™ä¸ªå‡½æ•°ç”¨åˆ°çš„ä¸»è¦æ˜¯è¿™è¾¹ä¼ å…¥çš„InputStreamçš„readå‡½æ•°</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200416165222727.png" alt="image-20200416165222727"></p>
<p>å®é™…ä¸Š<code>is</code>æˆ‘ä»¬æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œå› ä¸ºè¿™é‡Œè°ƒç”¨çš„<code>this.dataHandler.getDataSource().getInputStream()</code>ï¼Œä»–çš„å€¼ä¼ é€’éƒ½å¯ä»¥ç”¨ç±»å±æ€§çš„æ–¹å¼æŠŠä»–æ„å»ºå‡ºæ¥ï¼Œåˆ†åˆ«æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. this.dataHandler == æ„é€ å¥½çš„DataHandler</span><br><span class="line">2. DataHandlerçš„dataSourceå±æ€§ == æ„é€ å¥½çš„XmlDataSource</span><br><span class="line">3. XmlDataSourceè°ƒç”¨getInputStream()å‡½æ•°è¿”å›æ„é€ å¥½çš„inputStream</span><br><span class="line"></span><br><span class="line">// com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource</span><br></pre></td></tr></table></figure>
<p>ç”¨è¿™ç§æ–¹æ³•å°±å¯ä»¥è·å–ä¸€ä¸ªå¯æ§çš„<code>inputStream</code>ï¼Œå¹¶ä¸”åç»­ä¼šå»è°ƒç”¨<code>read</code>å‡½æ•°</p>
<p>ç»§ç»­çœ‹ä¸‹å»ï¼Œ<code>javax.crypto.CipherInputStream#read</code></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200416170450515.png" alt="image-20200416170450515"></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200416170531566.png" alt="image-20200416170531566"></p>
<p>æ­¤æ—¶éœ€è¦æ„é€ ä¸€ä¸ª<code>Cipher</code>ç±»å‹ï¼Œå¹¶ä¸”åç»­è°ƒç”¨<code>Cipher.update</code>å‡½æ•°ï¼Œè¿™é‡Œå¯ä»¥ç”¨<code>javax.crypto.NullCipher</code>æ¥å¡«å……ï¼Œå› ä¸ºæœ€ç»ˆç”¨åˆ°çš„æ˜¯çˆ¶ç±»<code>Cipher.update</code>ï¼Œåªè¦ä¸é‡è½½<code>update</code>ï¼Œå…¶ä»–çš„å­ç±»ä¹Ÿå¯ä»¥ã€‚</p>
<p>ç»§ç»­çœ‹<code>Cipher.update</code></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200416170954216.png" alt="image-20200416170954216"></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200416171051157.png" alt="image-20200416171051157"></p>
<p>è¯´äº†é‚£ä¹ˆä¹…ï¼Œæˆ‘ä»¬ç»ˆäºåˆ°äº†è‡³å…³é‡è¦çš„ä¸€ä¸ªåœ°æ–¹ï¼Œ<code>serviceIterator.next</code>å‡½æ•°</p>
<p>åç»­æˆ‘ä»¬å°†è°ƒç”¨ImageIOä¸‹çš„<code>javax.imageio.spi.FilterIterator#next</code></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200416171636844.png" alt="image-20200416171636844"></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200416171715068.png" alt="image-20200416171715068"></p>
<p><code>advance</code>å‡½æ•°ä¼šå»è°ƒç”¨<code>filter.filter</code>å‡½æ•°ï¼Œè€ŒImageIOå­˜åœ¨ä¸€ä¸ªæœ‰è¶£çš„filter</p>
<p><code>javax.imageio.ImageIO.ContainsFilter#filter</code></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200416171927622.png" alt="image-20200416171927622"></p>
<p>æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªMethodå¯¹è±¡å»invokeï¼Œåˆ°äº†è¿™é‡Œå°±æ˜¯æ¿€åŠ¨äººå¿ƒçš„Javaåå°„æœºåˆ¶äº†ï¼Œæˆ‘ä»¬æå‰æ„é€ å¥½methodå¯¹è±¡ï¼Œå°±å¯ä»¥è°ƒç”¨ä»»æ„çš„å‡½æ•°ã€‚</p>
<p>åˆ©ç”¨é“¾æ¯”è¾ƒé•¿ï¼Œæ•´ç†ä¸€ä¸‹è¿‡ç¨‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">XStream å¤„ç†Mapç±»å‹ å»è°ƒç”¨jdk.nashorn.internal.objects.NativeString#hashCode</span><br><span class="line">	com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data#toString</span><br><span class="line">	javax.activation.DataHandler#getDataSource</span><br><span class="line">		com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource#getInputStream</span><br><span class="line">			javax.crypto.CipherInputStream#read -&gt; getMoreData</span><br><span class="line">			javax.crypto.NullCipher#update -&gt; chooseFirstProvider</span><br><span class="line">				javax.imageio.spi.FilterIterator#next</span><br><span class="line">					javax.imageio.ImageIO.ContainsFilter#filter</span><br><span class="line">						ProcessBuilder#start</span><br></pre></td></tr></table></figure>
<p>ä»åé¢å¾€å‰çœ‹çš„è¯ï¼Œæˆ‘ä»¬å‰é¢åšçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯ä¸ºäº†èƒ½å»è§¦å‘<code>Iterator.next</code>ï¼Œè€Œè¿™ç§<code>Iterator</code>çš„éå†å¤„ç†ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å†æ‰¾åˆ°ä¸€å¤„ï¼Œä¸‹ä¸€èŠ‚å°±æ˜¯ä¸ç”¨<code>javax.imageio.ImageIO.ContainsFilter#filter</code>æ¥å®ç°åˆ©ç”¨ï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹XD</p>
<h2 id="5-ServiceFinder-LazyIterator"><a href="#5-ServiceFinder-LazyIterator" class="headerlink" title="5. ServiceFinder$LazyIterator"></a>5. ServiceFinder$LazyIterator</h2><p>æ€è·¯æ¥è‡ª<a href="https://www.anquanke.com/post/id/172198#h2-4" target="_blank" rel="noopener">æ–‡ç« 1</a>ã€<a href="[https://meizjm3i.github.io/2020/01/09/Jenkins-2-101-XStream-Rce-%E7%A9%BA%E6%8C%87%E9%92%88CTF%E4%B8%80%E6%9C%88%E5%86%85%E9%83%A8%E8%B5%9BWriteup/](https://meizjm3i.github.io/2020/01/09/Jenkins-2-101-XStream-Rce-ç©ºæŒ‡é’ˆCTFä¸€æœˆå†…éƒ¨èµ›Writeup/">æ–‡ç« 2</a>)</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹<code>java.util.ServiceLoader.LazyIterator#next</code></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200417164755804.png" alt="image-20200417164755804"></p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200417164854625.png" alt="image-20200417164854625"></p>
<p>å½“ç±»å±æ€§<code>acc</code>ä¸ºç©ºæ—¶ï¼Œä¼šå»è°ƒç”¨<code>nextService</code>å‡½æ•°ï¼Œè€Œåœ¨è¯¥å‡½æ•°é‡Œé¢ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä»¤äººç†Ÿæ‚‰çš„<code>Class.forName</code>çš„è°ƒç”¨ã€‚å¹¶ä¸”æˆ‘ä»¬å»å®ä¾‹åŒ–çš„<code>classname</code>ã€<code>loader</code>ï¼Œéƒ½æ˜¯ç±»å±æ€§ï¼Œå±äºæˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ä¸œè¥¿ã€‚</p>
<p>åˆ°äº†è¿™é‡Œè‡ªç„¶è€Œç„¶çš„å°±æƒ³åˆ°äº†ä½¿ç”¨BCELçš„ClassLoaderæ¥è½½å…¥classnameé‡Œçš„å­—èŠ‚ç äº†(è¿™é‡Œæˆ‘åœ¨fastjsoné‚£ç¯‡é‡Œæåˆ°è¿‡)ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ImageIOé‚£æ¡é“¾çš„åŸºç¡€ä¸Šï¼Œåœ¨è§¦å‘<code>Iterator.next</code>æ—¶ä½¿ç”¨è¿™ä¸ª<code>LazyIterator</code>æ¥ä»£æ›¿</p>
<h3 id="ä¿®æ”¹BCEL-ClassLoaderæ„é€ POC"><a href="#ä¿®æ”¹BCEL-ClassLoaderæ„é€ POC" class="headerlink" title="ä¿®æ”¹BCEL ClassLoaderæ„é€ POC"></a>ä¿®æ”¹BCEL ClassLoaderæ„é€ POC</h3><p>è¿™é‡Œæ¥æä¸€ä¸‹å…³äºPOCçš„æ„é€ ï¼Œå¦‚æœä½ ä½¿ç”¨äº†å½“å‰è¿™ä¸ªåˆ©ç”¨é“¾ï¼Œå¹¶ä¸”ä¸å¯¹<code>ClassLoader</code>åšå¤„ç†çš„è¯ï¼Œä½ ä¼šå‘ç°æ€ä¹ˆéƒ½æ‰“ä¸é€šï¼Œå› ä¸ºè¿™é‡Œåœ¨å®é™…è¿˜åŸ<code>ClassLoader</code>çš„æ—¶å€™å‡ºç°äº†é”™è¯¯</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200417225056222.png" alt="image-20200417225056222"></p>
<p>è¿™é‡Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œä¸€æ˜¯å»é™¤è¿™ç§è¿˜åŸæœ‰é—®é¢˜çš„ç±»ï¼ˆä¼šå¾ˆéº»çƒ¦ï¼‰ï¼ŒäºŒæ˜¯ç›´æ¥æŠŠ<code>ClassLoader</code>é‡Œçš„ä¸€äº›æ— å…³ç´§è¦çš„ä¸œè¥¿å‰”é™¤æ‰ã€‚</p>
<p>è¿™é‡Œæˆ‘é€‰æ‹©äº†ç¬¬äºŒç§ï¼Œç»è¿‡è°ƒè¯•å»é™¤äº†ä»¥ä¸‹å‡ ä¸ªå±æ€§çš„å€¼</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200417225303428.png" alt="image-20200417225303428"></p>
<p>è¿™é‡Œç”±äºæˆ‘ä»¬å‰”é™¤äº†<code>ignored_packages</code>å’Œ<code>deferTo</code>ï¼Œå¯¼è‡´BCELçš„ClassLoaderåœ¨è½½å…¥æ™®é€šçš„ç±»çš„æ—¶å€™ä¼šå‡ºç°åŠ è½½é”™è¯¯çš„é—®é¢˜</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200417225600161.png" alt="image-20200417225600161"></p>
<p>æ¥çœ‹çœ‹æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜</p>
<p>é¦–å…ˆBCELçš„<code>ClassLoader.loadClass</code>ï¼Œä¸€å…±å°è¯•4æ¬¡ä¸åŒçš„è½½å…¥æ–¹æ³•</p>
<ol>
<li><p>ä»å½“å‰ClassLoaderçš„classeså»æ‰¾</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200417225808446.png" alt="image-20200417225808446"></p>
</li>
<li><p>å¯¹äºé»˜è®¤å¿½ç•¥çš„åŒ…<code>java./sun./javax.</code>ï¼Œä½¿ç”¨<code>deferTo</code>å»é‡æ–°åŠ è½½ï¼Œè¿™é‡Œçš„<code>deferTo</code>æ˜¯ç³»ç»Ÿçš„ClassLoaderï¼ˆ<code>ClassLoader.getSystemClassLoader()</code>)</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200417230040882.png" alt="image-20200417230040882"></p>
</li>
<li><p>å¯¹äºclassnameä»¥<code>$$BCEL$$</code>å¼€å¤´çš„ï¼Œæ ¹æ®classnameçš„å€¼å»defineClassï¼Œè¿™è¾¹å°±æ˜¯æˆ‘ä»¬æœ€å–œæ¬¢çš„ä»»æ„è½½å…¥å­—èŠ‚ç çš„åœ°æ–¹</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200417230343866.png" alt="image-20200417230343866"></p>
</li>
<li><p>æœ€åä¸€æ¬¡æ˜¯ç”¨<code>repository</code>å»è½½å…¥å½“å‰çš„classnameï¼Œå¦‚æœè¿™é‡Œè¿˜æ²¡æ‰¾åˆ°ï¼Œå°±ä¼šçˆ†æ²¡æœ‰æ‰¾åˆ°Classçš„é”™è¯¯</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200417230451954.png" alt="image-20200417230451954"></p>
<p>PSï¼šè¿™éƒ¨åˆ†<code>repository</code>å–çš„<code>SyntheticRepository.getInstance()</code>ï¼Œè¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šè¿™ä¸ªå·¦å³ï¼Œåç»­æ•´ç†ä¸€ä¸‹ClassLoaderç›¸å…³çš„çŸ¥è¯†å†åšè¡¥å……</p>
</li>
</ol>
<p>å†æ¥çœ‹æˆ‘ä»¬æŠ¥é”™çš„åŸå› ï¼Œå› ä¸ºåˆ é™¤<code>ignored_packages</code>å’Œ<code>deferTo</code>ä¹‹åï¼Œç›¸å½“äºç¬¬äºŒç§æƒ…å†µæ— æ³•è½½å…¥äº†ï¼Œè€Œæ˜¾ç„¶<code>java.lang.Object</code>ä¸ç¬¦åˆç¬¬ä¸‰ç§æƒ…å†µã€‚æœ€åç¬¬4ç§é‡Œé¢ä¹Ÿæ²¡æœ‰æ‰¾åˆ°è¿™ä¸ª<code>java.lang.Object</code>ï¼Œæ‰€ä»¥æœ€ç»ˆçˆ†äº†<code>ClassNotFoundException</code></p>
<p>è¿™é‡Œå…¶å®å·²ç»å¾ˆæ˜æ˜¾äº†ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¾—åœ¨<code>classes</code>é‡Œæ·»åŠ æˆ‘ä»¬ä¼ å…¥çš„classå­—èŠ‚ç é‡Œæ‰€ç”¨åˆ°çš„æ‰€æœ‰ç±»ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€æ¬¡å°è¯•è½½å…¥çš„æ—¶å€™ï¼Œå°±æ‰¾åˆ°äº†ç›¸åº”çš„ç±»ï¼Œæ— éœ€å°è¯•åç»­çš„å‡ ç§è½½å…¥æ–¹å¼ã€‚</p>
<p>æ¯”å¦‚è¿™é‡Œæˆ‘äº§ç”Ÿçš„å­—èŠ‚ç é‡Œé¢ç”¨ä¸Šäº†<code>Runtime</code>ï¼Œå°±å¾—åŠ ä¸Šè¿™ä¸ªç±»</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200417231357924.png" alt="image-20200417231357924"></p>
<p>è¿™é‡Œçš„Objectå¿…é¡»åŠ ä¸Šï¼Œæ¯•ç«Ÿæ‰€æœ‰çš„å¯¹è±¡éƒ½ç»§æ‰¿è‡ªObject</p>
<h1 id="0x03-XStreamçš„é˜²å¾¡æªæ–½"><a href="#0x03-XStreamçš„é˜²å¾¡æªæ–½" class="headerlink" title="0x03 XStreamçš„é˜²å¾¡æªæ–½"></a>0x03 XStreamçš„é˜²å¾¡æªæ–½</h1><hr>
<p>XStreamåœ¨1.4.7ç‰ˆæœ¬ä¹‹åæ”¯æŒä½¿ç”¨ç™½åå•å’Œé»‘åå•çš„æ–¹å¼æ¥æ–¹å¼æ¶æ„ç±»çš„ååºåˆ—åŒ–<a href="http://x-stream.github.io/security.html" target="_blank" rel="noopener">security</a></p>
<blockquote>
<p>Starting with XStream 1.4.7, it is possible to define <a href="http://x-stream.github.io/security.html#framework" target="_blank" rel="noopener">permissions</a> for types, to check the type of an object that should be unmarshalled. Those permissions can be used to allow or deny types explicitly With these permissions it is at least not possible to inject unexpected types into an object graph. The security framework supports the setup of a black or white listing scenario. Any application should use this feature to limit the danger of arbitrary command execution if it deserializes data from an external source.</p>
<p>XStream itself sets up a black list by default, i.e. it blocks all currently known critical classes of the Java runtime. Main reason for the black list is compatibility, because otherwise newer versions of XStream 1.4.x can no longer be used as drop-in replacement. Unfortunately this provides a false sense of security. Every XStream client should therefore switch to a white listing on its own as soon as possible. XStream itself will use white listing as default starting with 1.5.x and only clients that have also changed their setup will be able to use this newer version again as drop-in replacement.</p>
</blockquote>
<p>è¿™é‡Œä¸»è¦çœ‹ä¸€ä¸‹é»‘åå•çš„å¤„ç†</p>
<h2 id="1-4-7-1-4-9"><a href="#1-4-7-1-4-9" class="headerlink" title="1.4.7-1.4.9"></a>1.4.7-1.4.9</h2><p><code>EventHandler</code>çš„å¤„ç†ç”±<code>ReflectionConverter</code>æ¥å¤„ç†çš„ï¼Œåœ¨1.4.7-1.4.9ç‰ˆæœ¬ï¼Œåœ¨<code>canConvert</code>å¤„æ·»åŠ äº†å¯¹<code>EventHandler</code>çš„é™åˆ¶</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200418185546291.png" alt="image-20200418185546291"></p>
<p>æ‰€ä»¥<code>EventHandler</code>çš„POCå°±å¤±æ•ˆäº†ï¼Œä½†æ˜¯å…¶ä»–çš„å‡ ç§å¹¶æ²¡æœ‰å¤±æ•ˆ</p>
<h2 id="gt-1-4-10"><a href="#gt-1-4-10" class="headerlink" title="&gt;=1.4.10"></a>&gt;=1.4.10</h2><p>åœ¨1.4.10ç‰ˆæœ¬å¢åŠ äº†<code>setupDefaultSecurity</code>æ–¹å¼æ¥è®¾ç½®é»˜è®¤çš„ç™½åå•ï¼Œä½†æ˜¯è¿™ä¸ªç‰ˆæœ¬æŠŠä¸Šé¢<code>EventHandler</code>çš„é™åˆ¶å»æ‰äº†ï¼Œå¯¼è‡´åˆå¯ä»¥ä½¿ç”¨æœ€æ—©çš„POCï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™æ˜¯æ²¡ä¿®è¡¥å‰çš„<code>1.4.10</code>ï¼Œä¿®å¤åå·²ç»ä¸å¯ä»¥äº†</p>
<p>é™¤äº†æ–°å¢è®¾ç½®ç™½åå•çš„æ–¹å¼ï¼Œä¹Ÿæ–°å¢åŠ äº†<code>InternalBlackList</code>è¿™ä¸ªconverterï¼Œä»–è®¾ç½®çš„æƒé™ä¸º<code>LOW</code>ï¼Œè€Œ<code>ReflectionConverter</code>æƒé™ä¸º<code>Very_low</code>ï¼Œæ‰€ä»¥ä¼šå…ˆè¿‡ä¸€æ¬¡é»‘åå•æ£€æŸ¥ï¼ˆXStreamåœ¨æ³¨å†Œconvertersæ—¶ï¼Œä»¥æƒé™çš„æ–¹å¼æ¥å†³å®šæ¬¡åºï¼‰ã€‚</p>
<p><img src="/images/talk-about-xstream-deserialization-20200418/image-20200418192827552.png" alt="image-20200418192827552"></p>
<p>æ‰€ä»¥è¿™é‡Œ1,4,5éƒ½è·ªäº†ï¼Œåªå‰©ä¸‹groovyè¿™ç§äº†ï¼Œå½“ç„¶è‚¯å®šè¿˜æœ‰å…¶ä»–æ²¡æœ‰å‘ç°çš„åˆ©ç”¨é“¾ï¼Œæ‰€ä»¥æœ€å®‰å…¨çš„æ–¹æ³•è¿˜æ˜¯ä½¿ç”¨ç™½åå•çš„æ–¹å¼ï¼Œä¸èƒ½ä¾èµ–XStreamçš„é»‘åå•æ¥åšå®‰å…¨é˜²å¾¡ã€‚</p>
<h1 id="0x04-æ€»ç»“"><a href="#0x04-æ€»ç»“" class="headerlink" title="0x04 æ€»ç»“"></a>0x04 æ€»ç»“</h1><hr>
<p>æœ¬æ–‡ä¸»è¦å›é¡¾äº†ç°æœ‰çš„ä¸€äº›åˆ©ç”¨é“¾ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼š</p>
<p>å¦‚æœXStreamç”¨çš„ä¸æ˜¯ç™½åå•æ¨¡å¼ï¼Œè¿˜æ˜¯å­˜åœ¨åˆ©ç”¨çš„å¯èƒ½æ€§çš„ã€‚ç°æœ‰å†…ç½®çš„é»‘åå•åªç¦æ­¢äº†å‡ ä¸ªç°æœ‰çš„åˆ©ç”¨é“¾ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥æ‰¾åˆ°å…¶ä»–å¯ä»¥åˆ©ç”¨çš„åˆ©ç”¨é“¾çš„ï¼Œæ¯”å¦‚å‰é¢æåˆ°çš„Groovyçš„åˆ©ç”¨é“¾ã€‚</p>
<p>éœ€è¦è®°ä½çš„æ˜¯XStreamä»–çš„è§¦å‘æ–¹å¼ä¾èµ–çš„æ˜¯HashMapã€TreeSetè¿™ç§ç±»å‹è‡ªåŠ¨è°ƒç”¨çš„<code>hashCode</code>ã€<code>compareTo</code>ä¸²èµ·æ¥çš„ï¼Œåç»­å¯ä»¥æ³¨æ„ä¸€ä¸‹è¿™ç§å¯èƒ½çš„è°ƒç”¨é“¾ã€‚</p>
<p>PSï¼šæœ¬æ–‡æåˆ°çš„æ‰€æœ‰POCï¼Œå·²ç»æ›´æ–°åˆ°<a href="https://github.com/wh1t3p1g/ysomap" target="_blank" rel="noopener">GitHub</a>ä¸Š</p>

  	</div>
	  
	  <div class="article-tags tags">
      
        <a href="/tags/vul/">vul</a>
      
	  </div>
    

	
		<div class="art-item-footer">
				
					<span class="art-item-left"><i class="icon icon-chevron-thin-left"></i>prevï¼š<a href="/2020/05/22/java-talk-about-struts2/" rel="prev"  title="ã€notesã€‘struts2å†å²æ¼æ´åˆ†æ">
						ã€notesã€‘struts2å†å²æ¼æ´åˆ†æ
					</a></span>
				
				
					<span class="art-item-right">nextï¼š<a href="/2020/04/13/java/talk-about-fastjson-deserialization/" rel="next"  title="ã€notesã€‘æµ…è°ˆfastjsonååºåˆ—åŒ–æ¼æ´">
						ã€notesã€‘æµ…è°ˆfastjsonååºåˆ—åŒ–æ¼æ´
					</a><i class="icon icon-chevron-thin-right"></i></span>
				
		</div>
	
	</section>
	
		<section id="comments">
			<div id="disqus_thread"></div>
		</section>
	
</article>
<script>
	window.subData = {
		title: 'ã€notesã€‘å›é¡¾XStreamååºåˆ—åŒ–æ¼æ´',
		tools: true
	}
</script>

      </div>
      <aside class='l_side'>
        
  <section class='m_widget about'>

<div class='header'>wh1t3p1g</div>
<div class='content'>
<div class='desc'>A Web ğŸ¶ &amp;&amp; Code Reviewer</div>
</div>
</section>

  <section class='m_widget links'>
<div class='header'>Links</div>
<div class='content'>
    <ul class="entry">
    
        <li><a class="flat-box" target="_blank" href="http://blog.orleven.com">
            <div class='name'>orleven</div>
        </a></li>
    
        <li><a class="flat-box" target="_blank" href="http://www.warmeng.com">
            <div class='name'>warmeng</div>
        </a></li>
    
    </ul>
</div>
</section>

  <section class='m_widget categories'>
<div class='header'>Categories</div>
<div class='content'>
    
    <ul class="entry">
    
        <li><a class="flat-box" href="/categories/codereview/"><div class='name'>codereview</div><div class='badget'>10</div></a></li>
    
        <li><a class="flat-box" href="/categories/ctf/"><div class='name'>ctf</div><div class='badget'>6</div></a></li>
    
        <li><a class="flat-box" href="/categories/notes/"><div class='name'>notes</div><div class='badget'>25</div></a></li>
    
    </ul>
    
</div>
</section>

  
<div class="m_widget tagcloud">
    <div class="header">Tags</div>
    <div class='content'>
        <a href="/tags/bctf/" style="font-size: 14px; color: #808080">bctf</a> <a href="/tags/cms/" style="font-size: 18.5px; color: #202020">cms</a> <a href="/tags/ctf/" style="font-size: 14px; color: #808080">ctf</a> <a href="/tags/cve/" style="font-size: 17px; color: #404040">cve</a> <a href="/tags/ddctf/" style="font-size: 14px; color: #808080">ddctf</a> <a href="/tags/hitbxctf/" style="font-size: 14px; color: #808080">hitbxctf</a> <a href="/tags/mobile/" style="font-size: 14px; color: #808080">mobile</a> <a href="/tags/njctf/" style="font-size: 14px; color: #808080">njctf</a> <a href="/tags/others/" style="font-size: 15.5px; color: #606060">others</a> <a href="/tags/suctf/" style="font-size: 14px; color: #808080">suctf</a> <a href="/tags/vul/" style="font-size: 20px; color: #000">vul</a>
    </div>
</div>



      </aside>
      <script>setLoadingBarProgress(60);</script>
    </div>
  </div>
  <footer id="footer" class="clearfix">

	<div class="social-wrapper">
  	
      
        <a href="https://github.com/wh1t3p1g" class="social github"
          target="_blank" rel="external">
          <span class="icon icon-github"></span>
        </a>
      
        <a href="/atom.xml" class="social rss"
          target="_blank" rel="external">
          <span class="icon icon-rss"></span>
        </a>
      
    
  </div>
  
  <div>Theme <a href='https://github.com/stkevintan/hexo-theme-material-flow' class="codename">MaterialFlow</a> designed by <a href="http://keyin.me/" target="_blank">Kevin Tan</a>.</div>
  
</footer>


  <script>setLoadingBarProgress(80);</script>
  
<script>
  var disqus_shortname = '0kami';
  
  var disqus_url = 'http://blog.0kami.cn/2020/04/18/java/talk-about-xstream-deserialization/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script>
<script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script>
<script src="/js/jquery.fitvids.js"></script>
<script>
	var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
	var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
	var ALGOLIA_API_KEY = "";
	var ALGOLIA_APP_ID = "";
	var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "hexo";
  var ROOT = "/"||"/";
  if(!ROOT.endsWith('/'))ROOT += '/';
</script>
<script src="/js/search.js"></script>
<script src="/js/app.js"></script>


  <script>setLoadingBarProgress(100);</script>
</body>
</html>
